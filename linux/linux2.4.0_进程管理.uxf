<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<diagram program="umlet" version="14.3.0">
  <zoom_level>1</zoom_level>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>633</x>
      <y>685</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_fork</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>668</x>
      <y>682</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_clone</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>701</x>
      <y>684</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_vfork</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>670</x>
      <y>707</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_fork
主要工作：
1.文件系统相关file，pwd，root
2.mm相关，vma 页表
3.返回相关，返回值eax，返回时的系统栈 ip
	用户栈，
次要工作：
1.pid分配，hash查找pid
2.进程间的相互关系，父进程，兄弟进程
3.进程的相关参数，和父进程的信号交互（exit）
	是否只有一个能返回用户态（sem）
	时间片等
</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>639</x>
      <y>688</y>
      <w>38</w>
      <h>21</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
SIGCHLD，regs.esp, &amp;regs, 0
SIGCHLD：低字节是子进程在exit之后向父进程发送的信号</panel_attributes>
    <additional_attributes>10.0;10.0;360.0;190.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>674</x>
      <y>685</y>
      <w>41</w>
      <h>24</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
clone_flags = regs.ebx 
newsp = regs.ecx/regs.esp（当传参为0时，选用父进程的sp）
&amp;regs,
0</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;220.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>669</x>
      <y>687</y>
      <w>45</w>
      <h>23</h>
    </coordinates>
    <panel_attributes>lt=.&gt;




CLONE_VFORK | CLONE_VM | SIGCHLD, regs.esp, &amp;regs, 0
CLONE_VFORK | CLONE_VM：高字节是资源和特性的标志位
这里是指子进程和父进程要共用虚存空间，并且子进程释放虚存空间的
时候应该唤醒父进程</panel_attributes>
    <additional_attributes>380.0;10.0;60.0;200.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>212</x>
      <y>759</y>
      <w>23</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>DECLARE_MUTEX_LOCKED</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>223</x>
      <y>710</y>
      <w>456</w>
      <h>51</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>4540.0;10.0;10.0;490.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>238</x>
      <y>759</y>
      <w>23</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>CLONE_PID只有0号进程可以用
这个是表示为进程创建task_struct，
但是和父进程公用pid
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>248</x>
      <y>710</y>
      <w>431</w>
      <h>51</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>4290.0;10.0;10.0;490.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>263</x>
      <y>760</y>
      <w>21</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>current-&gt;vfork_sem = &amp;sem;
	//之后这个变量会因为vfork down
	//这个信号量之后陷入睡眠
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>272</x>
      <y>710</y>
      <w>407</w>
      <h>52</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>4050.0;10.0;10.0;500.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>284</x>
      <y>760</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>alloc_task_struct</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>279</x>
      <y>767</y>
      <w>24</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__get_free_pages(GFP_KERNEL,1)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>289</x>
      <y>710</y>
      <w>390</w>
      <h>52</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>3880.0;10.0;10.0;500.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>289</x>
      <y>763</y>
      <w>22</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
申请2页的内存作为task_struct
注意：这里是2的1次方个页面</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>299</x>
      <y>760</y>
      <w>10</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>*p = *current
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>302</x>
      <y>710</y>
      <w>377</w>
      <h>52</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>3750.0;10.0;10.0;500.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>315</x>
      <y>759</y>
      <w>44</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>p-&gt;user：进程指向的用户
p-&gt;user-&gt;__count：引用用户的对象数目
p-&gt;user-&gt;processes：引用用户的进程数目
 p-&gt;rlim[RLIMIT_NPROC].rlim_cur：进程用户所规定的最大进程数
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>326</x>
      <y>710</y>
      <w>353</w>
      <h>51</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
atomic_read(&amp;p-&gt;user-&gt;processes) &lt;-&gt;rlim[RLIMIT_NPROC].rlim_cur</panel_attributes>
    <additional_attributes>3510.0;10.0;10.0;490.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>362</x>
      <y>761</y>
      <w>20</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>nr_threads &lt; max_threads
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>371</x>
      <y>710</y>
      <w>308</w>
      <h>53</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
线程数目filter</panel_attributes>
    <additional_attributes>3060.0;10.0;10.0;510.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>384</x>
      <y>761</y>
      <w>25</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>get_exec_domain(p-&gt;exec_domain)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>397</x>
      <y>710</y>
      <w>283</w>
      <h>53</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
增加动态安装模块module的计数</panel_attributes>
    <additional_attributes>2810.0;10.0;10.0;510.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>412</x>
      <y>761</y>
      <w>31</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__MOD_INC_USE_COUNT(p-&gt;binfmt-&gt;module)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>426</x>
      <y>710</y>
      <w>254</w>
      <h>53</h>
    </coordinates>
    <panel_attributes>lt=.&gt;


增加动态安装模块module（bin elf out等解释模块）的计数</panel_attributes>
    <additional_attributes>2520.0;10.0;10.0;510.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>446</x>
      <y>760</y>
      <w>26</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>	p-&gt;did_exec = 0;
	p-&gt;swappable = 0;
	p-&gt;state = TASK_UNINTERRUPTIBLE;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>455</x>
      <y>710</y>
      <w>225</w>
      <h>52</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>2230.0;10.0;10.0;500.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>474</x>
      <y>762</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_flags</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>477</x>
      <y>710</y>
      <w>203</w>
      <h>54</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>2010.0;10.0;10.0;520.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>414</x>
      <y>770</y>
      <w>41</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>new_flags &amp;= ~(PF_SUPERPRIV | PF_USEDFPU | PF_VFORK)
new_flags |= PF_FORKNOEXEC
if (!(clone_flags &amp; CLONE_PTRACE))
		p-&gt;ptrace = 0;
if (clone_flags &amp; CLONE_VFORK)
	new_flags |= PF_VFORK;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>432</x>
      <y>765</y>
      <w>49</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>470.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>491</x>
      <y>761</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>get_pid</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>497</x>
      <y>710</y>
      <w>183</w>
      <h>53</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
p-&gt;pid</panel_attributes>
    <additional_attributes>1810.0;10.0;10.0;510.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>460</x>
      <y>775</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;pid
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>466</x>
      <y>764</y>
      <w>31</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
flags &amp; CLONE_PID</panel_attributes>
    <additional_attributes>290.0;10.0;10.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>478</x>
      <y>774</y>
      <w>54</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>1.如果没有大于0x8000，就lastpid++
2.如果大于0x8000，last_pid从300开始找，如果这个pid
	被进程，进程组或者session用到，将last_pid++然后，在遍历整个
	task链表，看是否有上述三者用到这个pid
3.每次查找，如果发现这个pid没被用到，就用已经用到的pid更新next_safe的
	内容，使next_safe的内容更精确（范围更小），以便下次寻找pid的时候能更快的找到

注意：next_safe是用static修饰的
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>496</x>
      <y>764</y>
      <w>7</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;50.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>506</x>
      <y>761</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>p-&gt;run_list.next = NULL;
p-&gt;run_list.prev = NULL;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>513</x>
      <y>710</y>
      <w>167</w>
      <h>53</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
run_list：就绪态队列</panel_attributes>
    <additional_attributes>1650.0;10.0;10.0;510.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>533</x>
      <y>765</y>
      <w>58</w>
      <h>33</h>
    </coordinates>
    <panel_attributes>p-&gt;p_opptr：指向父进程（CLONE_VFORK/！CLONE_PARENT）
p-&gt;p_pptr：指向父进程（CLONE_VFORK/！CLONE_PARENT）&amp;（！PT_PTRACED）
p-&gt;p_cptr = NULL //指向最年轻的子进程
init_waitqueue_head(&amp;p-&gt;wait_chldexit)//初始化等待队列（因为没有子进程）
p-&gt;vfork_sem = NULL;
spin_lock_init(&amp;p-&gt;alloc_lock);
p-&gt;sigpending = 0;
init_sigpending(&amp;p-&gt;pending);	//初始化信号队列

p-&gt;it_real_value = p-&gt;it_virt_value = p-&gt;it_prof_value = 0;
p-&gt;it_real_incr = p-&gt;it_virt_incr = p-&gt;it_prof_incr = 0;
init_timer(&amp;p-&gt;real_timer);
p-&gt;real_timer.data = (unsigned long) p;
p-&gt;leader = 0;		/* session leadership doesn't inherit */
p-&gt;tty_old_pgrp = 0;
p-&gt;times.tms_utime = p-&gt;times.tms_stime = 0;
p-&gt;times.tms_cutime = p-&gt;times.tms_cstime = 0;//初始化时间参数
p-&gt;lock_depth = -1;		/* -1 = no lock */
p-&gt;start_time = jiffies;


halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>547</x>
      <y>710</y>
      <w>133</w>
      <h>57</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
p-&gt;pid</panel_attributes>
    <additional_attributes>1310.0;10.0;10.0;550.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>682</x>
      <y>763</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_files</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>783</x>
      <y>765</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_fs</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>823</x>
      <y>763</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_sighand</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>994</x>
      <y>759</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_mm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1236</x>
      <y>765</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_thread</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>677</x>
      <y>710</y>
      <w>14</w>
      <h>55</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
clone_flags</panel_attributes>
    <additional_attributes>10.0;10.0;100.0;530.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>591</x>
      <y>781</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>atomic_inc(&amp;oldf-&gt;count)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>598</x>
      <y>766</y>
      <w>90</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
CLONE_FILES
但这个flag置上的时候
只复制指针</panel_attributes>
    <additional_attributes>880.0;10.0;10.0;150.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>629</x>
      <y>766</y>
      <w>61</w>
      <h>19</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制整个实体</panel_attributes>
    <additional_attributes>590.0;10.0;10.0;170.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>610</x>
      <y>783</y>
      <w>38</w>
      <h>19</h>
    </coordinates>
    <panel_attributes>tsk-&gt;files = NULL
newf = kmem_cache_alloc(files_cachep, SLAB_KERNEL)
atomic_set(&amp;newf-&gt;count, 1);

newf-&gt;file_lock	    = RW_LOCK_UNLOCKED;
newf-&gt;next_fd	    = 0;
newf-&gt;max_fds	    = NR_OPEN_DEFAULT;
newf-&gt;max_fdset	    = __FD_SETSIZE;
newf-&gt;close_on_exec = &amp;newf-&gt;close_on_exec_init;
newf-&gt;open_fds	    = &amp;newf-&gt;open_fds_init;
newf-&gt;fd	    = &amp;newf-&gt;fd_array[0];

halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>659</x>
      <y>766</y>
      <w>31</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果父进程的size大于__FD_SETSIZE</panel_attributes>
    <additional_attributes>290.0;10.0;10.0;150.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>652</x>
      <y>781</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>expand_fdset</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>650</x>
      <y>789</y>
      <w>38</w>
      <h>20</h>
    </coordinates>
    <panel_attributes>1.不允许请求size的大小大于NR_OPEN
2.如果原本的size小于PAGE_SIZE * 8（内存占1页）
	就申请1页的内存，如果大于，就扩大1倍
3.如果申请小于1页的内存，就用kmlloc在低内存区申请内存
	如果大于1页内存就用vmalloc在high_mem申请内存
	这里的申请内存都是虚拟内存，kmollc申请的有物理内存
	vmlloc申请的是靠缺页中断去申请物理内存
4.复制files-&gt;open_fds，files-&gt;close_on_exec的内容
	到新申请的内存中（注意这里的max_fdset和nfds是32位
	对齐的）
5.更新位图扩展的个数，将新的内存区间和files-&gt;open_fds
	，files-&gt;close_on_exec交换，释放原来的内存区间。
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>658</x>
      <y>784</y>
      <w>8</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;60.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>686</x>
      <y>779</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>count_open_files</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>688</x>
      <y>766</y>
      <w>6</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;40.0;130.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>692</x>
      <y>782</y>
      <w>27</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
从size/(8*sizeof(long))-1开始找
直到找到files-&gt;open_fds-&gt;fds_bits[--i]
不为0为止，
注意这里使用的是--i
</panel_attributes>
    <additional_attributes>10.0;10.0;30.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>689</x>
      <y>793</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>i = (i+1) * 8 * sizeof(long)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>706</x>
      <y>779</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>expand_fd_array</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>688</x>
      <y>766</y>
      <w>26</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
i&gt;NR_OPEN_DEFAULT</panel_attributes>
    <additional_attributes>10.0;10.0;240.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>708</x>
      <y>791</y>
      <w>31</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>1.不允许请求size的大小大于NR_OPEN
2.扩展的大小分为三个层次，256*4,1页
	之前的两倍
3.通过kmlloc或者vmlloc分配内存
4.更新files-&gt;fd，files-&gt;max_fds
5.如果之前有内容，将file的指针复制给new_fds
	将之后的内容置0，并且释放旧的old_fds
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>711</x>
      <y>782</y>
      <w>9</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>728</x>
      <y>775</y>
      <w>32</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>memcpy（newf-&gt;open_fds-&gt;fds_bits 
memcpy（newf-&gt;close_on_exec-&gt;fds_bits
	//注意这里的open_files是32位对齐
if (f)
	get_file(f);//增加file的计数
*new_fds++ = f;//复制fd
memset(new_fds, 0, size)//将扩展的部分清0
memset(&amp;newf-&gt;open_fds-&gt;fds_bits[start], 0
memset(&amp;newf-&gt;close_on_exec-&gt;fds_bits[start], 0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>689</x>
      <y>766</y>
      <w>45</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
因为之前newf-&gt;max_fds
和newf-&gt;max_fdset都赋值为0
所以没有复制父进程的文件</panel_attributes>
    <additional_attributes>10.0;10.0;430.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>740</x>
      <y>770</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tsk-&gt;files = newf
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>689</x>
      <y>766</y>
      <w>58</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;560.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>677</x>
      <y>710</y>
      <w>113</w>
      <h>57</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1110.0;550.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>761</x>
      <y>775</y>
      <w>23</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>atomic_inc(&amp;current-&gt;fs-&gt;count)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>767</x>
      <y>768</y>
      <w>23</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
CLONE_FS</panel_attributes>
    <additional_attributes>210.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>790</x>
      <y>775</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__copy_fs_struct</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>786</x>
      <y>768</y>
      <w>13</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
没置CLONE_FS</panel_attributes>
    <additional_attributes>20.0;10.0;100.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>781</x>
      <y>782</y>
      <w>26</w>
      <h>23</h>
    </coordinates>
    <panel_attributes>atomic_set(&amp;fs-&gt;count, 1);
fs-&gt;lock = RW_LOCK_UNLOCKED;
fs-&gt;umask = old-&gt;umask;
	//mntget和dget返回原值并增加引用计数
fs-&gt;rootmnt = mntget(old-&gt;rootmnt);
fs-&gt;root = dget(old-&gt;root);
fs-&gt;pwdmnt = mntget(old-&gt;pwdmnt);
fs-&gt;pwd = dget(old-&gt;pwd);
if (old-&gt;altroot) {
	fs-&gt;altrootmnt = mntget(old-&gt;altrootmnt);
	fs-&gt;altroot = dget(old-&gt;altroot);
} else {
	fs-&gt;altrootmnt = NULL;
	fs-&gt;altroot = NULL;
}
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>795</x>
      <y>778</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>677</x>
      <y>710</y>
      <w>153</w>
      <h>55</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1510.0;530.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>816</x>
      <y>766</y>
      <w>13</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
CLONE_SIGHAND</panel_attributes>
    <additional_attributes>100.0;10.0;20.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>799</x>
      <y>771</y>
      <w>22</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>atomic_inc(&amp;current-&gt;sig-&gt;count)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>823</x>
      <y>771</y>
      <w>37</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>sig = kmem_cache_alloc(sigact_cachep, GFP_KERNEL);
tsk-&gt;sig = sig;
spin_lock_init(&amp;sig-&gt;siglock);
atomic_set(&amp;sig-&gt;count, 1);
memcpy(tsk-&gt;sig-&gt;action, current-&gt;sig-&gt;action
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>826</x>
      <y>766</y>
      <w>13</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
没置
CLONE_SIGHAND</panel_attributes>
    <additional_attributes>10.0;10.0;110.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>677</x>
      <y>710</y>
      <w>323</w>
      <h>51</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;3210.0;490.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>861</x>
      <y>772</y>
      <w>22</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>tsk-&gt;min_flt = tsk-&gt;maj_flt = 0;
tsk-&gt;cmin_flt = tsk-&gt;cmaj_flt = 0;
tsk-&gt;nswap = tsk-&gt;cnswap = 0;

tsk-&gt;mm = NULL;
tsk-&gt;active_mm = NULL;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>872</x>
      <y>762</y>
      <w>130</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1280.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>884</x>
      <y>776</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>return 0
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>890</x>
      <y>762</y>
      <w>112</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!oldmm
内核线程
不做任何复制</panel_attributes>
    <additional_attributes>1100.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>901</x>
      <y>762</y>
      <w>101</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
CLONE_VM</panel_attributes>
    <additional_attributes>990.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>898</x>
      <y>776</y>
      <w>22</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>atomic_inc(&amp;oldmm-&gt;mm_users);
mm = oldmm;
goto good_mm;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>927</x>
      <y>762</y>
      <w>75</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
没置
CLONE_VM</panel_attributes>
    <additional_attributes>730.0;10.0;10.0;120.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>921</x>
      <y>778</y>
      <w>23</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>allocate_mm
memcpy(mm, oldmm, sizeof(*mm))
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>927</x>
      <y>773</y>
      <w>3</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>946</x>
      <y>778</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mm_init</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>927</x>
      <y>773</y>
      <w>26</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;240.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>918</x>
      <y>785</y>
      <w>34</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>atomic_set(&amp;mm-&gt;mm_users, 1);
atomic_set(&amp;mm-&gt;mm_count, 1);
init_MUTEX(&amp;mm-&gt;mmap_sem);
mm-&gt;page_table_lock = SPIN_LOCK_UNLOCKED;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>939</x>
      <y>781</y>
      <w>13</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>951</x>
      <y>781</y>
      <w>19</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
mm-&gt;pgd </panel_attributes>
    <additional_attributes>10.0;10.0;170.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>961</x>
      <y>786</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>pgd_alloc</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>961</x>
      <y>793</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>get_pgd_fast</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>966</x>
      <y>789</y>
      <w>26</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
get_pgd_fast中继承了原来的系统空间
get_pgd_slow初始化了系统空间</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>968</x>
      <y>801</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>get_pgd_slow</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>939</x>
      <y>800</y>
      <w>25</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>pgd_quicklist = (unsigned long *)(*ret);
		ret[0] = 0;
		pgtable_cache_size--;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>950</x>
      <y>796</y>
      <w>18</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>958</x>
      <y>808</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__get_free_page</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>962</x>
      <y>804</y>
      <w>13</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>965</x>
      <y>796</y>
      <w>11</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;90.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>972</x>
      <y>808</y>
      <w>26</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>memset(ret, 0  //pgd清0
memcpy(ret + USER_PTRS_PER_PGD
	//复制系统空间
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>974</x>
      <y>804</y>
      <w>10</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;80.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1028</x>
      <y>773</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>dup_mmap</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>999</x>
      <y>762</y>
      <w>36</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;340.0;110.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>985</x>
      <y>776</y>
      <w>50</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>480.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1010</x>
      <y>784</y>
      <w>28</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>1.如果VM_DONTCOPY，不复制vma
2.kmem_cache_alloc
	*tmp = *mpnt;
	tmp-&gt;vm_flags &amp;= ~VM_LOCKED;
	tmp-&gt;vm_mm = mm;
	mm-&gt;map_count++;
	tmp-&gt;vm_next = NULL;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1012</x>
      <y>776</y>
      <w>24</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制vma</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1034</x>
      <y>776</y>
      <w>19</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tmp-&gt;vm_file</panel_attributes>
    <additional_attributes>10.0;10.0;170.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1118</x>
      <y>786</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_page_range</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1034</x>
      <y>776</y>
      <w>93</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;910.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1086</x>
      <y>793</y>
      <w>35</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>address = vma-&gt;vm_start
end = vma-&gt;vm_end
cow = 
(vma-&gt;vm_flags &amp; (VM_SHARED | VM_MAYWRITE)) 
== VM_MAYWRITE// copy on write
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1100</x>
      <y>789</y>
      <w>26</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>240.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1122</x>
      <y>793</y>
      <w>77</w>
      <h>24</h>
    </coordinates>
    <panel_attributes>1.如果src_pgd为none，会切换到下一个pgd，如果下一个pgd超过了end或者限制
	直接返回
2.循环遍历整个pgd（从offset开始）如果dst_pgd为none，则通过pmd_alloc分配pmd（只分配pmd空间，并加到pgd中）
3.在循环遍历pmd（从offset开始），如果pmd为空，则切换到下一个pmd，如果超过了限制，直接返回
				如果目标pmd为空，通过pte_alloc申请pte内存，并填充到pmd中
4.遍历整个pte空间(从offset开始)，如果pte为none，则不复制，切换到下一个pte，
	如果页面在盘上，通过swap_duplicate增加盘上计数
	如果页面在内存中，copy on write置上的话，将页面设置为只读
					ptep_set_wrprotect(src_pte);
					pte = *src_pte;
		如果VM_SHARED，将pte _PAGE_DIRTY位清掉
		通过pte_mkold，将_PAGE_ACCESSED清掉
		增加pte指向page的count计数
		将设置好的pte赋值给dest_pte,然后切换到下一个pte，直到end

halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1123</x>
      <y>789</y>
      <w>24</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;220.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1141</x>
      <y>785</y>
      <w>19</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tmp-&gt;vm_ops-&gt;open(tmp)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1034</x>
      <y>776</y>
      <w>117</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!retval &amp;&amp; tmp-&gt;vm_ops &amp;&amp; tmp-&gt;vm_ops-&gt;open</panel_attributes>
    <additional_attributes>10.0;10.0;1150.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1035</x>
      <y>776</y>
      <w>136</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将申请到的vma加入到mm-&gt;mmap
指向的链表中</panel_attributes>
    <additional_attributes>10.0;10.0;1340.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1188</x>
      <y>785</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>build_mmap_avl</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1035</x>
      <y>776</y>
      <w>159</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
mm-&gt;map_count &gt;= AVL_MIN_MAP_COUNT
2.4.0建造平衡树</panel_attributes>
    <additional_attributes>10.0;10.0;1570.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1054</x>
      <y>772</y>
      <w>27</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>list_add(&amp;mm-&gt;mmlist, &amp;oldmm-&gt;mmlist)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>999</x>
      <y>762</y>
      <w>67</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将新申请的mm加入到父进程mm链表的后面</panel_attributes>
    <additional_attributes>10.0;10.0;650.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1120</x>
      <y>770</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_segments</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1000</x>
      <y>762</y>
      <w>127</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制父进程的ldt
</panel_attributes>
    <additional_attributes>10.0;10.0;1250.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1100</x>
      <y>775</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>vmalloc</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1104</x>
      <y>772</y>
      <w>20</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
申请ldt的内存空间
可见是在high_mem</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1118</x>
      <y>775</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>memcpy</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1120</x>
      <y>772</y>
      <w>11</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制父进程的ldt</panel_attributes>
    <additional_attributes>60.0;20.0;40.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1139</x>
      <y>776</y>
      <w>24</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>new_mm-&gt;context.segments = ldt
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1126</x>
      <y>773</y>
      <w>26</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;240.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1168</x>
      <y>771</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>init_new_context
（i386中没有操作）</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1000</x>
      <y>762</y>
      <w>173</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1710.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1183</x>
      <y>770</y>
      <w>16</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>tsk-&gt;mm = mm;
tsk-&gt;active_mm = mm;
return 0;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1000</x>
      <y>762</y>
      <w>191</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1890.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>677</x>
      <y>710</y>
      <w>566</w>
      <h>57</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
stack_start= regs.esp（用户栈）
regs指向系统调用时的系统栈</panel_attributes>
    <additional_attributes>10.0;10.0;5640.0;550.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1180</x>
      <y>778</y>
      <w>45</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>childregs = ((struct pt_regs *) (THREAD_SIZE + (unsigned long) p)) - 1
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1197</x>
      <y>768</y>
      <w>46</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
子进程系统栈顶</panel_attributes>
    <additional_attributes>440.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1227</x>
      <y>778</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>struct_cpy(childregs, regs)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1234</x>
      <y>768</y>
      <w>13</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制系统栈</panel_attributes>
    <additional_attributes>70.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1248</x>
      <y>778</y>
      <w>31</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>childregs-&gt;eax = 0;//修改系统调用的返回值
childregs-&gt;esp = esp;//修改用户栈的地址
p-&gt;thread.esp=childregs//上下文切换时，
	//esp变成了系统栈的地址
p-&gt;thread.esp0=childregs+1 //系统栈的初始地址
	//设置了系统栈的栈顶
p-&gt;thread.eip=	ret_from_fork//上下文切换时，ip
	//被切换成ret_from_fork
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1240</x>
      <y>768</y>
      <w>23</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;210.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1280</x>
      <y>779</y>
      <w>20</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>savesegment(fs,p-&gt;thread.fs);
savesegment(gs,p-&gt;thread.gs)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1241</x>
      <y>768</y>
      <w>50</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
保存段寄存器
fs gs</panel_attributes>
    <additional_attributes>10.0;10.0;480.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1302</x>
      <y>779</y>
      <w>33</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>unlazy_fpu(current);
struct_cpy(&amp;p-&gt;thread.i387, &amp;current-&gt;thread.i387)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1241</x>
      <y>768</y>
      <w>73</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
fpu相关</panel_attributes>
    <additional_attributes>10.0;10.0;710.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>206</x>
      <y>768</y>
      <w>34</w>
      <h>4</h>
    </coordinates>
    <panel_attributes> __DECLARE_SEMAPHORE_GENERIC(name,0)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>221</x>
      <y>762</y>
      <w>18</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
这个信号量的初始值是0</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>197</x>
      <y>777</y>
      <w>46</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>struct semaphore name = __SEMAPHORE_INITIALIZER(name,count)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>219</x>
      <y>771</y>
      <w>13</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
定义变量
这里是局部变量</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>674</x>
      <y>710</y>
      <w>682</w>
      <h>57</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;6800.0;550.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>976</x>
      <y>784</y>
      <w>31</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>flush_cache_mm(current-&gt;mm);
mm-&gt;locked_vm = 0;
mm-&gt;mmap = NULL;
mm-&gt;mmap_avl = NULL;
mm-&gt;mmap_cache = NULL;
mm-&gt;map_count = 0;
mm-&gt;cpu_vm_mask = 0;
mm-&gt;swap_cnt = 0;
mm-&gt;swap_address = 0;
pprev = &amp;mm-&gt;mmap;//pprev描述的是一个箭头
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1046</x>
      <y>787</y>
      <w>39</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>get_file(file);
if (tmp-&gt;vm_flags &amp; VM_DENYWRITE)
	atomic_dec(&amp;inode-&gt;i_writecount);
	//从这里看出，每个vm_pprev_share指向（指向自己的指针）
	//即两次解引用才是自己
	//vm_next_share:mpnt-&gt;tmp-&gt;mpnt.vm_next_share
if((tmp-&gt;vm_next_share = mpnt-&gt;vm_next_share) != NULL)
	mpnt-&gt;vm_next_share-&gt;vm_pprev_share =
		&amp;tmp-&gt;vm_next_share;
mpnt-&gt;vm_next_share = tmp;
tmp-&gt;vm_pprev_share = &amp;mpnt-&gt;vm_next_share;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1163</x>
      <y>785</y>
      <w>17</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>*pprev = tmp;
pprev = &amp;tmp-&gt;vm_next
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1339</x>
      <y>765</y>
      <w>54</w>
      <h>101</h>
    </coordinates>
    <panel_attributes>p-&gt;semundo = NULL
p-&gt;parent_exec_id = p-&gt;self_exec_id
	//parent_exec_id父进程的执行域
	//self_exec_id本进程的执行域
p-&gt;swappable = 1//本进程页面可以换出
p-&gt;exit_signal = clone_flags &amp; CSIGNAL
	//exit_signal规定子进程exit时向父进程发送的信号
p-&gt;pdeath_signal = 0
	//pdeath_signal规定父进程在exit时向本进程发送的信号
p-&gt;counter = (current-&gt;counter + 1) &gt;&gt; 1;
current-&gt;counter &gt;&gt;= 1;
	//父子进程的时间片减半
if (!current-&gt;counter)
		current-&gt;need_resched = 1;//如果当前进程的时间片用完
				//则需要调度
retval = p-&gt;pid;
p-&gt;tgid = retval;
INIT_LIST_HEAD(&amp;p-&gt;thread_group);
if (clone_flags &amp; CLONE_THREAD) {
	p-&gt;tgid = current-&gt;tgid;//子进程的线程组被赋值为当前进程的进程组
	list_add(&amp;p-&gt;thread_group, &amp;current-&gt;thread_group);
	//将子进程的线程组加载当前进程的线程组链表之后
}
#define SET_LINKS(p) do { \
	(p)-&gt;next_task = &amp;init_task; \
	(p)-&gt;prev_task = init_task.prev_task; \
	init_task.prev_task-&gt;next_task = (p); \
	init_task.prev_task = (p); \//将子进程加入到task链表的最尾端
 //p_ysptr指向年轻的兄弟进程
 //p_osptr指向年长的兄弟进程
 //父进程p_cptr指向最年轻的子进程
 //p_pptr指向父进程
	(p)-&gt;p_ysptr = NULL; \
	if (((p)-&gt;p_osptr = (p)-&gt;p_pptr-&gt;p_cptr) != NULL) \
		(p)-&gt;p_osptr-&gt;p_ysptr = p; \//如果父进程p_pptr之前有最年轻的兄弟子进程p_cptr，
		//则将这个子进程年轻兄弟进程p_ysptr指向创建的进程
		//而当前进程的年长兄弟进程p_osptr指向之前最年轻的几次呢很难过
	(p)-&gt;p_pptr-&gt;p_cptr = p; //最年轻的进程指向当前创建的进程
	} while (0)
hash_pid（p）
{
	struct task_struct **htable = &amp;pidhash[pid_hashfn(p-&gt;pid)];
	//通过进程的pid找到hash值
	if((p-&gt;pidhash_next = *htable) != NULL)//将p加入到pid位hash值的杂凑队列
		(*htable)-&gt;pidhash_pprev = &amp;p-&gt;pidhash_next;//pidhash_pprev指向p.next指向下一个的箭头
	*htable = p;//更新杂凑队列头
	p-&gt;pidhash_pprev = htable;//指向自身
}
nr_threads++
if (p-&gt;ptrace &amp; PT_PTRACED)
		send_sig(SIGSTOP, p, 1);
wake_up_process(p);		/* do this last */
++total_forks;
	//因为之前如果CLONE_VM置上，导致父进程和子进程
	//共用用户空间，所以如果父进程和子进程同时返回用户空间
	//两者使用同一个用户栈，将导致严重的问题，所以如果使用了CLONE_VM
	//就必须使用CLONE_VFORK使当前进程陷入睡眠，用户空间只有子进程一个
	//享用用户栈
if ((clone_flags &amp; CLONE_VFORK) &amp;&amp; (retval &gt; 0)) 
		down(&amp;sem);//因为之前申明这个局部变量为0，现在申请（down）
				//这个信号量的时候会使当前进程陷入睡眠
return pid
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>652</x>
      <y>1053</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>load_aout_binary</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>298</x>
      <y>1094</y>
      <w>59</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>1.ex.a_info的低16位要是ZMAGIC OMAGIC QMAGIC NMAGIC
2.代码段和数据段重定位的长度要为0（ N_TRSIZE(ex)  N_DRSIZE(ex)）
3.执行文件的长度不能小于头信息中相加的大小（代码段 数据段，N_SYMSIZE N_TXTOFF）
 N_TXTOFF记录执行文件的入口地址
4.bss段和data段的长度和不能超过规定的current-&gt;rlim[RLIMIT_DATA].rlim_cur
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>324</x>
      <y>1056</y>
      <w>334</w>
      <h>40</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
filter</panel_attributes>
    <additional_attributes>3320.0;10.0;10.0;380.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>492</x>
      <y>1089</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flush_old_exec
</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>497</x>
      <y>1056</y>
      <w>162</w>
      <h>35</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
step1:与过去告别
1.释放过去的物理内存和虚拟内存
	初始化自己的内存空间
2.释放过去的信号action
3.关闭父进程规定关闭的文件</panel_attributes>
    <additional_attributes>1600.0;10.0;10.0;330.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>349</x>
      <y>1105</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>oldsig = current-&gt;sig
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>354</x>
      <y>1092</y>
      <w>145</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1430.0;10.0;10.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>375</x>
      <y>1105</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>make_private_signals</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>382</x>
      <y>1092</y>
      <w>117</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1150.0;10.0;10.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>355</x>
      <y>1113</y>
      <w>25</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>1.filter：这个sig被引用大于1次
	因为如果小于1次时因为在fork的时候
	就通过copy_sighand分开了
2.申请sig内存newsig
3.将newsig.count置1
4.将action拷贝过来
注：task_struct中的sig是指信号action
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>366</x>
      <y>1108</y>
      <w>20</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>441</x>
      <y>1104</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>exec_mmap</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>445</x>
      <y>1092</y>
      <w>54</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>520.0;10.0;10.0;120.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>398</x>
      <y>1107</y>
      <w>51</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
current-&gt;mm如果只有一个
user说明父进程和子进程的mm
是分开的</panel_attributes>
    <additional_attributes>490.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>387</x>
      <y>1112</y>
      <w>15</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>130.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>382</x>
      <y>1118</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flush_cache_mm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>395</x>
      <y>1118</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mm_release</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>409</x>
      <y>1118</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>exit_mmap</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>429</x>
      <y>1116</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flush_tlb_mm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>399</x>
      <y>1112</y>
      <w>4</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>399</x>
      <y>1112</y>
      <w>16</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>399</x>
      <y>1112</y>
      <w>35</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;330.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>362</x>
      <y>1121</y>
      <w>41</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tsk-&gt;flags &amp; PF_VFORK</panel_attributes>
    <additional_attributes>390.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>350</x>
      <y>1129</y>
      <w>21</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>tsk-&gt;flags &amp;= ~PF_VFORK;
	//在do_fork时因为这个标志将
	//父进程sleep，这里因为要将父
	//进程和子进程用户空间分开，
	//所以将父进程唤醒
up(tsk-&gt;p_opptr-&gt;vfork_sem)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>447</x>
      <y>1107</y>
      <w>32</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果之前和父进程公用一个用户空间
</panel_attributes>
    <additional_attributes>10.0;10.0;300.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>400</x>
      <y>1125</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>release_segments</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>405</x>
      <y>1121</y>
      <w>11</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>90.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>376</x>
      <y>1136</y>
      <w>28</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>if (ldt) {//如果task的ldt存在
 //将task的ldt设NULL
	mm-&gt;context.segments = NULL;
	//将cpu的ldt设置成default_ldt
	//并通过lldt加载
	clear_LDT();
	//释放ldt的页表，页面以及vma的管理结构
	vfree(ldt);
}
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>386</x>
      <y>1128</y>
      <w>21</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>190.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>411</x>
      <y>1131</y>
      <w>53</w>
      <h>44</h>
    </coordinates>
    <panel_attributes> //保存原来的vma链表
mpnt = mm-&gt;mmap;
	//释放vma链表 avl树，vma cache
mm-&gt;mmap = mm-&gt;mmap_avl = mm-&gt;mmap_cache = NULL;

while (mpnt) {
	struct vm_area_struct * next = mpnt-&gt;vm_next;
	unsigned long start = mpnt-&gt;vm_start;
	unsigned long end = mpnt-&gt;vm_end;
	unsigned long size = end - start;

	if (mpnt-&gt;vm_ops) {
		if (mpnt-&gt;vm_ops-&gt;close)
			mpnt-&gt;vm_ops-&gt;close(mpnt);
	}
	mm-&gt;map_count--;//清除对应vma的应用
	//如果vm_fil存在，当VM_DENYWRITE时
	//将i_writecount释放，释放vma在vm_next_share
	//链表中的链接关系
	remove_shared_vm_struct(mpnt);
	flush_cache_range(mm, start, end);
	zap_page_range(mm, start, size);//释放vma对应的物理页面
	if (mpnt-&gt;vm_file)
		fput(mpnt-&gt;vm_file);//释放映射文件
	kmem_cache_free(vm_area_cachep, mpnt);//释放vma管理结构对应的内存空间
	mpnt = next;
}
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>413</x>
      <y>1121</y>
      <w>11</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;90.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>429</x>
      <y>1124</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>clear_page_tables</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>413</x>
      <y>1121</y>
      <w>26</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
释放页表结构
注：这里没释放pgd
根据参数，这里只是释放了用户空间</panel_attributes>
    <additional_attributes>10.0;10.0;240.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>450</x>
      <y>1118</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mm_alloc</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>446</x>
      <y>1125</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>allocate_mm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>457</x>
      <y>1125</y>
      <w>20</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>memset(mm, 0, sizeof(*mm))
mm_init
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>455</x>
      <y>1121</y>
      <w>11</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;90.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>449</x>
      <y>1121</y>
      <w>9</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>70.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>455</x>
      <y>1114</y>
      <w>24</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>461</x>
      <y>1118</y>
      <w>27</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>list_add(&amp;mm-&gt;mmlist, &amp;init_mm.mmlist)
current-&gt;mm = mm;
		current-&gt;active_mm = mm;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>469</x>
      <y>1114</y>
      <w>12</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
加载mmlist最后</panel_attributes>
    <additional_attributes>80.0;10.0;30.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>489</x>
      <y>1119</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>activate_mm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>476</x>
      <y>1114</y>
      <w>21</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
mm的切换</panel_attributes>
    <additional_attributes>10.0;10.0;190.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>490</x>
      <y>1127</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>switch_mm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>494</x>
      <y>1122</y>
      <w>4</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>466</x>
      <y>1135</y>
      <w>44</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>clear_bit(cpu, &amp;prev-&gt;cpu_vm_mask)
 //注意这里的context是结构体，所以在分配mm的时候，就就分配
 //context的内存，所以在init_mm的时候将mm set为0，表示segments
 //被设置成NULL,而prev-&gt;context.segments是有ldt的（从copy_mm
 //可以看出）
if (prev-&gt;context.segments != next-&gt;context.segments)
	load_LDT(next)
set_bit(cpu, &amp;next-&gt;cpu_vm_mask)
 //重新加载pgd的地址，更换页表
asm volatile("movl %0,%%cr3": :"r" (__pa(next-&gt;pgd)))
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>485</x>
      <y>1130</y>
      <w>12</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>100.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>503</x>
      <y>1119</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mm_release</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>447</x>
      <y>1107</y>
      <w>62</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
之前因为公用一个mm
将父进程sleep，现在
通过up释放这个信号量
</panel_attributes>
    <additional_attributes>10.0;10.0;600.0;120.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>518</x>
      <y>1119</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mmput</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>447</x>
      <y>1107</y>
      <w>78</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;760.0;120.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>522</x>
      <y>1122</y>
      <w>6</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;

</panel_attributes>
    <additional_attributes>10.0;10.0;40.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>513</x>
      <y>1131</y>
      <w>24</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>atomic_dec_and_test
	__asm__ __volatile__(
		//sete是当eflags中的ZF为1
		//时，置上1.ZF(zero flag)
		//表示计算结果如果为0，zf就置上
		LOCK "decl %0; sete %1"
		:"=m" (v-&gt;counter), "=qm" (c)
		:"m" (v-&gt;counter) : "memory");
	return c != 0;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>508</x>
      <y>1126</y>
      <w>28</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
看mm_users--是否为0
mm_users是针对用户空间（current.mm）
</panel_attributes>
    <additional_attributes>180.0;10.0;90.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>525</x>
      <y>1126</y>
      <w>32</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果为0
</panel_attributes>
    <additional_attributes>10.0;10.0;300.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>544</x>
      <y>1131</y>
      <w>12</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>100.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>539</x>
      <y>1136</y>
      <w>19</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>list_del(&amp;mm-&gt;mmlist)
spin_unlock(&amp;mmlist_lock)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>559</x>
      <y>1136</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>exit_mmap</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>553</x>
      <y>1131</y>
      <w>14</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
注：这里没释放pgd
</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>575</x>
      <y>1136</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mmdrop</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>553</x>
      <y>1131</y>
      <w>30</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;

</panel_attributes>
    <additional_attributes>10.0;10.0;280.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>576</x>
      <y>1144</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mmdrop</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>580</x>
      <y>1138</y>
      <w>30</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
atomic_dec_and_test
mm_count减到0
mm_count是针对mm（current.active_mm）
例如内核线程就没有mm而有active_mm
</panel_attributes>
    <additional_attributes>10.0;20.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>565</x>
      <y>1151</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>pgd_free</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>586</x>
      <y>1152</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>free_mm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>568</x>
      <y>1147</y>
      <w>18</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
exit_mmap并没有释放pgd
这里将pgd释放
</panel_attributes>
    <additional_attributes>130.0;10.0;40.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>580</x>
      <y>1147</y>
      <w>13</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
释放mm管理结构</panel_attributes>
    <additional_attributes>10.0;10.0;110.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>533</x>
      <y>1119</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mmdrop</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>448</x>
      <y>1107</y>
      <w>93</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果current-&gt;mm为空（线程）
直接mmdrop，不用对mm_user进行操作</panel_attributes>
    <additional_attributes>10.0;10.0;910.0;120.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>467</x>
      <y>1101</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>release_old_signals</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>472</x>
      <y>1092</y>
      <w>28</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>260.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>470</x>
      <y>1104</y>
      <w>15</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
current-&gt;sig != oldsig</panel_attributes>
    <additional_attributes>50.0;10.0;90.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>471</x>
      <y>1107</y>
      <w>27</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>if (atomic_dec_and_test(&amp;oldsig-&gt;count))
	kmem_cache_free(sigact_cachep, oldsig)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>486</x>
      <y>1101</y>
      <w>18</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>current-&gt;sas_ss_sp =
current-&gt;sas_ss_size = 0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>492</x>
      <y>1092</y>
      <w>8</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>60.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>506</x>
      <y>1102</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;dumpable = 1
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>486</x>
      <y>1092</y>
      <w>41</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
current-&gt;euid == current-&gt;uid &amp;&amp; current-&gt;egid == current-&gt;gid</panel_attributes>
    <additional_attributes>130.0;10.0;270.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>527</x>
      <y>1102</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;comm
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>498</x>
      <y>1092</y>
      <w>38</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
存储filename最后一个“\”之后的
字符串</panel_attributes>
    <additional_attributes>10.0;10.0;360.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>542</x>
      <y>1102</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flush_thread</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>498</x>
      <y>1092</y>
      <w>51</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;490.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>557</x>
      <y>1101</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>de_thread</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>498</x>
      <y>1092</y>
      <w>65</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;630.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>535</x>
      <y>1111</y>
      <w>23</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>list_del_init(&amp;tsk-&gt;thread_group)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>535</x>
      <y>1104</y>
      <w>38</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果执行execve的是线程!list_empty(&amp;tsk-&gt;thread_group)
，那么现在需要上升到进程

</panel_attributes>
    <additional_attributes>290.0;10.0;80.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>563</x>
      <y>1111</y>
      <w>14</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>tsk-&gt;tgid = tsk-&gt;pid
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>563</x>
      <y>1104</y>
      <w>9</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;

</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>571</x>
      <y>1101</y>
      <w>16</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>current-&gt;dumpable = 0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>497</x>
      <y>1092</y>
      <w>82</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
bprm-&gt;e_uid != current-&gt;euid || bprm-&gt;e_gid != current-&gt;egid || 
	    permission(bprm-&gt;file-&gt;f_dentry-&gt;d_inode,MAY_READ)</panel_attributes>
    <additional_attributes>10.0;10.0;800.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>589</x>
      <y>1101</y>
      <w>16</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>current-&gt;self_exec_id++
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>497</x>
      <y>1092</y>
      <w>102</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;

</panel_attributes>
    <additional_attributes>10.0;10.0;1000.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>608</x>
      <y>1101</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flush_signal_handlers</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>498</x>
      <y>1092</y>
      <w>120</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;

</panel_attributes>
    <additional_attributes>10.0;10.0;1180.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>601</x>
      <y>1107</y>
      <w>25</w>
      <h>11</h>
    </coordinates>
    <panel_attributes> //IGN表示ignore
if (ka-&gt;sa.sa_handler != SIG_IGN)
	//设置成default
	ka-&gt;sa.sa_handler = SIG_DFL;
//全都清0
ka-&gt;sa.sa_flags = 0;
sigemptyset(&amp;ka-&gt;sa.sa_mask);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>614</x>
      <y>1103</y>
      <w>14</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
遍历所有的action

</panel_attributes>
    <additional_attributes>20.0;20.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>636</x>
      <y>1101</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flush_old_files</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>498</x>
      <y>1092</y>
      <w>144</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;

</panel_attributes>
    <additional_attributes>10.0;10.0;1420.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>629</x>
      <y>1109</y>
      <w>24</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>files-&gt;close_on_exec-&gt;fds_bits[j] = 0
sys_close(i)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>632</x>
      <y>1104</y>
      <w>16</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
清零位图
关闭位图中指示的文件

</panel_attributes>
    <additional_attributes>110.0;10.0;40.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>580</x>
      <y>1091</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>set_personality</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>584</x>
      <y>1056</y>
      <w>77</w>
      <h>37</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>750.0;10.0;10.0;350.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>656</x>
      <y>1093</y>
      <w>31</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>current-&gt;mm-&gt;end_code = ex.a_text +
	(current-&gt;mm-&gt;start_code = N_TXTADDR(ex));
current-&gt;mm-&gt;end_data = ex.a_data +
	(current-&gt;mm-&gt;start_data = N_DATADDR(ex));
current-&gt;mm-&gt;brk = ex.a_bss +
	(current-&gt;mm-&gt;start_brk = N_BSSADDR(ex));

current-&gt;mm-&gt;rss = 0;
current-&gt;mm-&gt;mmap = NULL;
current-&gt;flags &amp;= ~PF_FORKNOEXEC
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>657</x>
      <y>1056</y>
      <w>15</w>
      <h>39</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;130.0;370.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>690</x>
      <y>1101</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>compute_creds</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>658</x>
      <y>1056</y>
      <w>39</w>
      <h>47</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
计算新代码之后具有的权限
注：可以看代码注释

</panel_attributes>
    <additional_attributes>10.0;10.0;370.0;450.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>658</x>
      <y>1056</y>
      <w>81</w>
      <h>37</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
step2:加载代码段和data段</panel_attributes>
    <additional_attributes>10.0;10.0;790.0;350.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>720</x>
      <y>1090</y>
      <w>19</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
OMAGIC
不是可重入代码</panel_attributes>
    <additional_attributes>170.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>736</x>
      <y>1090</y>
      <w>25</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
检查是否按页对齐
ex.a_text &amp; 0xfff || ex.a_data &amp; 0xfff
fd_offset &amp; ~PAGE_MASK
报问题要间隔5s
(jiffies-error_time2) &gt; 5*HZ
</panel_attributes>
    <additional_attributes>10.0;10.0;230.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>708</x>
      <y>1099</y>
      <w>34</w>
      <h>15</h>
    </coordinates>
    <panel_attributes> //代码段的初始虚拟地址
text_addr = N_TXTADDR(ex)
pos = 32;
map_size = ex.a_text+ex.a_data;
 //申请代码虚拟内存
error = do_brk(text_addr &amp; PAGE_MASK, map_size);
 //读取文件到内存中
bprm-&gt;file-&gt;f_op-&gt;read(bprm-&gt;file, (char *)text_addr,
			  ex.a_text+ex.a_data, &amp;pos)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>733</x>
      <y>1099</y>
      <w>41</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!bprm-&gt;file-&gt;f_op-&gt;mmap||((fd_offset &amp; ~PAGE_MASK) != 0)
如果没有体统mmap，或者没有页对齐，申请虚拟内存，然后将
文件读到用户空间</panel_attributes>
    <additional_attributes>250.0;10.0;150.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>744</x>
      <y>1108</y>
      <w>40</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>do_brk(N_TXTADDR(ex), ex.a_text+ex.a_data);
			bprm-&gt;file-&gt;f_op-&gt;read(bprm-&gt;file,(char *)N_TXTADDR(ex),
					ex.a_text+ex.a_data, &amp;pos);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>786</x>
      <y>1110</y>
      <w>51</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>do_mmap(bprm-&gt;file, N_TXTADDR(ex), ex.a_text,
			PROT_READ | PROT_EXEC,
			MAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE | MAP_EXECUTABLE,
			fd_offset)
do_mmap(bprm-&gt;file, N_DATADDR(ex), ex.a_data,
				PROT_READ | PROT_WRITE | PROT_EXEC,
				MAP_FIXED | MAP_PRIVATE | MAP_DENYWRITE | MAP_EXECUTABLE,
				fd_offset + ex.a_text)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>757</x>
      <y>1099</y>
      <w>47</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果提供mmap，并且与页对齐
直接将文件mmap用户空间</panel_attributes>
    <additional_attributes>10.0;10.0;450.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>786</x>
      <y>1087</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>set_binfmt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>659</x>
      <y>1056</y>
      <w>133</w>
      <h>33</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1310.0;310.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>795</x>
      <y>1094</y>
      <w>32</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>*old = current-&gt;binfmt;
if (new &amp;&amp; new-&gt;module)
	//增加模块计数
	__MOD_INC_USE_COUNT(new-&gt;module);
current-&gt;binfmt = new;//更新模块
if (old &amp;&amp; old-&gt;module)
	//减少旧的模块计数
	__MOD_DEC_USE_COUNT(old-&gt;module);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>792</x>
      <y>1090</y>
      <w>16</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>826</x>
      <y>1085</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>set_brk</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>659</x>
      <y>1056</y>
      <w>174</w>
      <h>31</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
step3:current-&gt;mm-&gt;start_brk//bss的起始地址
current-&gt;mm-&gt;brk//bss的结束地址</panel_attributes>
    <additional_attributes>10.0;10.0;1720.0;290.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>827</x>
      <y>1091</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_brk</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>831</x>
      <y>1088</y>
      <w>12</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
申请虚拟内存</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>869</x>
      <y>1079</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>setup_arg_pages</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>658</x>
      <y>1056</y>
      <w>218</w>
      <h>25</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
step4:设置栈的虚拟内存
和物理内存</panel_attributes>
    <additional_attributes>10.0;10.0;2160.0;230.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>828</x>
      <y>1096</y>
      <w>41</w>
      <h>12</h>
    </coordinates>
    <panel_attributes> //栈base的虚拟地址
stack_base = STACK_TOP - MAX_ARG_PAGES*PAGE_SIZE;
 //栈指针的位置
bprm-&gt;p += stack_base;
if (bprm-&gt;loader)
	bprm-&gt;loader += stack_base;
bprm-&gt;exec += stack_base;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>840</x>
      <y>1082</y>
      <w>37</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>350.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>871</x>
      <y>1096</y>
      <w>50</w>
      <h>24</h>
    </coordinates>
    <panel_attributes>kmem_cache_alloc//申请vma
mpnt-&gt;vm_mm = current-&gt;mm;
 //栈vma的vm_start是栈指针对页取整
mpnt-&gt;vm_start = PAGE_MASK &amp; (unsigned long) bprm-&gt;p;
mpnt-&gt;vm_end = STACK_TOP;//虚拟地址3G
mpnt-&gt;vm_page_prot = PAGE_COPY;
mpnt-&gt;vm_flags = VM_STACK_FLAGS;
mpnt-&gt;vm_ops = NULL;
mpnt-&gt;vm_pgoff = 0;
mpnt-&gt;vm_file = NULL;
mpnt-&gt;vm_private_data = (void *) 0;
 //插入vma
insert_vm_struct(current-&gt;mm, mpnt);
current-&gt;mm-&gt;total_vm = (mpnt-&gt;vm_end - mpnt-&gt;vm_start) &gt;&gt; PAGE_SHIFT
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>874</x>
      <y>1082</y>
      <w>18</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;160.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>933</x>
      <y>1091</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_dirty_page</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>905</x>
      <y>1089</y>
      <w>22</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>bprm-&gt;page[i] = NULL;
 //进程占据物理页面的数量rss
current-&gt;mm-&gt;rss++
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>874</x>
      <y>1082</y>
      <w>56</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
bprm-&gt;page[i]!=Null
如果栈有被分配物理内存</panel_attributes>
    <additional_attributes>10.0;10.0;540.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>917</x>
      <y>1087</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;20.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>923</x>
      <y>1087</y>
      <w>20</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
为栈提供虚拟地址的访问页表</panel_attributes>
    <additional_attributes>50.0;10.0;140.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>920</x>
      <y>1098</y>
      <w>45</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>set_pte(pte, pte_mkdirty(pte_mkwrite(mk_pte(page, PAGE_COPY))))
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>938</x>
      <y>1094</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>959</x>
      <y>1079</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>create_aout_tables</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>967</x>
      <y>1087</y>
      <w>49</w>
      <h>53</h>
    </coordinates>
    <panel_attributes>sp -= envc+1;//栈腾出环境变量的空间，最后一个放NULL
envp = (char **) sp;//main中的envp二重指针
sp -= argc+1;//腾出参数空间
argv = (char **) sp;//main中的argv二重指针
 //将传参放入栈中argc argv envp
put_user((unsigned long) envp,--sp);
put_user((unsigned long) argv,--sp);
put_user(argc,--sp);
 //这个是在execve中的传参地址
current-&gt;mm-&gt;arg_start = (unsigned long) p;

 //p因为put_dirty_page处于用户空间，c在系统空间
 //这里复制argv
while (argc--&gt;0) {
	char c;
	put_user(p,argv++);
	do {
		get_user(c,p++);
	} while (c);
}
put_user(NULL,argv);
current-&gt;mm-&gt;arg_end = current-&gt;mm-&gt;env_start = (unsigned long) p;
 //这里复制env
while (envc--&gt;0) {
	char c;
	put_user(p,envp++);
	do {
		get_user(c,p++);
	} while (c);
}
put_user(NULL,envp);
current-&gt;mm-&gt;env_end = (unsigned long) p;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>966</x>
      <y>1082</y>
      <w>16</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>658</x>
      <y>1056</y>
      <w>309</w>
      <h>25</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
current-&gt;mm-&gt;start_stack
step5:充实栈
</panel_attributes>
    <additional_attributes>10.0;10.0;3070.0;230.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1019</x>
      <y>1075</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>start_thread</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1020</x>
      <y>1087</y>
      <w>37</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>__asm__("movl %0,%%fs ; movl %0,%%gs": :"r" (0));	\
set_fs(USER_DS);					\
regs-&gt;xds = __USER_DS;					\
regs-&gt;xes = __USER_DS;					\
regs-&gt;xss = __USER_DS;					\
regs-&gt;xcs = __USER_CS;					\
regs-&gt;eip = new_eip;					\
regs-&gt;esp = new_esp;					\
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1024</x>
      <y>1078</y>
      <w>16</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
设置段，ip esp</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>659</x>
      <y>1056</y>
      <w>367</w>
      <h>21</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
ex.a_entry, current-&gt;mm-&gt;start_stack
step6:设置从系统空间返回用户空间的参数设置</panel_attributes>
    <additional_attributes>10.0;10.0;3650.0;190.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1126</x>
      <y>1050</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>load_script</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1072</x>
      <y>1064</y>
      <w>47</w>
      <h>26</h>
    </coordinates>
    <panel_attributes>1.错误检查，要以#！开头
	标志为shell bprm-&gt;sh_bang++
	释放文件
	allow_write_access(bprm-&gt;file);
	fput(bprm-&gt;file);
	bprm-&gt;file = NULL;
2.首先标志出头128字节的字符串在哪里结束
	2.1字符串中的第一个“\n”
	2.2将最后的所有的空格和制表符去掉
3.分析出解释器的开始字符地址i_name，即在#！遇到的第一个不是
	空格 制表符 ‘\0’的字符。然后找到制表符结束地址，即找到
	空格 制表符 ‘\0’的字符，如果是空格 制表符，就将其替换成‘\0’
	顺便找到参数的开始地址i_arg
4.从bprm.page中移除环境变量，然后分别将bprm-&gt;filename i_arg i_name
	压入bprm.page
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1092</x>
      <y>1053</y>
      <w>43</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
字符串解析
参数压栈</panel_attributes>
    <additional_attributes>410.0;10.0;10.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1128</x>
      <y>1063</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>open_exec</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1133</x>
      <y>1053</y>
      <w>10</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
打开解释器</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1156</x>
      <y>1063</y>
      <w>17</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>bprm-&gt;file = file
prepare_binprm
search_binary_handler
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1133</x>
      <y>1053</y>
      <w>30</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
重新组装linux_binprm
然后找到shell的执行器执行</panel_attributes>
    <additional_attributes>10.0;10.0;280.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>619</x>
      <y>1121</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>cap_intersect</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>624</x>
      <y>1104</y>
      <w>73</w>
      <h>19</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将两者相与
这里与的是：
 //cap_bset是第CAP_SETPCAP位为0
new_permitted：bprm-&gt;cap_permitted, cap_bset
working：bprm-&gt;cap_inheritable,current-&gt;cap_inheritable</panel_attributes>
    <additional_attributes>710.0;10.0;130.0;150.0;10.0;170.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>637</x>
      <y>1123</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>cap_combine</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>642</x>
      <y>1104</y>
      <w>55</w>
      <h>21</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将两者相或
这里或的是：
new_permitted：new_permitted, working</panel_attributes>
    <additional_attributes>530.0;10.0;190.0;160.0;10.0;190.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>660</x>
      <y>1104</y>
      <w>51</w>
      <h>20</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
bprm-&gt;e_uid != current-&gt;uid || bprm-&gt;e_gid != current-&gt;gid ||
 !cap_issubset(new_permitted, current-&gt;cap_permitted)
 这里是测试是否有超出父进程的权限，cap_issubset表示第一个是第二个的子集
 如果有</panel_attributes>
    <additional_attributes>350.0;10.0;150.0;180.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>658</x>
      <y>1121</y>
      <w>19</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>170.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>652</x>
      <y>1125</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;dumpable = 0
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>675</x>
      <y>1121</y>
      <w>31</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
must_not_trace_exec(current)
|| atomic_read(&amp;current-&gt;fs-&gt;count) &gt; 1
|| atomic_read(&amp;current-&gt;files-&gt;count) &gt; 1
|| atomic_read(&amp;current-&gt;sig-&gt;count) &gt; 1
 不允许trace 共用fs files sig</panel_attributes>
    <additional_attributes>10.0;10.0;60.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>660</x>
      <y>1127</y>
      <w>22</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
！CAP_SETUID
进程不允许setuid位</panel_attributes>
    <additional_attributes>200.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>648</x>
      <y>1133</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>bprm-&gt;e_uid = current-&gt;uid;
bprm-&gt;e_gid = current-&gt;gid;
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>680</x>
      <y>1127</y>
      <w>22</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
！CAP_SETPCAP
进程不允许超出父进程的权限</panel_attributes>
    <additional_attributes>10.0;10.0;200.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>678</x>
      <y>1134</y>
      <w>28</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>new_permitted&amp;=current-&gt;cap_permitted
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>712</x>
      <y>1127</y>
      <w>40</w>
      <h>14</h>
    </coordinates>
    <panel_attributes> //不是init进程（pid！=1）
current-&gt;cap_permitted = new_permitted;
current-&gt;cap_effective =
		cap_intersect(new_permitted, bprm-&gt;cap_effective);
 //对于所有的进程
current-&gt;suid = current-&gt;euid = current-&gt;fsuid = bprm-&gt;e_uid;
current-&gt;sgid = current-&gt;egid = current-&gt;fsgid = bprm-&gt;e_gid;
current-&gt;keep_capabilities = 0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>694</x>
      <y>1104</y>
      <w>36</w>
      <h>25</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
OMAGIC</panel_attributes>
    <additional_attributes>10.0;10.0;340.0;230.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>728</x>
      <y>918</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_execve</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>581</x>
      <y>939</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>getname</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>586</x>
      <y>921</y>
      <w>149</w>
      <h>20</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1470.0;10.0;10.0;180.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>543</x>
      <y>947</y>
      <w>9</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__getname
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>547</x>
      <y>942</y>
      <w>40</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>380.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>515</x>
      <y>957</y>
      <w>36</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kmem_cache_alloc(names_cachep, SLAB_KERNEL)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>531</x>
      <y>950</y>
      <w>19</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>170.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>565</x>
      <y>948</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_getname</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>569</x>
      <y>942</y>
      <w>18</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>558</x>
      <y>951</y>
      <w>13</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>553</x>
      <y>958</y>
      <w>35</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>filter:
1.filename的地址不在用户空间
current-&gt;addr_limit要和KERNEL_DS相等
2.如果在filename用户空间，如果距离用户空间的长度
小于1页，则为实际长度，否则为一页的长度
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>589</x>
      <y>958</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>strncpy_from_user</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>571</x>
      <y>951</y>
      <w>28</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;260.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>592</x>
      <y>961</y>
      <w>15</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
access_ok
对filename有读的权限</panel_attributes>
    <additional_attributes>30.0;10.0;110.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>590</x>
      <y>966</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__do_strncpy_from_user</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>586</x>
      <y>974</y>
      <w>40</w>
      <h>22</h>
    </coordinates>
    <panel_attributes>"	testl %1,%1\n"					   \
"	jz 2f\n"					   \如果count=0，就不复制
"0:	lodsb\n"					   \否则加载esi的一个字节到al
"	stosb\n"					   \将al中的数装载到edi中
"	testb %%al,%%al\n"				   \
"	jz 1f\n"					   \如果al=0，则退出复制
"	decl %1\n"					   \count--
"	jnz 0b\n"					   \继续复制
"1:	subl %1,%0\n"		\//计算出字符的长度res=res-count
"2:\n"
: "=d"(res), "=c"(count), "=&amp;a" (__d0), "=&amp;S" (__d1),	   \
  "=&amp;D" (__d2)						   \
: "i"(-EFAULT), "0"(count), "1"(count), "3"(src), "4"(dst) \
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>598</x>
      <y>969</y>
      <w>20</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
fixup和__ex_table
参考__copy_user_zeroing</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>571</x>
      <y>951</y>
      <w>45</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;430.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>608</x>
      <y>959</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>如果正确返回0
不正确返回错误代码
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>584</x>
      <y>942</y>
      <w>17</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
正确的话返回装有
复制过来的filename
的slab</panel_attributes>
    <additional_attributes>10.0;10.0;40.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>583</x>
      <y>949</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>return result
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>732</x>
      <y>921</y>
      <w>94</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
1.空指针检查
2.是否超过上限（-1000）这里转换成无符号数</panel_attributes>
    <additional_attributes>10.0;10.0;920.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>818</x>
      <y>931</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_execve
主要工作：
1.加载可执行文件
2.复制参数到linux_binprm
3.寻找到执行模块执行</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>623</x>
      <y>952</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>open_exec</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>628</x>
      <y>934</y>
      <w>198</w>
      <h>20</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1960.0;10.0;10.0;180.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>645</x>
      <y>953</y>
      <w>49</w>
      <h>49</h>
    </coordinates>
    <panel_attributes> //因为有一个arg[0],所以减去一个指针的长度，总共传参大侠最大为32页
bprm.p = PAGE_SIZE*MAX_ARG_PAGES-sizeof(void *);
memset(bprm.page, 0, MAX_ARG_PAGES*sizeof(bprm.page[0])); 

bprm.file = file;
bprm.filename = filename;
bprm.sh_bang = 0;//1表示shell，0表示二进制文件
bprm.loader = 0;
bprm.exec = 0;
 //计算传参的数目
bprm.argc = count(argv, bprm.p / sizeof(void *))
			//这里的count是计算argv的数目，直到*argv为NUll
			__get_user_4:
			addl $3,%eax //eax在get_user中定义为ptr（argv）
							//和返回值的值
			movl %esp,%edx
			jc bad_get_user
			andl $0xffffe000,%edx//edx设置为task的2k页面
			cmpl addr_limit(%edx),%eax//比较装载的ptr是否超过界限
			jae bad_get_user
		3:	movl -3(%eax),%edx//这里将*argv的值赋给edx，edx在get_user
									//中定义为装载*argv的指针
			xorl %eax,%eax//将eax赋值为0，即返回值为0
			ret	
bprm.envc = count(envp, bprm.p / sizeof(void *))
	//因为在open_exec中通过deny_write_access将文件写给锁住，
	//所以如果出现错误，需要通过allow_write_access将文件写打开
	//并且通过fput（file）将文件释放
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>661</x>
      <y>934</y>
      <w>165</w>
      <h>21</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
linux_binprm
装有可执行程序的信息</panel_attributes>
    <additional_attributes>1630.0;10.0;10.0;190.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>749</x>
      <y>951</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>prepare_binprm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>753</x>
      <y>934</y>
      <w>74</w>
      <h>19</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
读取前128字节</panel_attributes>
    <additional_attributes>720.0;10.0;10.0;170.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>835</x>
      <y>950</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_strings_kernel</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>825</x>
      <y>934</y>
      <w>24</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制filename到系统空间</panel_attributes>
    <additional_attributes>10.0;10.0;220.0;160.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>810</x>
      <y>959</y>
      <w>23</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>oldfs = get_fs()(current.addr_limit)
set_fs(KERNEL_DS)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>860</x>
      <y>959</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>set_fs(oldfs)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>819</x>
      <y>953</y>
      <w>26</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>240.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>842</x>
      <y>953</y>
      <w>26</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;240.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>838</x>
      <y>959</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_strings</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>842</x>
      <y>953</y>
      <w>16</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
赋值argv到系统空间</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>823</x>
      <y>967</y>
      <w>52</w>
      <h>38</h>
    </coordinates>
    <panel_attributes>1.循环argc，直到结束
2.通过get_user从后向前复制**argv到str，检查str不为空
	通过strnlen_user计算str的长度
		mask = -__addr_ok(s); //如果地址满足要求mask为0xFFFFFFFF,否则为0
		"	andl %0,%%ecx\n"//正确ecx为n，否则为0，
		"0:	repne; scasb\n"//将edi（s）中的字节和al比较，如果不同则ecx--,
						//然后继续，如果相同，则停止
		"	setne %%al\n"//将eflag中的zf取反赋给al
		"	subl %%ecx,%0\n"//n=n-ecx 即s的长度
		"	addl %0,%%eax\n"//eax=0+n即为s的长度为返回值
		"1:\n"
		:"=r" (n), "=D" (s), "=a" (res), "=c" (tmp)
		:"0" (n), "1" (s), "2" (0), "3" (mask)
		:"cc");
	错误性检查str的长度len不能查超过最大长度bprm-&gt;p
3.将最大长度bprm-&gt;p更新，以便检查下一个argv
4.找到这个argv在bprm-&gt;page中的位置，如果这个page没有物理内存，就申请一个
	bprm-&gt;page[i] = page，并将这一页中这个argv没用到的部分全部清0，
	并通过copy_from_user将argv复制到申请的内存中
5.然后通过下面更新局部变量，然后再次循环
	pos += bytes_to_copy;
	str += bytes_to_copy;
	len -= bytes_to_copy;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>842</x>
      <y>962</y>
      <w>4</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>855</x>
      <y>950</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>bprm.exec = bprm.p
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>879</x>
      <y>949</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_strings</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>825</x>
      <y>934</y>
      <w>34</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;320.0;160.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>826</x>
      <y>934</y>
      <w>60</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制参数和环境变量到
bprm-&gt;page</panel_attributes>
    <additional_attributes>10.0;10.0;580.0;150.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>896</x>
      <y>949</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>search_binary_handler</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>824</x>
      <y>934</y>
      <w>83</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
找到执行模块
</panel_attributes>
    <additional_attributes>10.0;10.0;810.0;150.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>877</x>
      <y>958</y>
      <w>68</w>
      <h>30</h>
    </coordinates>
    <panel_attributes>1.遍历formats链表，通过函数指针fmt-&gt;load_binary加载指定的bprm（二进制文件或者解释文件）
2.如果加载成功
	if (retval &gt;= 0) {
		put_binfmt(fmt);//释放动态安装模块
		allow_write_access(bprm-&gt;file);//释放文件写
		if (bprm-&gt;file)
			fput(bprm-&gt;file);//释放文件
		bprm-&gt;file = NULL;
		current-&gt;did_exec = 1;
		return retval;//返回成功标志
	}
3.如果没成功，通过put_binfmt(fmt)释放模块。
		如果返回值不是-ENOEXEC，说明该模块可以执行这个文件，但是却出现了其他错误，直接break
		如果bprm-&gt;file不存在，即可执行文件不存在，直接退出
		否则继续遍历下一个动态安装模块
4.如果遍历完formats链表中的所有模块，都没有执行，则通过request_module请求可以执行这个文件的动态
	安装模块
5.找到模块之后再次遍历整个formats链表
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>904</x>
      <y>952</y>
      <w>7</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;50.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>657</x>
      <y>987</y>
      <w>250</w>
      <h>68</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>2480.0;10.0;1810.0;450.0;10.0;660.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>904</x>
      <y>987</y>
      <w>227</w>
      <h>65</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1190.0;580.0;2250.0;630.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>701</x>
      <y>954</y>
      <w>57</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>550.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>698</x>
      <y>960</y>
      <w>24</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>1.取出file中的inode，检查其mode
2.检查file相关的文件操作是否存在
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>724</x>
      <y>960</y>
      <w>20</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>bprm-&gt;e_uid = current-&gt;euid;
	bprm-&gt;e_gid = current-&gt;egid;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>733</x>
      <y>954</y>
      <w>26</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>240.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>713</x>
      <y>964</y>
      <w>24</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
(inode)-&gt;i_sb-&gt;s_flag（超级块标志）
超级块中不存在MS_NOSUID</panel_attributes>
    <additional_attributes>200.0;10.0;30.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>701</x>
      <y>969</y>
      <w>33</w>
      <h>8</h>
    </coordinates>
    <panel_attributes> //如果inode的mode标记上了S_ISUID
bprm-&gt;e_uid = inode-&gt;i_uid;
 //如果inode的mode标记上了S_ISGID | S_IXGRP
bprm-&gt;e_gid = inode-&gt;i_gid
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>745</x>
      <y>961</y>
      <w>24</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>cap_clear(bprm-&gt;cap_inheritable);
cap_clear(bprm-&gt;cap_permitted);
cap_clear(bprm-&gt;cap_effective);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>752</x>
      <y>954</y>
      <w>17</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
普通用户得到的授权</panel_attributes>
    <additional_attributes>40.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>756</x>
      <y>954</y>
      <w>29</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果SECUREBITS_DEFAULT中
SECURE_NOROOT位置上</panel_attributes>
    <additional_attributes>10.0;10.0;270.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>768</x>
      <y>960</y>
      <w>16</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
bprm-&gt;e_uid == 0 || 
current-&gt;uid == 0</panel_attributes>
    <additional_attributes>140.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>760</x>
      <y>969</y>
      <w>24</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>cap_set_full(bprm-&gt;cap_inheritable);
cap_set_full(bprm-&gt;cap_permitted);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>785</x>
      <y>970</y>
      <w>22</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>cap_set_full(bprm-&gt;cap_effective)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>782</x>
      <y>960</y>
      <w>16</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
bprm-&gt;e_uid == 0</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>789</x>
      <y>960</y>
      <w>7</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>memset
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>756</x>
      <y>954</y>
      <w>37</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
bprm-&gt;buf,0,BINPRM_BUF_SIZE</panel_attributes>
    <additional_attributes>10.0;10.0;350.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>797</x>
      <y>959</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kernel_read</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>755</x>
      <y>954</y>
      <w>49</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;470.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>256</x>
      <y>1248</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1251</y>
      <w>42</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
filter：!current-&gt;active_mm
	in_interrupt 不能再interrupt中调度
 //如果还有bh没有执行，先去执行相应的中断，然后再schedule
	softirq_active(this_cpu) &amp; softirq_mask(this_cpu)</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>196</x>
      <y>1268</y>
      <w>26</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>sched_data = 
&amp; aligned_data[this_cpu].schedule_data
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>206</x>
      <y>1259</y>
      <w>57</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>550.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>239</x>
      <y>1259</y>
      <w>24</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
SCHED_RR</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>231</x>
      <y>1267</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>move_rr_last
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>234</x>
      <y>1270</y>
      <w>13</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!prev-&gt;counter</panel_attributes>
    <additional_attributes>40.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>218</x>
      <y>1274</y>
      <w>19</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>170.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>205</x>
      <y>1278</y>
      <w>20</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>prev-&gt;counter = 
NICE_TO_TICKS(prev-&gt;nice)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>236</x>
      <y>1279</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>move_last_runqueue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>234</x>
      <y>1274</y>
      <w>12</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;100.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>224</x>
      <y>1286</y>
      <w>29</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>list_del(&amp;p-&gt;run_list);
list_add_tail(&amp;p-&gt;run_list, &amp;runqueue_head)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>238</x>
      <y>1282</y>
      <w>7</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>50.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>10</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
prev-&gt;state</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1267</y>
      <w>18</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TASK_INTERRUPTIBLE</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>254</x>
      <y>1271</y>
      <w>11</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
signal_pending</panel_attributes>
    <additional_attributes>70.0;10.0;30.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>248</x>
      <y>1275</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>prev-&gt;state = TASK_RUNNING
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>273</x>
      <y>1275</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>del_from_runqueue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1271</y>
      <w>23</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;210.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1267</y>
      <w>23</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
default</panel_attributes>
    <additional_attributes>10.0;10.0;210.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1267</y>
      <w>38</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TASK_RUNNING</panel_attributes>
    <additional_attributes>10.0;10.0;360.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>290</x>
      <y>1275</y>
      <w>9</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>不变
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>305</x>
      <y>1275</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>prev-&gt;need_resched = 0
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>53</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;510.0;160.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>326</x>
      <y>1275</y>
      <w>18</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>next = idle_task(this_cpu);
	c = -1000;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>261</x>
      <y>1259</y>
      <w>77</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果runqueue_head中没有task
会默认选idle_task</panel_attributes>
    <additional_attributes>10.0;10.0;750.0;160.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>346</x>
      <y>1275</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>still_running
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>261</x>
      <y>1259</y>
      <w>95</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
prev-&gt;state == TASK_RUNNING</panel_attributes>
    <additional_attributes>10.0;10.0;930.0;160.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>335</x>
      <y>1284</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>goodness</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>351</x>
      <y>1284</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>next = prev
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>350</x>
      <y>1278</y>
      <w>9</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>339</x>
      <y>1278</y>
      <w>13</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>293</x>
      <y>1287</y>
      <w>50</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
SCHED_YIELD
礼让</panel_attributes>
    <additional_attributes>480.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>287</x>
      <y>1296</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>weight=-1
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>317</x>
      <y>1287</y>
      <w>26</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
SCHED_OTHER
(交互式应用：注重响应时间)</panel_attributes>
    <additional_attributes>240.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>313</x>
      <y>1296</y>
      <w>35</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>weight = p-&gt;counter //如果时间片用完，就直接退出
weight += 1 //p-&gt;mm == this_mm || !p-&gt;mm
				//如果是当前进程或者是内核线程
weight += 20 - p-&gt;nice
		//如果之前存在时间片，加大其时间片
		nice是19~-20，表示谦让程度

halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>340</x>
      <y>1287</y>
      <w>20</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
实时性进程
SCHED_FIFO //执行时间较短
SCHED_RR //执行时间较长
</panel_attributes>
    <additional_attributes>10.0;10.0;180.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>353</x>
      <y>1297</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>weight = 1000 + p-&gt;rt_priority
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>114</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;1120.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>366</x>
      <y>1273</y>
      <w>18</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>遍历整个runqueue_head
找到goodness最大的task
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>140</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
所有TASK_RUNNING的task的时间片都用完了
!c</panel_attributes>
    <additional_attributes>10.0;10.0;1380.0;150.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>387</x>
      <y>1274</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>recalculate
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>368</x>
      <y>1283</y>
      <w>39</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>p-&gt;counter = (p-&gt;counter &gt;&gt; 1) + NICE_TO_TICKS(p-&gt;nice)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>380</x>
      <y>1277</y>
      <w>23</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
对所有的task重新分配时间片
然后再次找到最大的执行全的task</panel_attributes>
    <additional_attributes>150.0;10.0;70.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>406</x>
      <y>1274</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sched_data-&gt;curr = next
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>155</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1530.0;150.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>179</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
prev == next</panel_attributes>
    <additional_attributes>10.0;10.0;1770.0;150.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>429</x>
      <y>1274</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>same_process
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>433</x>
      <y>1277</y>
      <w>5</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>414</x>
      <y>1281</y>
      <w>33</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>如果need_resched置上，则重新执行一边schedule
否则return
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>446</x>
      <y>1274</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kstat.context_swtch++
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>192</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1900.0;150.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>219</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;2170.0;120.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>466</x>
      <y>1270</y>
      <w>13</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
切换为内核线程
!mm
复用之前task的mm</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>449</x>
      <y>1280</y>
      <w>22</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>next-&gt;active_mm = oldmm;
atomic_inc(&amp;oldmm-&gt;mm_count);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>476</x>
      <y>1270</y>
      <w>14</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
切换为用户进程</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>481</x>
      <y>1280</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>switch_mm
(reference)</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>476</x>
      <y>1270</y>
      <w>34</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!prev-&gt;mm
要切换的task是内核线程或者是
exit的用户进程</panel_attributes>
    <additional_attributes>10.0;10.0;320.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>498</x>
      <y>1279</y>
      <w>18</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>prev-&gt;active_mm = NULL;
			mmdrop(oldmm);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>526</x>
      <y>1270</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>switch_to</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>274</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;2720.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>596</x>
      <y>1269</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__schedule_tail</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>602</x>
      <y>1272</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>260</x>
      <y>1259</y>
      <w>343</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;3410.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>518</x>
      <y>1283</y>
      <w>69</w>
      <h>63</h>
    </coordinates>
    <panel_attributes>asm volatile("pushl %%esi\n\t"					\
"pushl %%edi\n\t"					\
"pushl %%ebp\n\t"					\
"movl %%esp,%0\n\t"	/* save ESP */		\
 //这里切换了系统栈
"movl %3,%%esp\n\t"	/* restore ESP */	\
	//这里保存了pre进程再次调用时的返回地址
"movl $1f,%1\n\t"		/* save EIP */		
 //对于初次fork的进程，这里压栈的是ret_from_fork
 //对于经历过schedule的进程，这里压栈是1f
 //对于linux0.11而言，返回地址是用户空间的系统调用，因为cs：ip被赋值为用户空间
 //对于2.4.0而言，返回地址是系统空间，不管是新创建的进程（ret_from_fork）还是schedule过的进程（1f）
 //cs：ip都是指向系统空间的
"pushl %4\n\t"		/* restore EIP */	\
"jmp __switch_to\n"				\
"1:\t"						\
"popl %%ebp\n\t"					\
"popl %%edi\n\t"					\
"popl %%esi\n\t"					\
:"=m" (prev-&gt;thread.esp),"=m" (prev-&gt;thread.eip),	\
"=b" (last)					\
:"m" (next-&gt;thread.esp),"m" (next-&gt;thread.eip),	\
"a" (prev), "d" (next),				\
"b" (prev));					\

注：根据i386 ABI规则
eax ecx edx eflag在编译的时候如果调用者后期需要用，需要将其
压栈保护
esi edi ebx ebp esp会由被调用者保护，所以在被使用的时候会将这些寄存器
压栈保护
所以这些通用寄存器如果后期会用到，会在编译的时候进行保护

注：ebp被用来访问栈，首次进入一个函数中栈中：
		函数参数
		ip
esp：	上一个函数的ebp
将esp的地址复制给ebp，成为本函数访问栈空间的基址，访问传参使用ebp+（例如访问第一个参数（ebp+8））
访问本函数的占空间使用ebp-。
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>531</x>
      <y>1273</y>
      <w>3</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>543</x>
      <y>1349</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>_switch_to</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>548</x>
      <y>1344</y>
      <w>36</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
注：_switch_to的申明是被FASTCALL修饰过的
根据GUN的编译规则regparm(3)，是通过eax edx ecx
依次传参，其余的是通过栈传参
所以这里能将prev和next指针传递进来</panel_attributes>
    <additional_attributes>20.0;20.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>530</x>
      <y>1357</y>
      <w>36</w>
      <h>14</h>
    </coordinates>
    <panel_attributes> //保存系统堆栈的地址到TSS中，以便之后在用户空间
 //发生中断 异常的时候，能进行堆栈的切换
 //ss不用变，因为用的是同一个TSS
tss-&gt;esp0 = next-&gt;esp0
asm volatile("movl %%fs,%0":"=m" (*(int *)&amp;prev-&gt;fs));
asm volatile("movl %%gs,%0":"=m" (*(int *)&amp;prev-&gt;gs));
loadsegment(fs, next-&gt;fs);
loadsegment(gs, next-&gt;gs);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>547</x>
      <y>1352</y>
      <w>4</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1575</x>
      <y>1255</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>wake_up_process </panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1569</x>
      <y>1258</y>
      <w>15</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>130.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1556</x>
      <y>1264</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>p-&gt;state = TASK_RUNNING
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1581</x>
      <y>1258</y>
      <w>22</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果在调度链表中
task_on_runqueue
 //调度链表是一个循环链表
p-&gt;run_list.next != NULL</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1582</x>
      <y>1268</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>out
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1581</x>
      <y>1258</y>
      <w>29</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
否则加入调度链表
并重新调度</panel_attributes>
    <additional_attributes>10.0;10.0;270.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1594</x>
      <y>1271</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>add_to_runqueue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1600</x>
      <y>1264</y>
      <w>9</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>70.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1623</x>
      <y>1271</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>reschedule_idle</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1606</x>
      <y>1264</y>
      <w>27</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;250.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1584</x>
      <y>1278</y>
      <w>28</w>
      <h>6</h>
    </coordinates>
    <panel_attributes> //list_add是头插
list_add(&amp;p-&gt;run_list, &amp;runqueue_head);
nr_running++;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1597</x>
      <y>1274</y>
      <w>5</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1610</x>
      <y>1285</y>
      <w>19</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tsk = cpu_curr(this_cpu)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1614</x>
      <y>1274</y>
      <w>22</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
获取正在调度的task
schedule_data.curr
不用current，因为在schedule
中准备切栈的之前，已经决定出了
要调度的task</panel_attributes>
    <additional_attributes>160.0;10.0;50.0;110.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1630</x>
      <y>1274</y>
      <w>28</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
preemption_goodness
比较两个task之间的权重
如果要唤醒的task权重比
调度的task的权重大</panel_attributes>
    <additional_attributes>10.0;10.0;260.0;120.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1647</x>
      <y>1286</y>
      <w>19</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tsk-&gt;need_resched = 1
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1015</x>
      <y>1259</y>
      <w>20</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_sched_setscheduler</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1043</x>
      <y>1259</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_sched_setparam</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1026</x>
      <y>1275</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>setscheduler</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1022</x>
      <y>1262</y>
      <w>20</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
pid, policy, param</panel_attributes>
    <additional_attributes>10.0;10.0;130.0;130.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1035</x>
      <y>1262</y>
      <w>18</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
pid, -1, param</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;130.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1034</x>
      <y>1278</y>
      <w>13</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
filter:
!param || pid &lt; 0</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>993</x>
      <y>1282</y>
      <w>45</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
从用户空间复制param</panel_attributes>
    <additional_attributes>430.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>988</x>
      <y>1291</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_from_user
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1004</x>
      <y>1291</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>find_process_by_pid</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1012</x>
      <y>1282</y>
      <w>25</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>230.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1009</x>
      <y>1294</y>
      <w>20</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果pid为0，就返回current
否则</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1001</x>
      <y>1303</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>find_task_by_pid</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>997</x>
      <y>1310</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>从pidhash中查找pid相同的task
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1004</x>
      <y>1306</y>
      <w>5</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1023</x>
      <y>1292</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>policy&lt;0，
则用进程原本的policy
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1027</x>
      <y>1282</y>
      <w>10</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>80.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1044</x>
      <y>1293</y>
      <w>36</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>1.lp.sched_priority要在0~99
2.policy == SCHED_OTHER的时候
	lp.sched_priority == 0
3.如果切换实时策略
	policy == SCHED_FIFO || policy == SCHED_RR
	需要的current-&gt;cap_effective的CAP_SYS_NICE
	位置上
4.如果当前进程和要设置的进程的euid和uid都不相同
	同样也需要current-&gt;cap_effective的CAP_SYS_NICE
	位置上
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1034</x>
      <y>1282</y>
      <w>16</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
filter</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1083</x>
      <y>1292</y>
      <w>22</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>p-&gt;policy = policy;
p-&gt;rt_priority = lp.sched_priority;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1033</x>
      <y>1282</y>
      <w>62</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;600.0;100.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1034</x>
      <y>1282</y>
      <w>82</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
task_on_runqueue
如果在调度链表中
将task移到链表的最前端</panel_attributes>
    <additional_attributes>10.0;10.0;800.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1107</x>
      <y>1291</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>move_first_runqueue
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1126</x>
      <y>1291</y>
      <w>19</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;need_resched = 1
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1034</x>
      <y>1283</y>
      <w>101</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;990.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1151</x>
      <y>1255</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_sched_yield</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1158</x>
      <y>1258</y>
      <w>22</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果有其他task在就绪链表中
nr_pending--</panel_attributes>
    <additional_attributes>10.0;10.0;30.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1148</x>
      <y>1264</y>
      <w>26</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>if (current-&gt;policy == SCHED_OTHER)
	current-&gt;policy |= SCHED_YIELD;
	current-&gt;need_resched = 1
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1311</x>
      <y>1250</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_nanosleep</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1221</x>
      <y>1262</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>copy_from_user</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1226</x>
      <y>1253</y>
      <w>93</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制用户空间的规定的时间rqtp</panel_attributes>
    <additional_attributes>910.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1246</x>
      <y>1253</y>
      <w>74</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
filter</panel_attributes>
    <additional_attributes>720.0;10.0;10.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1241</x>
      <y>1264</y>
      <w>18</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>t.tv_nsec &gt;= 1000000000L
|| t.tv_nsec &lt; 0 
|| t.tv_sec &lt; 0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1290</x>
      <y>1253</y>
      <w>32</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
t.tv_sec == 0 &amp;&amp; t.tv_nsec &lt;= 2000000L &amp;&amp;
current-&gt;policy != SCHED_OTHER
如果定义小于2ms，并且是实时进程
因为时钟中断是10ms，如果让进程睡，很可能会
错过这个时间，所以用延时

转化为us</panel_attributes>
    <additional_attributes>280.0;10.0;30.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1288</x>
      <y>1267</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>udelay</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1288</x>
      <y>1274</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__udelay</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1294</x>
      <y>1270</y>
      <w>19</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将延时的时间换算成loops
然后递减</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1289</x>
      <y>1283</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__const_udelay</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1293</x>
      <y>1277</y>
      <w>29</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
微秒换算为秒
但是这个值太小，所以先将其左移32位，
然后再换算为秒</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1290</x>
      <y>1291</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__delay</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1294</x>
      <y>1286</y>
      <w>25</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
秒换算成loops
将 秒*loops_per_jiffy*hz
loops_per_jiffy：10ms内loop的个数
hz：100，即jiffy*hz为1s</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1291</x>
      <y>1298</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__loop_delay</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1296</x>
      <y>1294</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1288</x>
      <y>1305</y>
      <w>17</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>递减loops，直到loops为0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1296</x>
      <y>1301</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1312</x>
      <y>1266</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>timespec_to_jiffies</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1317</x>
      <y>1253</y>
      <w>18</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
1000000000L / HZ
表示每个jiffy需要多少ns</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1334</x>
      <y>1266</y>
      <w>27</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;state = TASK_INTERRUPTIBLE
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1317</x>
      <y>1253</y>
      <w>30</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;280.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1367</x>
      <y>1266</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>schedule_timeout</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1317</x>
      <y>1253</y>
      <w>60</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
注意到这如果t.tv_sec || t.tv_nsec有值
最小的的expire时间为2

如果时间没到就被唤醒，返回的是expire-jiffies，否则为0</panel_attributes>
    <additional_attributes>10.0;10.0;580.0;130.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1369</x>
      <y>1269</y>
      <w>8</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>60.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1335</x>
      <y>1273</y>
      <w>37</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
MAX_SCHEDULE_TIMEOUT
如果是最大值，表示无限期延长
就不计时唤醒，直接schedule</panel_attributes>
    <additional_attributes>350.0;10.0;10.0;130.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1351</x>
      <y>1273</y>
      <w>21</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
timeout &lt; 0</panel_attributes>
    <additional_attributes>190.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1330</x>
      <y>1286</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>schedule();
goto out
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1347</x>
      <y>1287</y>
      <w>23</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;state = TASK_RUNNING;
goto out;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1374</x>
      <y>1269</y>
      <w>13</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
唤醒的绝对时间</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1369</x>
      <y>1280</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>expire = timeout + jiffies
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1388</x>
      <y>1281</y>
      <w>26</w>
      <h>16</h>
    </coordinates>
    <panel_attributes> //初始化timer指针
init_timer(&amp;timer);
	//定时绝对时间
timer.expires = expire;
	//时间到了之后唤醒进程，作为function
	//的传参
timer.data = (unsigned long) current;
	//时间到了之后的函数
timer.function = process_timeout
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1374</x>
      <y>1269</y>
      <w>33</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
设置定时时间</panel_attributes>
    <additional_attributes>10.0;10.0;310.0;120.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1419</x>
      <y>1281</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>add_timer</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1374</x>
      <y>1269</y>
      <w>52</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;500.0;120.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1420</x>
      <y>1288</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>internal_add_timer</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1423</x>
      <y>1284</y>
      <w>15</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
首先进行错误检查
timer不能在链表中</panel_attributes>
    <additional_attributes>10.0;10.0;30.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1415</x>
      <y>1295</y>
      <w>56</w>
      <h>32</h>
    </coordinates>
    <panel_attributes>1.jiffies是一个32位的数，linux中将这32位转化成6+6+6+6+8
2.如果偏移值小于256，则将时间戳放在tv1.vec对应的数组中
	（数组中的每个list_head都对应具体的一个时间戳）
	如果偏移值大于256，但是小于1&lt;&lt;(6+8),则将1组时间戳存放在
	tv2.vec对应的数组中（例如：0x187和0x101在这个数组中同一个
	位置的队列中），依次类推。
	当低8位的时间戳用完之后，会向高6位的数组借一位，并且通过再次通过
	internal_add_timer将这一组队列重新排布，（具体见run_timer_list
	--&gt;cascade_timers）以此类推。
3.list_add(&amp;timer-&gt;list, vec-&gt;prev)将timer加到队列的最尾端
注：1.如果设置的时间戳expires小于timer_jiffies（以及处理的时间戳+1），
	则这个时间点已经过去，就用timer就加到timer_jiffies所在的队列
	（tv1.vec + tv1.index）
	2.判断作为哪里容纳timer时间戳的条件是偏移值，但是容纳的点却是绝对值
	试想：如果timer_jiffies运行到一个位置，而来了一个256+timer_jiffies-3
	（timer_jiffies&gt;3）的时间戳，按照条件，这个应该存储到tv1.vec，但是存储的点
	却是timer_jiffies-3的位置，此时队列应该是空的（因为已经运行过）。
	3.除了tv1.vec[0]中有队列外，其他的4个数组中的第一项都是没有队列的，这一点可以由
	 判断条件得到
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1426</x>
      <y>1291</y>
      <w>9</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1438</x>
      <y>1280</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1454</x>
      <y>1280</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1375</x>
      <y>1269</y>
      <w>69</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;670.0;110.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1376</x>
      <y>1269</y>
      <w>86</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果时间没到就被信号唤醒
</panel_attributes>
    <additional_attributes>10.0;10.0;840.0;110.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1316</x>
      <y>1253</y>
      <w>85</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
剩余时间转化成timespec
并复制到用户空间</panel_attributes>
    <additional_attributes>10.0;10.0;830.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1396</x>
      <y>1264</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>jiffies_to_timespec
copy_to_user
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1496</x>
      <y>1254</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_pause</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1489</x>
      <y>1265</y>
      <w>28</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>current-&gt;state = TASK_INTERRUPTIBLE;
schedule();
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1501</x>
      <y>1257</y>
      <w>4</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>589</x>
      <y>1276</y>
      <w>47</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>1.将prev.policy中的SCHED_YIELD清除，将prev.has_cpu置0，这两部都要
	将cache同步到内存，保证数据及时更新
2.如果prev的状态还是TASK_RUNNING
	1.如果时idle_task，或者之前要SCHED_YIELD，就不需要执行，return
	2.否则通过reschedule_idle看是否在其他核上是否能重新调度prev
3.如果prev状态是其他，直接return
注：此时虽然sp，ip已经更替，但是像eax等寄存器还是prev执行时的值
	因为switch_to把prev放在了eax中，所以切换到next之后，prev还能保持
	在prev执行时的值
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>607</x>
      <y>1295</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>reschedule_idle</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>612</x>
      <y>1291</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>591</x>
      <y>1302</y>
      <w>45</w>
      <h>24</h>
    </coordinates>
    <panel_attributes>1.先检查p之前运行的cpu（p-&gt;processor），
	如果可以在这个cpu上执行（can_schedule，has_cpu为0：没有cpu执行;cpus_allowed位图中当前cpu置上）
	如果cpu当前运行的task（cpu_curr）是idle_task
	tsk-&gt;need_resched = 1//如果是当前cpu，系统调用返回时就会调度p
	如果这个cpu不是当前cpu，并且之前need_resched没被置上，通过smp_send_reschedule通知cpu shcedule
2.遍历所有的cpu
	1.p要能在cpu上执行（can_schedule）
	2.如果cpu当前执行的task（cpu_curr）是idle_task，选取last_schedule最小的cpu
	3.如果执行的是其他task，选取goodness相差最大的cpu
	4.如果找到了cpu（target_tsk不为NULL）,
		1.如果cpu上执行的是idle_task，就去该cpu执行
		2.如果没有idle_task:
			tsk-&gt;need_resched = 1 //本cpu只要这个置上就可以了
			smp_send_reschedule(tsk-&gt;processor)//如果在其他cupu上，要通知其他cpu进中断
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>612</x>
      <y>1298</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>726</x>
      <y>1250</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_wait4</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>705</x>
      <y>1253</y>
      <w>52</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
options &amp; ~(WNOHANG|WUNTRACED|__WNOTHREAD|__WCLONE|__WALL)
option不能有除这些之外的其他的标志置上</panel_attributes>
    <additional_attributes>280.0;10.0;230.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>712</x>
      <y>1258</y>
      <w>20</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
&amp;current-&gt;wait_chldexit,&amp;wait</panel_attributes>
    <additional_attributes>160.0;10.0;30.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>709</x>
      <y>1263</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>add_wait_queue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>693</x>
      <y>1270</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>wait-&gt;flags = 0
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>698</x>
      <y>1266</y>
      <w>18</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>712</x>
      <y>1270</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__add_wait_queue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>705</x>
      <y>1266</y>
      <w>24</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将current.tasklist加入到
current.wait_chldexit.tasklist的链表中</panel_attributes>
    <additional_attributes>90.0;10.0;140.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>710</x>
      <y>1276</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>list_add</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>714</x>
      <y>1273</y>
      <w>6</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>40.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>726</x>
      <y>1258</y>
      <w>22</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
扫描当前进程所有线程的子进程
从最年轻的子进程开始查找
</panel_attributes>
    <additional_attributes>20.0;10.0;190.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>731</x>
      <y>1266</y>
      <w>16</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>140.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>726</x>
      <y>1272</y>
      <w>33</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>pid符合要求的子进程
1.如果pid&gt;0，找到是进程号是pid的子进程
2.pid=0，找的是和当前进程同一个进程组的子进程
3.pid&lt;-1，找的是进程组号是-pid的子进程
4.pid=-1,所有的子进程

1.__WALL，表示不管是什么子进程都wait
2.如果__WALL没置上：
	__WCLONE置上，wait exit_signal不为SIGCHLD
	__WCLONE没置上，wait exit_signal为SIGCHLD
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>760</x>
      <y>1273</y>
      <w>8</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flag = 1
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>744</x>
      <y>1266</y>
      <w>23</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;210.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>743</x>
      <y>1266</y>
      <w>39</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;370.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>772</x>
      <y>1270</y>
      <w>17</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TASK_STOPPED</panel_attributes>
    <additional_attributes>70.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>778</x>
      <y>1270</y>
      <w>21</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TASK_ZOMBIE</panel_attributes>
    <additional_attributes>10.0;10.0;190.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>757</x>
      <y>1289</y>
      <w>29</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>current-&gt;times.tms_cutime += 
p-&gt;times.tms_utime + p-&gt;times.tms_cutime;
current-&gt;times.tms_cstime += 
p-&gt;times.tms_stime + p-&gt;times.tms_cstime;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>767</x>
      <y>1277</y>
      <w>32</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>300.0;10.0;10.0;120.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>795</x>
      <y>1277</y>
      <w>47</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;450.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>827</x>
      <y>1284</y>
      <w>17</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
p-&gt;p_opptr != p-&gt;p_pptr
生父和养父不一样</panel_attributes>
    <additional_attributes>130.0;10.0;30.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>821</x>
      <y>1289</y>
      <w>26</w>
      <h>14</h>
    </coordinates>
    <panel_attributes> //将子进程从之前养父的链表中删除
REMOVE_LINKS(p);
	//最后通知的还是生父去处理
p-&gt;p_pptr = p-&gt;p_opptr;
	//加到task序列和生父的宗族关系中
SET_LINKS(p);
	//通知新的养父去处理
do_notify_parent(p, SIGCHLD);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>878</x>
      <y>1291</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>release_task</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>838</x>
      <y>1284</y>
      <w>47</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;450.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>844</x>
      <y>1294</y>
      <w>43</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>410.0;10.0;10.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>828</x>
      <y>1305</y>
      <w>24</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>atomic_dec(&amp;p-&gt;user-&gt;processes);
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>855</x>
      <y>1305</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>free_uid</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>860</x>
      <y>1294</y>
      <w>27</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>250.0;10.0;10.0;110.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>859</x>
      <y>1308</y>
      <w>30</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
up &amp;&amp; atomic_dec_and_lock(&amp;up-&gt;__count</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>844</x>
      <y>1318</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uid_hash_remove</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>864</x>
      <y>1318</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kmem_cache_free</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>845</x>
      <y>1313</y>
      <w>23</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
pprev指向（指向自己的指针）
所以对pprev解引用赋值，就是改变
上一个next中的值</panel_attributes>
    <additional_attributes>150.0;10.0;70.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>859</x>
      <y>1313</y>
      <w>14</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>877</x>
      <y>1305</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>unhash_process</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>881</x>
      <y>1294</y>
      <w>6</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>40.0;10.0;10.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>880</x>
      <y>1313</y>
      <w>18</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>nr_threads--;
	//将p从pid hash中删除
unhash_pid(p);
	//解除其宗族关系
REMOVE_LINKS(p);
	//从线程中删除
list_del(&amp;p-&gt;thread_group)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>882</x>
      <y>1308</y>
      <w>8</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;60.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>896</x>
      <y>1304</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>release_thread</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>884</x>
      <y>1294</y>
      <w>20</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
mm在exit中被置成NULL</panel_attributes>
    <additional_attributes>10.0;10.0;180.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>911</x>
      <y>1305</y>
      <w>30</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>current-&gt;cmin_flt += p-&gt;min_flt + p-&gt;cmin_flt;
current-&gt;cmaj_flt += p-&gt;maj_flt + p-&gt;cmaj_flt;
current-&gt;cnswap += p-&gt;nswap + p-&gt;cnswap;
current-&gt;counter += p-&gt;counter
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>884</x>
      <y>1294</y>
      <w>33</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;310.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>946</x>
      <y>1306</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>free_task_struct</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>884</x>
      <y>1294</y>
      <w>70</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;680.0;120.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>790</x>
      <y>1277</y>
      <w>16</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
copy rusage到ru</panel_attributes>
    <additional_attributes>60.0;10.0;10.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>786</x>
      <y>1290</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>getrusage</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>799</x>
      <y>1291</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_user</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>795</x>
      <y>1277</y>
      <w>23</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
exit_code复制到stat_addr</panel_attributes>
    <additional_attributes>10.0;10.0;90.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>812</x>
      <y>1291</y>
      <w>8</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>end_wait4
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>791</x>
      <y>1277</y>
      <w>30</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
复制到用户空间出错了
不释放task的空间直接退出
当父进程exit时，看到子进程是TASK_ZOMBIE
就通知其新任父进程将其回收
</panel_attributes>
    <additional_attributes>50.0;10.0;240.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>622</x>
      <y>1619</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sys_exit</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>623</x>
      <y>1630</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_exit
主要过程：
1.与do_fork相反的过程
	mm退出
	file close
	文件路径退出
	sig 退出
	thread 退出
2.解除关系
	如果是seesion的主进程，和tty解除
	如果由动态安装模块，减少计数
	父进程 子进程 进程组之间的关系
3.schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>627</x>
      <y>1622</y>
      <w>16</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
(error_code&amp;0xff)&lt;&lt;8</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>415</x>
      <y>1646</y>
      <w>24</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>1.in_interrupt（不能再irq和bh中）
	//中断服务程序不允许调用exit，因为
	//exit不能返回
2.tsk-&gt;pid不为0和1
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>432</x>
      <y>1633</y>
      <w>200</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
filter</panel_attributes>
    <additional_attributes>1980.0;10.0;10.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>442</x>
      <y>1647</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tsk-&gt;flags |= PF_EXITING
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>449</x>
      <y>1633</y>
      <w>182</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1800.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>464</x>
      <y>1647</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>del_timer_sync</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>469</x>
      <y>1633</y>
      <w>163</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tsk-&gt;real_timer</panel_attributes>
    <additional_attributes>1610.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>444</x>
      <y>1650</y>
      <w>27</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>250.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>463</x>
      <y>1650</y>
      <w>9</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>70.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>438</x>
      <y>1654</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>detach_timer</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>451</x>
      <y>1654</y>
      <w>26</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>timer-&gt;list.next = timer-&gt;list.prev = NULL
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>432</x>
      <y>1663</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>list_del</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>425</x>
      <y>1657</y>
      <w>32</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果timer-&gt;list.next == NULL
timer-&gt;list
猜想：是双向链表，所以如果next没有，就没有
加入到timer的链表中</panel_attributes>
    <additional_attributes>180.0;10.0;130.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>482</x>
      <y>1647</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__exit_mm</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>489</x>
      <y>1633</y>
      <w>143</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1410.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>456</x>
      <y>1659</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mm_release</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>460</x>
      <y>1650</y>
      <w>30</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
表示不会回到用户空间</panel_attributes>
    <additional_attributes>280.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>487</x>
      <y>1650</y>
      <w>14</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
mm!=Null</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>472</x>
      <y>1656</y>
      <w>29</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>270.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>458</x>
      <y>1664</y>
      <w>22</w>
      <h>4</h>
    </coordinates>
    <panel_attributes> //退出了mm，但增加active_mm的计数
atomic_inc(&amp;mm-&gt;mm_count)
tsk-&gt;mm = NULL
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>483</x>
      <y>1664</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>enter_lazy_tlb</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>489</x>
      <y>1656</y>
      <w>12</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>100.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>496</x>
      <y>1663</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mmput</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>498</x>
      <y>1656</y>
      <w>41</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
因为增加了mm_count的计数
这里只是释放了页表和页面，并没有把mm的实体释放，
因为schedule需要active_mm，mm是再schedule中释放的</panel_attributes>
    <additional_attributes>10.0;10.0;50.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>503</x>
      <y>1651</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sem_exit</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>507</x>
      <y>1633</y>
      <w>125</w>
      <h>20</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1230.0;10.0;120.0;130.0;10.0;180.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>524</x>
      <y>1645</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__exit_files</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>530</x>
      <y>1633</y>
      <w>102</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>1000.0;10.0;10.0;120.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>529</x>
      <y>1648</y>
      <w>12</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tsk-&gt;files!=Null</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>525</x>
      <y>1653</y>
      <w>7</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>50.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>519</x>
      <y>1657</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tsk-&gt;files = NULL
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>533</x>
      <y>1657</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_files_struct</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>529</x>
      <y>1653</y>
      <w>12</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;100.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>539</x>
      <y>1660</y>
      <w>16</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
atomic_dec_and_test</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>522</x>
      <y>1665</y>
      <w>20</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>516</x>
      <y>1672</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>close_files</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>537</x>
      <y>1665</y>
      <w>15</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果fd和fdset做过扩展</panel_attributes>
    <additional_attributes>30.0;10.0;110.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>533</x>
      <y>1670</y>
      <w>21</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
files-&gt;fd != &amp;files-&gt;fd_array[0]</panel_attributes>
    <additional_attributes>150.0;10.0;50.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>532</x>
      <y>1674</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>free_fd_array</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>541</x>
      <y>1670</y>
      <w>23</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
files-&gt;max_fdset &gt; __FD_SETSIZE
open_fds
close_on_exec</panel_attributes>
    <additional_attributes>70.0;10.0;150.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>551</x>
      <y>1676</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>free_fdset</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>560</x>
      <y>1669</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kmem_cache_free</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>539</x>
      <y>1665</y>
      <w>29</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
释放files结构体</panel_attributes>
    <additional_attributes>10.0;10.0;270.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>551</x>
      <y>1644</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__exit_fs</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>556</x>
      <y>1647</y>
      <w>11</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tsk-&gt;fs!=Null</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>547</x>
      <y>1657</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tsk-&gt;fs = NULL
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>551</x>
      <y>1652</y>
      <w>8</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>60.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>571</x>
      <y>1657</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__put_fs_struct</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>557</x>
      <y>1652</y>
      <w>22</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;200.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>579</x>
      <y>1660</y>
      <w>16</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
atomic_dec_and_test</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>572</x>
      <y>1665</y>
      <w>13</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
fs-&gt;root
fs-&gt;pwd
fs-&gt;altroot</panel_attributes>
    <additional_attributes>80.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>567</x>
      <y>1675</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>dput</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>588</x>
      <y>1674</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mntput</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>579</x>
      <y>1665</y>
      <w>16</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
fs-&gt;rootmnt
fs-&gt;pwdmnt
fs-&gt;altrootmnt</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>608</x>
      <y>1671</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kmem_cache_free</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>579</x>
      <y>1665</y>
      <w>38</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
释放fs结构体</panel_attributes>
    <additional_attributes>10.0;10.0;360.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>605</x>
      <y>1641</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>exit_sighand</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>607</x>
      <y>1644</y>
      <w>13</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tsk-&gt;sig!=Null</panel_attributes>
    <additional_attributes>40.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>589</x>
      <y>1653</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tsk-&gt;sig = NULL
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>593</x>
      <y>1649</y>
      <w>17</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>150.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>606</x>
      <y>1654</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kmem_cache_free</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>605</x>
      <y>1649</y>
      <w>15</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
释放sigaction结构体</panel_attributes>
    <additional_attributes>40.0;10.0;100.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>627</x>
      <y>1654</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tsk-&gt;sigpending = 0
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>645</x>
      <y>1653</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flush_sigqueue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>607</x>
      <y>1649</y>
      <w>45</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tsk-&gt;pending</panel_attributes>
    <additional_attributes>10.0;10.0;430.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>607</x>
      <y>1649</y>
      <w>27</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;250.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>624</x>
      <y>1664</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sigemptyset</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>628</x>
      <y>1656</y>
      <w>27</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
清空被pending的signal
&amp;queue-&gt;signal</panel_attributes>
    <additional_attributes>250.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>641</x>
      <y>1664</y>
      <w>20</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>q = queue-&gt;head;
 //将队列清空
queue-&gt;head = NULL;
queue-&gt;tail = &amp;queue-&gt;head;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>645</x>
      <y>1656</y>
      <w>10</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>80.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>664</x>
      <y>1667</y>
      <w>27</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>kmem_cache_free(sigqueue_cachep, q);
		atomic_dec(&amp;nr_queued_signals);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>652</x>
      <y>1656</y>
      <w>26</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
循环释放队列中的sigqueue</panel_attributes>
    <additional_attributes>10.0;10.0;240.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>638</x>
      <y>1641</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>exit_thread
（对i386 nothing to do）</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>554</x>
      <y>1633</y>
      <w>78</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>760.0;10.0;10.0;110.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>610</x>
      <y>1633</y>
      <w>22</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>200.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>629</x>
      <y>1633</y>
      <w>15</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;130.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>630</x>
      <y>1633</y>
      <w>33</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
current-&gt;leader
当前进程是session的主进程
所以session中的进程就与主控终端解除
关系，成为后台进程</panel_attributes>
    <additional_attributes>10.0;10.0;310.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>655</x>
      <y>1641</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>disassociate_ctty</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>679</x>
      <y>1641</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_exec_domain</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>629</x>
      <y>1633</y>
      <w>59</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tsk-&gt;exec_domain</panel_attributes>
    <additional_attributes>10.0;10.0;570.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>696</x>
      <y>1641</y>
      <w>33</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>__MOD_DEC_USE_COUNT(tsk-&gt;binfmt-&gt;module)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>630</x>
      <y>1633</y>
      <w>85</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;830.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>731</x>
      <y>1641</y>
      <w>15</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>tsk-&gt;exit_code = code
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>629</x>
      <y>1633</y>
      <w>109</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1070.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>752</x>
      <y>1641</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>exit_notify</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>629</x>
      <y>1633</y>
      <w>130</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1280.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>703</x>
      <y>1650</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>forget_original_parent</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>709</x>
      <y>1644</y>
      <w>51</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>490.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>677</x>
      <y>1655</y>
      <w>27</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>reaper = next_thread(father);
 //如果exit的是线程，则由线程组中的
 //下一个线程接管子进程，
 //否则由init进程结接管这个进程的子进程
if (reaper == father)
	reaper = child_reaper;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>686</x>
      <y>1652</y>
      <w>27</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>250.0;20.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>708</x>
      <y>1663</y>
      <w>25</w>
      <h>13</h>
    </coordinates>
    <panel_attributes> //退出时要给父进程发送的信号
p-&gt;exit_signal = SIGCHLD;
p-&gt;self_exec_id++;
	//改变其“生父” original father
p-&gt;p_opptr = reaper;
if (p-&gt;pdeath_signal)
 send_sig(p-&gt;pdeath_signal, p, 0);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>711</x>
      <y>1653</y>
      <w>19</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
遍历所有的task
如果是当前进程的子进程</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;100.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>742</x>
      <y>1644</y>
      <w>66</w>
      <h>25</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
孤儿进程组，再同一session，但是进程组中所有进程的父进程不和子进程在同一个进程组
(t-&gt;pgrp != current-&gt;pgrp) &amp;&amp;
(t-&gt;session == current-&gt;session) &amp;&amp;
  //进程组中的其他所有进程的父进程都不在这个进程组
will_become_orphaned_pgrp(current-&gt;pgrp, current) &amp;&amp;
 //该进程组中有TASK_STOPPED的进程
has_stopped_jobs</panel_attributes>
    <additional_attributes>170.0;10.0;10.0;230.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>737</x>
      <y>1667</y>
      <w>23</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>kill_pg(current-&gt;pgrp,SIGHUP,1);
kill_pg(current-&gt;pgrp,SIGCONT,1);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>758</x>
      <y>1644</y>
      <w>33</w>
      <h>30</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
current-&gt;exit_signal != SIGCHLD &amp;&amp;
( current-&gt;parent_exec_id != t-&gt;self_exec_id  ||
current-&gt;self_exec_id != current-&gt;parent_exec_id) 
 //不是super user
&amp;&amp; !capable(CAP_KILL)</panel_attributes>
    <additional_attributes>10.0;10.0;310.0;280.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>774</x>
      <y>1672</y>
      <w>22</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;exit_signal = SIGCHLD
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>802</x>
      <y>1668</y>
      <w>23</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>current-&gt;state = TASK_ZOMBIE;
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>758</x>
      <y>1644</y>
      <w>56</w>
      <h>26</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;540.0;240.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>836</x>
      <y>1669</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_notify_parent</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>758</x>
      <y>1644</y>
      <w>85</w>
      <h>27</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;830.0;250.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>814</x>
      <y>1678</y>
      <w>26</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>info.si_signo = sig;
info.si_errno = 0;
info.si_pid = tsk-&gt;pid;
info.si_uid = tsk-&gt;uid;
info.si_utime = tsk-&gt;times.tms_utime;
info.si_stime = tsk-&gt;times.tms_stime;
 //这两项由task的状态和exit_code决定
info.si_code = why; 
info.si_status = status;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>817</x>
      <y>1672</y>
      <w>27</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
组装siginfo</panel_attributes>
    <additional_attributes>250.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>846</x>
      <y>1685</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>send_sig_info</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>868</x>
      <y>1683</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>wake_up_parent</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>841</x>
      <y>1672</y>
      <w>21</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
sig, &amp;info, tsk-&gt;p_pptr</panel_attributes>
    <additional_attributes>10.0;10.0;100.0;130.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>841</x>
      <y>1672</y>
      <w>34</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tsk-&gt;p_pptr</panel_attributes>
    <additional_attributes>10.0;10.0;320.0;110.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>759</x>
      <y>1644</y>
      <w>135</w>
      <h>26</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
current-&gt;p_cptr != NULL)
存在子进程
循环</panel_attributes>
    <additional_attributes>10.0;10.0;1330.0;240.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>887</x>
      <y>1668</y>
      <w>44</w>
      <h>44</h>
    </coordinates>
    <panel_attributes> //移除exit进程的最年轻子进程
p = current-&gt;p_cptr;
current-&gt;p_cptr = p-&gt;p_osptr;
p-&gt;p_ysptr = NULL; //这里还是和之前最年轻的子进程连接的，
						//这里把关系解除
p-&gt;ptrace = 0;

	//将之前移除的子进程连接到forget_original_parent规定的生父中
	//并且养父也换成了生父
p-&gt;p_pptr = p-&gt;p_opptr;
p-&gt;p_osptr = p-&gt;p_pptr-&gt;p_cptr;
if (p-&gt;p_osptr)
	p-&gt;p_osptr-&gt;p_ysptr = p;
p-&gt;p_pptr-&gt;p_cptr = p;
	//如果这个子进程也退出
if (p-&gt;state == TASK_ZOMBIE)
	do_notify_parent(p, p-&gt;exit_signal);

	//因为最年轻的子进程要和父进程解除关系
	//如果变换子进程的关系使子进程原来的进程组成为了孤儿进程
if ((p-&gt;pgrp != current-&gt;pgrp) &amp;&amp;
    (p-&gt;session == current-&gt;session)) {
	int pgrp = p-&gt;pgrp;
	if (is_orphaned_pgrp(pgrp) &amp;&amp; has_stopped_jobs(pgrp)) {
		kill_pg(pgrp,SIGHUP,1);
		kill_pg(pgrp,SIGCONT,1);
	}
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>798</x>
      <y>1639</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>628</x>
      <y>1633</y>
      <w>177</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1750.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>868</x>
      <y>1692</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>wake_up_interruptible</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>873</x>
      <y>1686</y>
      <w>17</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
唤醒该进程内所有线程
的wait_chldexit</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>871</x>
      <y>1699</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__wake_up</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>860</x>
      <y>1695</y>
      <w>35</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
(x),TASK_INTERRUPTIBLE,WQ_FLAG_EXCLUSIVE</panel_attributes>
    <additional_attributes>150.0;10.0;190.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>870</x>
      <y>1706</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__wake_up_common</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>877</x>
      <y>1702</y>
      <w>8</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
mode=0</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>508</x>
      <y>1654</y>
      <w>3</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;150.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>480</x>
      <y>1669</y>
      <w>34</w>
      <h>20</h>
    </coordinates>
    <panel_attributes>1.如果因为申请信号量而睡着（semsleeping有值）
	1.通过sem_lock获取sma，并上锁，并清除：
		current-&gt;semsleeping = NULL
	2.如果queue在链表中（q-&gt;prev），通过remove_from_queue
		将其从sma链表中删除
2.遍历进程注册过的undo的链表semundo，无论结果如何，都通过kfree将undo释放
	1.经过sem_lock，semid != -1(两次，lock可能睡)，sem_checkid检测
	2.遍历sma的undo链表，如果没找到就解锁，查看进程下一个
	3.如果找到了，遍历sma中所有的信号量：
		sem-&gt;semval += u-&gt;semadj[i];
		sem-&gt;sempid = current-&gt;pid;
	4.通过update_queue尝试为sma中的等待队列申请信号量
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>792</x>
      <y>1443</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>down</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>784</x>
      <y>1451</y>
      <w>27</w>
      <h>19</h>
    </coordinates>
    <panel_attributes> //lock 原子操作
LOCK "decl %0\n\t"     /* --sem-&gt;count */
"js 2f\n"
"1:\n"
".section .text.lock,\"ax\"\n"
"2:\tcall __down_failed\n\t"
"jmp 1b\n"
".previous"
:"=m" (sem-&gt;count)
:"c" (sem)
:"memory");
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>797</x>
      <y>1446</y>
      <w>3</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>791</x>
      <y>1474</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__down_failed</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>796</x>
      <y>1469</y>
      <w>3</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>790</x>
      <y>1482</y>
      <w>14</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>"pushl %eax\n\t"
"pushl %edx\n\t"
"pushl %ecx\n\t"
"call __down\n\t"
"popl %ecx\n\t"
"popl %edx\n\t"
"popl %eax\n\t"
"ret"
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>796</x>
      <y>1477</y>
      <w>3</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>790</x>
      <y>1501</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__down</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>795</x>
      <y>1495</y>
      <w>3</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>738</x>
      <y>1510</y>
      <w>28</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>DECLARE_WAITQUEUE(wait, tsk)
tsk-&gt;state = TASK_UNINTERRUPTIBLE
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>753</x>
      <y>1504</y>
      <w>44</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>420.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>770</x>
      <y>1510</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>add_wait_queue_exclusive</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>779</x>
      <y>1504</y>
      <w>18</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
&amp;sem-&gt;wait, &amp;wait</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>766</x>
      <y>1517</y>
      <w>25</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>	wait-&gt;flags = WQ_FLAG_EXCLUSIVE;
	__add_wait_queue_tail(q, wait);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>776</x>
      <y>1513</y>
      <w>4</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>792</x>
      <y>1510</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>sem-&gt;sleepers++
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>794</x>
      <y>1504</y>
      <w>8</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;60.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>794</x>
      <y>1504</y>
      <w>21</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
死循环</panel_attributes>
    <additional_attributes>10.0;10.0;190.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>807</x>
      <y>1506</y>
      <w>67</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!atomic_add_negative(sleepers - 1, &amp;sem-&gt;count
因为在down里面减了sem-&gt;count，是负数才跳到这
如果当sleeper和sem.count的值是正值时，说明有生产者
释放了信号量
注：sem-&gt;count最小为-1，因为在down的时候虽然减了1
	但是在atomic_add_negative又加上了sleeper-1
	如果开始counter=0 down，counter=-1 sleeper-1=0 atomic_add_negative后count=-1 sem.sleeper=1
	之后counter=-1， down， counter=-2 sleeper-1=1 atomic_add_negative后count=-1 sem.sleeper=1</panel_attributes>
    <additional_attributes>60.0;20.0;10.0;120.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>797</x>
      <y>1518</y>
      <w>40</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>sem-&gt;sleepers = 0
remove_wait_queue(&amp;sem-&gt;wait, &amp;wait);
tsk-&gt;state = TASK_RUNNING;
	//唤醒队列中的第一个进程，因为是add_wait_queue_exclusive
	//设置了WQ_FLAG_EXCLUSIVE
wake_up(&amp;sem-&gt;wait);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>926</x>
      <y>1442</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>up</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>919</x>
      <y>1450</y>
      <w>27</w>
      <h>20</h>
    </coordinates>
    <panel_attributes> //lock 原子操作
"# atomic up operation\n\t"
LOCK "incl %0\n\t"     /* ++sem-&gt;count */
 //&lt;=0
"jle 2f\n"
"1:\n"
".section .text.lock,\"ax\"\n"
"2:\tcall __up_wakeup\n\t"
"jmp 1b\n"
".previous"
:"=m" (sem-&gt;count)
:"c" (sem)
:"memory"
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>931</x>
      <y>1445</y>
      <w>3</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>927</x>
      <y>1473</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__up_wakeup</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>932</x>
      <y>1469</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>927</x>
      <y>1480</y>
      <w>14</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>"pushl %eax\n\t"
"pushl %edx\n\t"
"pushl %ecx\n\t"
"call __up\n\t"
"popl %ecx\n\t"
"popl %edx\n\t"
"popl %eax\n\t"
"ret"
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>932</x>
      <y>1476</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>927</x>
      <y>1497</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>wake_up</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>932</x>
      <y>1493</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>932</x>
      <y>1500</y>
      <w>55</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
(x),TASK_UNINTERRUPTIBLE | TASK_INTERRUPTIBLE,WQ_FLAG_EXCLUSIVE</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>927</x>
      <y>1504</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__wake_up</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>927</x>
      <y>1511</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__wake_up_common</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>932</x>
      <y>1507</y>
      <w>4</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
0</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>811</x>
      <y>1507</y>
      <w>47</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;450.0;160.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>849</x>
      <y>1523</y>
      <w>28</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>sem-&gt;sleepers = 1;	
schedule();
tsk-&gt;state = TASK_UNINTERRUPTIBLE;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>902</x>
      <y>1518</y>
      <w>83</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>1.遍历wait_queue_head_t中的wait_queue_t
2.检查	wait_queue_t中的task是否state和mode规定的其中一个
3.遇到没置上WQ_FLAG_EXCLUSIVE，就直接唤醒。直到遇到第一个WQ_FLAG_EXCLUSIVE，如果不在irq中
	就唤醒这个task后退出；如果在irq中，就看这个task在不在同一个cpu上，如果在就直接唤醒退出，如果
	不在，就记录下这个，继续查找。如果查找过程遇到没置WQ_FLAG_EXCLUSIVE继续唤醒，遇到置上的WQ_FLAG_EXCLUSIVE
	就看是否在本cpu中，直到遍历完成，如果找不到在本cpu中的WQ_FLAG_EXCLUSIVE，唤醒记录的那个。
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>933</x>
      <y>1514</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1116</x>
      <y>1442</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>local_irq_save</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1111</x>
      <y>1451</y>
      <w>22</w>
      <h>5</h>
    </coordinates>
    <panel_attributes> //这里保存eflags，并禁止中断
"pushfl ; popl %0 ; cli":"=g" (x)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1120</x>
      <y>1445</y>
      <w>25</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
local_开头的是本cpu禁止/开启中断</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1144</x>
      <y>1468</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>spin_lock</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1148</x>
      <y>1471</y>
      <w>27</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
_lock结尾是为了防止来自其他cpu干扰</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1136</x>
      <y>1476</y>
      <w>24</w>
      <h>23</h>
    </coordinates>
    <panel_attributes>"\n1:\t" \
	//原子操作
"lock ; decb %0\n\t" \
	//是负数就跳到2
"js 2f\n" \
".section .text.lock,\"ax\"\n" \
"2:\t" \
"cmpb $0,%0\n\t" \
"rep;nop\n\t" \
	//&lt;=0
"jle 2b\n\t" \
"jmp 1b\n" \
".previous"
:"=m" (lock-&gt;lock) : : 
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1140</x>
      <y>1504</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>spin_unlock</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1143</x>
      <y>1507</y>
      <w>5</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1130</x>
      <y>1511</y>
      <w>29</w>
      <h>8</h>
    </coordinates>
    <panel_attributes> //这里不用lock，因为dec 包含读 改 写三步
 //而mov只包含写1步
"movb $1,%0"
:"=m" (lock-&gt;lock)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1097</x>
      <y>1470</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>read_lock</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1096</x>
      <y>1478</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__build_read_lock</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1101</x>
      <y>1473</y>
      <w>4</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1095</x>
      <y>1485</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__build_read_lock_ptr</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1102</x>
      <y>1481</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1091</x>
      <y>1492</y>
      <w>24</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>LOCK "subl $1,(%0)\n\t" \
"js 2f\n" \
"1:\n" \
".section .text.lock,\"ax\"\n" \
 //const中leal是将（*（volatile *）rw）
 //的地址赋给eax，
"2:\tcall " helper "\n\t" \
"jmp 1b\n" \
".previous" \
::"a" (rw) : "memory")
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1101</x>
      <y>1488</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1099</x>
      <y>1508</y>
      <w>5</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1092</x>
      <y>1513</y>
      <w>17</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>__read_lock_failed:
	lock ; incl	(%eax)
1:	cmpl	$1,(%eax)
	js	1b

	lock ; decl	(%eax)
	js	__read_lock_failed
	ret
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1055</x>
      <y>1470</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>write_lock</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1054</x>
      <y>1478</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__build_write_lock</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1060</x>
      <y>1473</y>
      <w>3</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1051</x>
      <y>1485</y>
      <w>24</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>LOCK "subl $" RW_LOCK_BIAS_STR ",(%0)\n\t" \
"jnz 2f\n" \
"1:\n" \
".section .text.lock,\"ax\"\n" \
"2:\tcall " helper "\n\t" \
"jmp 1b\n" \
".previous" \
::"a" (rw) : "memory"
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1059</x>
      <y>1481</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1046</x>
      <y>1503</y>
      <w>33</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>__write_lock_failed:
	//这里防止加了写的锁，其他的读操作无法进行
	" LOCK "addl	$" RW_LOCK_BIAS_STR ",(%eax)
1:	cmpl	$" RW_LOCK_BIAS_STR ",(%eax)
	jne	1b

	" LOCK "subl	$" RW_LOCK_BIAS_STR ",(%eax)
	jnz	__write_lock_failed
	ret
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1061</x>
      <y>1499</y>
      <w>4</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>715</x>
      <y>262</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>request_irq</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>687</x>
      <y>265</y>
      <w>36</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
filter</panel_attributes>
    <additional_attributes>340.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>671</x>
      <y>271</y>
      <w>30</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>1.irqflags &amp; SA_SHIRQ shared的irq得有device
2.irq id不能超过NR_IRQS
3.handler 中断服务函数不能为空
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>703</x>
      <y>272</y>
      <w>32</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>action = (struct irqaction *)
			kmalloc(sizeof(struct irqaction), GFP_KERNEL);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>718</x>
      <y>265</y>
      <w>10</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
申请action
</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>738</x>
      <y>272</y>
      <w>18</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>action-&gt;handler = handler;
action-&gt;flags = irqflags;
action-&gt;mask = 0;
action-&gt;name = devname;
action-&gt;next = NULL;
action-&gt;dev_id = dev_id;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>721</x>
      <y>265</y>
      <w>24</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;220.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>762</x>
      <y>272</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>setup_irq</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>721</x>
      <y>265</y>
      <w>47</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;450.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>767</x>
      <y>275</y>
      <w>11</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
irq irqaction</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>731</x>
      <y>280</y>
      <w>39</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>370.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>723</x>
      <y>288</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>desc = irq_desc + irq
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>755</x>
      <y>288</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>p = &amp;desc-&gt;action
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>763</x>
      <y>280</y>
      <w>7</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>50.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>767</x>
      <y>280</y>
      <w>17</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
shared有效性判断</panel_attributes>
    <additional_attributes>10.0;10.0;150.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>776</x>
      <y>288</y>
      <w>33</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>1.头节点为action空，就不是shared
2.不为空，但是头节点和新加的节点没有SA_SHIRQ
	就产生错误
3.上述情况都不成立，将p指向最后一个箭头
	且shared=1
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>814</x>
      <y>288</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>*p = new
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>768</x>
      <y>280</y>
      <w>53</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将最后一个箭头指向新加的节点</panel_attributes>
    <additional_attributes>10.0;10.0;510.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>828</x>
      <y>288</y>
      <w>49</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>desc-&gt;depth = 0;
desc-&gt;status &amp;= ~(IRQ_DISABLED | IRQ_AUTODETECT | IRQ_WAITING);
desc-&gt;handler-&gt;startup(irq);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>768</x>
      <y>280</y>
      <w>77</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!shared</panel_attributes>
    <additional_attributes>10.0;10.0;750.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>884</x>
      <y>288</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>register_irq_proc</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>767</x>
      <y>280</y>
      <w>123</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1210.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>740</x>
      <y>289</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>rand_initialize_irq</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>745</x>
      <y>280</y>
      <w>25</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
外部中断的发生时间用于产生随机数</panel_attributes>
    <additional_attributes>230.0;10.0;10.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>726</x>
      <y>295</y>
      <w>41</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>state = kmalloc(sizeof(struct timer_rand_state), GFP_KERNEL)
memset(state, 0, sizeof(struct timer_rand_state))
irq_timer_state[irq] = state
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>741</x>
      <y>292</y>
      <w>6</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>40.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>954</x>
      <y>279</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>"pushl $"#nr"-256
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>984</x>
      <y>279</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>"jmp common_interrupt"
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>960</x>
      <y>273</y>
      <w>25</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
压中断号入栈（注意时负数）</panel_attributes>
    <additional_attributes>230.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>981</x>
      <y>273</y>
      <w>14</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>964</x>
      <y>265</y>
      <w>26</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>BUILD_16_IRQS(0x0)
--
1.内核产生中断：eflag cs ip
2.用户态产生中断：ss sp eflag cs ip
valign=top</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>974</x>
      <y>286</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>SAVE_ALL
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>978</x>
      <y>282</y>
      <w>17</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
保存现场</panel_attributes>
    <additional_attributes>150.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>986</x>
      <y>286</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>pushl $ret_from_intr
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>993</x>
      <y>282</y>
      <w>11</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
函数返回地址</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1009</x>
      <y>286</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_IRQ</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>994</x>
      <y>282</y>
      <w>21</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;190.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>942</x>
      <y>295</y>
      <w>48</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>irq = regs.orig_eax &amp; 0xff
desc = irq_desc + irq
kstat.irqs[cpu][irq]++
desc-&gt;handler-&gt;ack(irq)
status = desc-&gt;status &amp; ~(IRQ_REPLAY | IRQ_WAITING)
status |= IRQ_PENDING
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>977</x>
      <y>289</y>
      <w>41</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>390.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>993</x>
      <y>289</y>
      <w>33</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!(status &amp; (IRQ_DISABLED | IRQ_INPROGRESS))
处于disable或inproress下就pending，暂时不执行
否则
</panel_attributes>
    <additional_attributes>230.0;10.0;90.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>997</x>
      <y>298</y>
      <w>21</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>action = desc-&gt;action
status &amp;= ~IRQ_PENDING
status |= IRQ_INPROGRESS
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1019</x>
      <y>298</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>desc-&gt;status = status
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1014</x>
      <y>289</y>
      <w>13</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;110.0;90.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1015</x>
      <y>289</y>
      <w>32</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
死循环处理pending的irq</panel_attributes>
    <additional_attributes>10.0;10.0;300.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1036</x>
      <y>299</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>handle_IRQ_event</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1052</x>
      <y>299</y>
      <w>24</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>if (!(desc-&gt;status &amp; IRQ_PENDING))
	break;
desc-&gt;status &amp;= ~IRQ_PENDING;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1041</x>
      <y>294</y>
      <w>5</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1043</x>
      <y>294</y>
      <w>22</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;200.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1080</x>
      <y>300</y>
      <w>27</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>desc-&gt;status &amp;= ~IRQ_INPROGRESS
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1016</x>
      <y>289</y>
      <w>75</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;730.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1109</x>
      <y>300</y>
      <w>28</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>desc-&gt;handler-&gt;end(irq)
if (softirq_active(cpu) &amp; softirq_mask(cpu))
	do_softirq();
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1015</x>
      <y>289</y>
      <w>106</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;1040.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>974</x>
      <y>309</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>irq_enter</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>970</x>
      <y>316</y>
      <w>17</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>++local_irq_count(cpu)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>979</x>
      <y>302</y>
      <w>63</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果处于中断，
这个值不为0
</panel_attributes>
    <additional_attributes>610.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>977</x>
      <y>312</y>
      <w>4</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>988</x>
      <y>310</y>
      <w>8</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>status = 1
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>991</x>
      <y>302</y>
      <w>51</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>490.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>998</x>
      <y>310</y>
      <w>8</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__sti()
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1001</x>
      <y>302</y>
      <w>41</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!(action-&gt;flags &amp; SA_INTERRUPT)
</panel_attributes>
    <additional_attributes>390.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1009</x>
      <y>310</y>
      <w>29</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>status |= action-&gt;flags;
		action-&gt;handler(irq, action-&gt;dev_id, regs);
		action = action-&gt;next;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1022</x>
      <y>302</y>
      <w>20</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
依次执行中断服务函数
中断服务函数中应该检测
设备的中断状态寄存器
</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1039</x>
      <y>302</y>
      <w>26</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
status &amp; SA_SAMPLE_RANDOM</panel_attributes>
    <additional_attributes>10.0;10.0;52.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1039</x>
      <y>312</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>add_interrupt_randomness
引入随机性</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1062</x>
      <y>313</y>
      <w>7</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__cli()
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1039</x>
      <y>302</y>
      <w>29</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;270.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1071</x>
      <y>313</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>irq_exit</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1039</x>
      <y>302</y>
      <w>40</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;380.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1063</x>
      <y>320</y>
      <w>17</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>local_irq_count(cpu)--
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1070</x>
      <y>316</y>
      <w>9</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>70.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1165</x>
      <y>288</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ret_from_intr</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>995</x>
      <y>282</y>
      <w>179</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;1770.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1137</x>
      <y>295</y>
      <w>16</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>GET_CURRENT(%ebx)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1141</x>
      <y>291</y>
      <w>29</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
通过esp指针得到现在task_struct指针
从这里可知，task的指针是对2个页面对齐的
</panel_attributes>
    <additional_attributes>270.0;10.0;20.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1160</x>
      <y>295</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ret_with_reschedule
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1165</x>
      <y>291</y>
      <w>36</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
只有在用户空间发生了中断或者异常才会发生调度
否则在系统空间发生了中断和异常是不会发生调度的
即使此时发生了timer的中断</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1194</x>
      <y>296</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>restore_all
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1168</x>
      <y>291</y>
      <w>32</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;300.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1144</x>
      <y>303</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>reschedule
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1159</x>
      <y>303</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>signal_return
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1176</x>
      <y>303</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>RESTORE_ALL
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1149</x>
      <y>298</y>
      <w>19</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
need_resched</panel_attributes>
    <additional_attributes>170.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1164</x>
      <y>298</y>
      <w>10</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
sigpending</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1165</x>
      <y>298</y>
      <w>17</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;150.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1156</x>
      <y>306</y>
      <w>10</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>80.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1151</x>
      <y>310</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_signal</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1166</x>
      <y>310</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>restore_all
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1163</x>
      <y>306</y>
      <w>12</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;100.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1125</x>
      <y>306</y>
      <w>24</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1120</x>
      <y>310</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1135</x>
      <y>311</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ret_from_sys_call
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1141</x>
      <y>306</y>
      <w>8</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>60.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1211</x>
      <y>304</y>
      <w>7</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>iret
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1192</x>
      <y>304</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>addl $4,%esp;
是将push的irq号删除
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1194</x>
      <y>299</y>
      <w>8</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>60.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1199</x>
      <y>299</y>
      <w>18</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;160.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>223</x>
      <y>381</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>mark_bh</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>228</x>
      <y>384</y>
      <w>13</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
bh_task_vec+nr
</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>222</x>
      <y>388</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tasklet_hi_schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>206</x>
      <y>396</y>
      <w>22</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>t-&gt;next = tasklet_hi_vec[cpu].list;
tasklet_hi_vec[cpu].list = t;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>215</x>
      <y>391</y>
      <w>18</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
加入到当前核的执行链表</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>233</x>
      <y>396</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>__cpu_raise_softirq</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>230</x>
      <y>391</y>
      <w>14</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>232</x>
      <y>403</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>softirq_active(cpu) |= (1&lt;&lt;nr)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>241</x>
      <y>399</y>
      <w>4</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;20.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1104</x>
      <y>309</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_softirq</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1108</x>
      <y>305</y>
      <w>14</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>120.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1088</x>
      <y>314</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>in_interrupt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1092</x>
      <y>311</y>
      <w>19</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>170.0;20.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1060</x>
      <y>325</y>
      <w>36</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>local_irq_count(__cpu) + local_bh_count(__cpu) != 0
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1074</x>
      <y>317</y>
      <w>27</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
在中断中不能执行
当前cpu正在执行softirq的时候不能执行
</panel_attributes>
    <additional_attributes>200.0;10.0;60.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1101</x>
      <y>315</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>local_bh_disable</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1107</x>
      <y>312</y>
      <w>4</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1097</x>
      <y>320</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>local_bh_count(cpu)++
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1104</x>
      <y>317</y>
      <w>4</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>20.0;20.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1105</x>
      <y>312</y>
      <w>27</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
注意软件中中断disable和enable
的位置，在softirq执行的时候打开中断
其他时候将中断关闭，因为此时在中断中
</panel_attributes>
    <additional_attributes>40.0;10.0;220.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1116</x>
      <y>320</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>local_irq_disable
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1108</x>
      <y>312</y>
      <w>33</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
softirq_active(cpu)&amp;softirq_mask(cpu)
</panel_attributes>
    <additional_attributes>10.0;10.0;310.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1116</x>
      <y>318</y>
      <w>24</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
清除所有的软中断</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1101</x>
      <y>326</y>
      <w>20</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>softirq_active(cpu) &amp;= ~active
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1123</x>
      <y>326</y>
      <w>14</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>local_irq_enable
h = softirq_vec
mask &amp;= ~active
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1129</x>
      <y>318</y>
      <w>11</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>90.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1138</x>
      <y>318</y>
      <w>21</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
遍历active所有的标志位</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1139</x>
      <y>325</y>
      <w>10</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>if (active &amp; 1)
	h-&gt;action(h);
h++;
active &gt;&gt;= 1;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1137</x>
      <y>318</y>
      <w>22</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果找到有其他的标志位
重新继续执行</panel_attributes>
    <additional_attributes>10.0;10.0;200.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1152</x>
      <y>327</y>
      <w>7</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>retry
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1164</x>
      <y>323</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>local_irq_enable
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1108</x>
      <y>312</y>
      <w>64</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;620.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1168</x>
      <y>336</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tasklet_hi_action</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1146</x>
      <y>332</y>
      <w>30</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;280.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1159</x>
      <y>345</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>list = tasklet_hi_vec[cpu].list;
tasklet_hi_vec[cpu].list = NULL;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1166</x>
      <y>339</y>
      <w>11</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
找到执行的list</panel_attributes>
    <additional_attributes>80.0;10.0;20.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1173</x>
      <y>339</y>
      <w>51</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
遍历链表中的bh_task_vec</panel_attributes>
    <additional_attributes>10.0;10.0;490.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1211</x>
      <y>344</y>
      <w>13</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1186</x>
      <y>354</y>
      <w>31</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>clear_bit(TASKLET_STATE_SCHED, &amp;t-&gt;state)
t-&gt;func(t-&gt;data)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1222</x>
      <y>353</y>
      <w>29</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>t-&gt;next = tasklet_hi_vec[cpu].list;
tasklet_hi_vec[cpu].list = t;
__cpu_raise_softirq(cpu, HI_SOFTIRQ);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1221</x>
      <y>344</y>
      <w>33</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果被锁住，再次将这个tasklet加到链表中</panel_attributes>
    <additional_attributes>10.0;10.0;90.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1196</x>
      <y>362</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>bh_action</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1201</x>
      <y>358</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1200</x>
      <y>370</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>bh_base[nr]()
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1200</x>
      <y>365</y>
      <w>8</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;60.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1002</x>
      <y>262</y>
      <w>40</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>软中断通道：softirq_vec  通过softirq_mask 和 softirq_active
								表示cpu支持和是否激活
通道中的任务:bh_task_vec ,具体对应哪个硬件irq，
								链接到tasklet_hi_vec
								根据这个中的data找到bh_base执行
								
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1176</x>
      <y>370</y>
      <w>22</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>spin_trylock(&amp;global_bh_lock)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1186</x>
      <y>365</y>
      <w>17</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
保证bh函数执行的穿行化</panel_attributes>
    <additional_attributes>150.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>217</x>
      <y>359</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>timer_interrupt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>223</x>
      <y>316</y>
      <w>800</w>
      <h>45</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>7980.0;10.0;10.0;430.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>210</x>
      <y>365</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_timer_interrupt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>216</x>
      <y>362</y>
      <w>7</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>50.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>199</x>
      <y>374</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_timer</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>240</x>
      <y>373</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>x86_do_profile</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>204</x>
      <y>368</y>
      <w>14</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>120.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>215</x>
      <y>368</y>
      <w>33</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!user_mode(regs)</panel_attributes>
    <additional_attributes>10.0;10.0;310.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>170</x>
      <y>381</y>
      <w>20</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>(*(unsigned long *)&amp;jiffies)++
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>178</x>
      <y>377</y>
      <w>26</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
保证操作的原子性</panel_attributes>
    <additional_attributes>240.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>195</x>
      <y>381</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>update_process_times</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>202</x>
      <y>377</y>
      <w>4</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>204</x>
      <y>377</y>
      <w>26</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TIMER_BH
list_not_empty(tq_timer)
	TQUEUE_BH</panel_attributes>
    <additional_attributes>10.0;10.0;240.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1200</x>
      <y>377</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>timer_bh</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1205</x>
      <y>373</y>
      <w>4</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1190</x>
      <y>383</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>update_times</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1209</x>
      <y>383</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>run_timer_list</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1195</x>
      <y>380</y>
      <w>12</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>100.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1204</x>
      <y>380</y>
      <w>13</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;110.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1186</x>
      <y>389</y>
      <w>6</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>xtime
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1188</x>
      <y>386</y>
      <w>8</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
更新xtime</panel_attributes>
    <additional_attributes>60.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1196</x>
      <y>390</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>calc_load</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1194</x>
      <y>386</y>
      <w>9</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1344</x>
      <y>353</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kernel_thread</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1330</x>
      <y>360</y>
      <w>47</w>
      <h>31</h>
    </coordinates>
    <panel_attributes>"movl %%esp,%%esi\n\t"  //保存父线程栈的位置
"int $0x80\n\t"		//根据%0 和%2可知eax=__NR_clone，所以调用sys_clone
"cmpl %%esp,%%esi\n\t"	/* child or parent? *///开是否是父线程的栈
"je 1f\n\t"		/* parent - jump */
/* Load the argument into eax, and push it.  That way, it does
 * not matter whether the called function is compiled with
 * -mregparm or not.  */
"movl %4,%%eax\n\t"//如果是子线程的栈，就将传的参数arg压栈
"pushl %%eax\n\t"		
"call *%5\n\t"		/* call fn *//调用子线程的执行函数
"movl %3,%0\n\t"	/* exit *//eax=__NR_exit，调用sys_exit
"int $0x80\n"
"1:\t"
:"=&amp;a" (retval), "=&amp;S" (d0)
:"0" (__NR_clone), "i" (__NR_exit),
 "r" (arg), "r" (fn),
 "b" (flags | CLONE_VM)
: "memory");
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1349</x>
      <y>356</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>89</x>
      <y>397</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>update_one_process</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>96</x>
      <y>384</y>
      <w>108</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
user_tick=1 表示在用户空间发生了时钟中断
			=0 表示在系统空间发生了时钟中断
system和user_tick相反</panel_attributes>
    <additional_attributes>1060.0;10.0;10.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>37</x>
      <y>405</y>
      <w>26</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>p-&gt;per_cpu_utime[cpu] += user;
p-&gt;per_cpu_stime[cpu] += system;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>48</x>
      <y>400</y>
      <w>49</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
统计task在用户空间和系统空间的时间
虽然有一定误差，但是也只是切换的时候存在
并且两者可能互相抵消</panel_attributes>
    <additional_attributes>470.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>69</x>
      <y>407</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_process_times</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>78</x>
      <y>400</y>
      <w>20</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>33</x>
      <y>413</y>
      <w>30</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>psecs = (p-&gt;times.tms_utime += user);
psecs += (p-&gt;times.tms_stime += system)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>48</x>
      <y>410</y>
      <w>30</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
psecs统计task总的时间</panel_attributes>
    <additional_attributes>280.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>73</x>
      <y>410</y>
      <w>31</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
psecs / HZ &gt; p-&gt;rlim[RLIMIT_CPU].rlim_cur</panel_attributes>
    <additional_attributes>30.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>64</x>
      <y>413</y>
      <w>16</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!(psecs % HZ)
没秒钟发一个SIGXCPU</panel_attributes>
    <additional_attributes>100.0;10.0;50.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>68</x>
      <y>413</y>
      <w>30</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
psecs / HZ &gt; p-&gt;rlim[RLIMIT_CPU].rlim_max
注：前面是rlim_cur,这里是rlim_max
</panel_attributes>
    <additional_attributes>60.0;10.0;230.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>53</x>
      <y>418</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>send_sig(SIGXCPU, p, 1)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>81</x>
      <y>417</y>
      <w>20</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>send_sig(SIGKILL, p, 1)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>96</x>
      <y>405</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_it_virt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>95</x>
      <y>400</y>
      <w>9</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>97</x>
      <y>408</y>
      <w>15</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
这里是用户时间闹钟</panel_attributes>
    <additional_attributes>40.0;10.0;100.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>102</x>
      <y>414</y>
      <w>22</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>p-&gt;it_virt_value
表示对task设置的闹钟
（在用户空间的时间），这个
时间到了之后，需要向进程发
send_sig(SIGVTALRM, p, 1)

p-&gt;it_virt_incr
每次it_virt_value时间到了之后
再向it_virt_value重新加载这个时间
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>113</x>
      <y>405</y>
      <w>11</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_it_prof</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>96</x>
      <y>400</y>
      <w>23</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;210.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>126</x>
      <y>414</y>
      <w>24</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>p-&gt;it_prof_value
表示对task设置的闹钟，这个
时间到了之后，需要向进程发
send_sig(SIGPROF, p, 1)

p-&gt;it_prof_incr
每次it_prof_value时间到了之后
再向it_prof_value重新加载这个时间
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>115</x>
      <y>408</y>
      <w>23</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
和virt_value相比，这里是总的时间
（用户空间和系统空间）</panel_attributes>
    <additional_attributes>50.0;10.0;170.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>158</x>
      <y>384</y>
      <w>45</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
p-&gt;pid
不是怠速进程</panel_attributes>
    <additional_attributes>430.0;10.0;10.0;160.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>141</x>
      <y>399</y>
      <w>21</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
时间片到时间后，
置上need_resched</panel_attributes>
    <additional_attributes>190.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>138</x>
      <y>404</y>
      <w>16</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>if (--p-&gt;counter &lt;= 0) {
	p-&gt;counter = 0;
	p-&gt;need_resched = 1;
}
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>155</x>
      <y>404</y>
      <w>26</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>if (p-&gt;nice &gt; 0)
	kstat.per_cpu_nice[cpu] += user_tick;
else
	kstat.per_cpu_user[cpu] += user_tick;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>159</x>
      <y>399</y>
      <w>6</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;40.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>182</x>
      <y>407</y>
      <w>27</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kstat.per_cpu_system[cpu] += system
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>159</x>
      <y>399</y>
      <w>31</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;290.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>177</x>
      <y>398</y>
      <w>27</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kstat.per_cpu_system[cpu] += system
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>179</x>
      <y>384</y>
      <w>31</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
local_bh_count(cpu) || local_irq_count(cpu) &gt; 1
如果pid=0，又在其他的中断中</panel_attributes>
    <additional_attributes>220.0;10.0;80.0;140.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1215</x>
      <y>386</y>
      <w>14</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
jiffies - timer_jiffies</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1211</x>
      <y>390</y>
      <w>51</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>1.如果tv1.index是第一次为0，就将其他的4个数组的index分别置为1，
	如果是之后循环回来，通过cascade_timers向前一个6的数组借一位
	并通过internal_add_timer重新更新到tv1中（注：timer_jiffies
	相对于刚开始加入时有更新）
2.遍历tv1.index所在的队列，然后通过fn(data)去执行响应的定时函数，
	此时比没有删除timer，因为timer在等待timer的进程的栈中，需要该进程自己删。
3.更新下面的值，然后重新遍历
	++timer_jiffies; 
	tv1.index = (tv1.index + 1) &amp; TVR_MASK;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>381</x>
      <y>358</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ide_intr</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>388</x>
      <y>316</y>
      <w>634</w>
      <h>44</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
hwif_init-&gt;init_irq</panel_attributes>
    <additional_attributes>6330.0;10.0;12.0;420.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>273</x>
      <y>375</y>
      <w>30</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>1.检查handler = hwgroup-&gt;handler是否为NULL
2.检查hwgroup-&gt;drive是否为NULL
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>289</x>
      <y>361</y>
      <w>100</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>980.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>311</x>
      <y>375</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>drive_is_ready</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>316</x>
      <y>361</y>
      <w>73</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>710.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>298</x>
      <y>378</y>
      <w>19</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
drive-&gt;waiting_for_dma
如果是DMA</panel_attributes>
    <additional_attributes>170.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>286</x>
      <y>384</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>HWIF(drive)-&gt;dmaproc
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>310</x>
      <y>378</y>
      <w>17</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果不是DMA
检查是否处于busy状态</panel_attributes>
    <additional_attributes>50.0;10.0;110.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>315</x>
      <y>383</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>stat &amp; BUSY_STAT
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>328</x>
      <y>375</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>hwgroup-&gt;busy = 1
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>332</x>
      <y>361</y>
      <w>57</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果busy没置上，将其置上
之前没释放，应该是置上的</panel_attributes>
    <additional_attributes>550.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>342</x>
      <y>375</y>
      <w>21</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>hwgroup-&gt;handler = NULL
 //将timeout从timer中移除
del_timer(&amp;hwgroup-&gt;timer)
 //如果暴露中断，将中断打开
if (drive-&gt;unmask)
		ide__sti()
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>346</x>
      <y>361</y>
      <w>43</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>410.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>367</x>
      <y>378</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>handler(drive)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>372</x>
      <y>361</y>
      <w>17</w>
      <h>19</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>150.0;10.0;10.0;170.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>381</x>
      <y>375</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>set_recovery_timer</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>386</x>
      <y>361</y>
      <w>20</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
两次操作需要有时间间隔时
hwif-&gt;last_time</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>353</x>
      <y>387</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>read_intr</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>359</x>
      <y>381</y>
      <w>17</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>150.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>282</x>
      <y>390</y>
      <w>80</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>780.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>264</x>
      <y>396</y>
      <w>41</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>1.通过GET_STAT获取硬盘的状态，并进行检查，如果数据已经读了
	但是出现错（ERR_STAT|DRQ_STAT），报错。如果数据还没收
	进来，通过ide_set_handler设置read_intr，等待下一次中断
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>309</x>
      <y>397</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>msect = drive-&gt;mult_count
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>316</x>
      <y>390</y>
      <w>45</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
获取硬盘缓冲区存储的扇区数
</panel_attributes>
    <additional_attributes>430.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>338</x>
      <y>397</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>read_next
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>342</x>
      <y>390</y>
      <w>20</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>307</x>
      <y>400</y>
      <w>37</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
计算本次bh要读的扇区</panel_attributes>
    <additional_attributes>350.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>284</x>
      <y>405</y>
      <w>34</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>1.如果判断是multi_read，本次要读的扇区数不能超过
	msect。然后更新硬盘缓冲区中剩余的扇区数
	msect -= nsect
2.如果不是multi_read,本次要读的nsect = 1
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>326</x>
      <y>404</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>idedisk_input_data</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>330</x>
      <y>400</y>
      <w>16</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
读取寄存器数据到buffer</panel_attributes>
    <additional_attributes>130.0;10.0;20.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>306</x>
      <y>412</y>
      <w>23</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果有定义特殊的读取函数ideproc</panel_attributes>
    <additional_attributes>170.0;10.0;50.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>300</x>
      <y>416</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>HWIF(drive)-&gt;ideproc
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>321</x>
      <y>412</y>
      <w>12</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果没有ideproc
</panel_attributes>
    <additional_attributes>30.0;10.0;80.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>317</x>
      <y>415</y>
      <w>14</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
drive-&gt;io_32bit
如果是32为读取</panel_attributes>
    <additional_attributes>120.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>310</x>
      <y>420</y>
      <w>12</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果是同步读取</panel_attributes>
    <additional_attributes>80.0;10.0;30.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>298</x>
      <y>424</y>
      <w>20</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>1.通过do_vlb_sync三次读取port
	IDE_NSECTOR_REG
2.通过insl读取IDE_DATA_REG
	的wcount个32位到buffer
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>321</x>
      <y>426</y>
      <w>8</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>insl
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>318</x>
      <y>420</y>
      <w>14</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
不是同步读取</panel_attributes>
    <additional_attributes>10.0;10.0;60.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>328</x>
      <y>415</y>
      <w>16</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
不是32位去读
是16位</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>334</x>
      <y>420</y>
      <w>9</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
drive-&gt;slow
如果是慢读</panel_attributes>
    <additional_attributes>70.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>330</x>
      <y>424</y>
      <w>14</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>while (wcount--) {
				*ptr++ = inw_p(IDE_DATA_REG);
				*ptr++ = inw_p(IDE_DATA_REG);
			}
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>339</x>
      <y>420</y>
      <w>16</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
注意wcount转化为16位
</panel_attributes>
    <additional_attributes>30.0;10.0;120.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>348</x>
      <y>425</y>
      <w>8</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>insw
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>319</x>
      <y>409</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ide_input_data</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>324</x>
      <y>406</y>
      <w>8</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>60.0;20.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>330</x>
      <y>407</y>
      <w>14</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果定义了bswap</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>335</x>
      <y>410</y>
      <w>15</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>idedisk_bswap_data
（reference）</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>357</x>
      <y>405</y>
      <w>37</w>
      <h>33</h>
    </coordinates>
    <panel_attributes>1.更新读取sector起始，和buffer起始，
	和剩下要去读的扇区数
	rq-&gt;sector += nsect;
	rq-&gt;buffer += nsect&lt;&lt;9;
	rq-&gt;errors = 0;
	rq-&gt;nr_sectors -= nsect
2.如果当前的bh的扇区数读完
（rq-&gt;current_nr_sectors -= nsect&lt;=0）
	通过ide_end_request（注意uptodate=1）
	调整req中的bh
3.如果req中的扇区数没读完（nr_sectors），
	并且硬盘的缓冲区中还有数据（msect），重新
	read_next
	但是如果硬盘缓冲区中没有数据，通过ide_set_handler
	重新设置read_intr，返回ide_started
4.如果整个req读完，返回ide_stopped
注：只需要单独考虑两个问题：
	1.缓冲区是否写完，如果写完，通过ide_end_request更换
	2.整个req是否执行完（硬盘的扇区是否读完），如果没读完
		继续读取，或者通过ide_set_handler设置下一个intr
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>344</x>
      <y>400</y>
      <w>23</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;210.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>328</x>
      <y>444</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ide_end_request</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>334</x>
      <y>437</y>
      <w>35</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
在一个bh处理完之后，需要end</panel_attributes>
    <additional_attributes>330.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>318</x>
      <y>450</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>end_that_request_first</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>319</x>
      <y>447</y>
      <w>20</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果整个req没执行完，返回1
如果执行完，则返回0</panel_attributes>
    <additional_attributes>130.0;10.0;60.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>290</x>
      <y>453</y>
      <w>35</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!uptodate
</panel_attributes>
    <additional_attributes>330.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>281</x>
      <y>459</y>
      <w>22</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>如果数据没更新，提示有IO error
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>304</x>
      <y>459</y>
      <w>34</w>
      <h>27</h>
    </coordinates>
    <panel_attributes>1.将req.bh指向下一个bh，并将结束的bh脱链，执行
	b_end_io
	//计算本次执行了多少个扇区
	nsect = bh-&gt;b_size &gt;&gt; 9
	req-&gt;bh = bh-&gt;b_reqnext;
	bh-&gt;b_reqnext = NULL;
	bh-&gt;b_end_io(bh, uptodate)
2.如果下一个bh不为空，更新req的起始扇区和读写的扇区总数
	以及当前bh要读写的扇区数，以及缓冲区的位置
	req-&gt;hard_sector += nsect;
	req-&gt;hard_nr_sectors -= nsect;
	req-&gt;sector = req-&gt;hard_sector;
	//如果nr_sectors没超过bh的size，将其扩大位bh的size
	req-&gt;nr_sectors = req-&gt;hard_nr_sectors
	req-&gt;current_nr_sectors = bh-&gt;b_size &gt;&gt; 9
	req-&gt;buffer = bh-&gt;b_data
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>316</x>
      <y>453</y>
      <w>12</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果req.bh不为空</panel_attributes>
    <additional_attributes>80.0;10.0;30.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>331</x>
      <y>447</y>
      <w>26</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果执行完整个req</panel_attributes>
    <additional_attributes>10.0;10.0;240.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>338</x>
      <y>455</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>add_blkdev_randomness</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>344</x>
      <y>450</y>
      <w>12</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
增加随机属性</panel_attributes>
    <additional_attributes>100.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>311</x>
      <y>500</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>end_buffer_io_sync</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>313</x>
      <y>489</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>bh-&gt;b_end_io
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>318</x>
      <y>485</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>318</x>
      <y>492</y>
      <w>53</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
对于file的read，在readpage中进行赋值（read因为要预读，所以采用readpage）
对于file的write，因为不是立即向磁盘写入，所以没对其赋值
但是当blance_dirty时，通过ll_rw_block写bh时，对齐进行赋值
当然如果swap，采用writepage时，也会对其进行赋值
在readpage和writepage中赋值是end_buffer_io_async
在ll_rw_block赋值是end_buffer_io_sync</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>300</x>
      <y>508</y>
      <w>16</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>mark_buffer_uptodate
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>301</x>
      <y>503</y>
      <w>25</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
根据uptodate设置bh的BH_Uptodate</panel_attributes>
    <additional_attributes>160.0;10.0;80.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>320</x>
      <y>507</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>unlock_buffer</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>317</x>
      <y>503</y>
      <w>12</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;100.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>305</x>
      <y>515</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>clear_bit</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>310</x>
      <y>510</y>
      <w>20</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
清除BH_Lock</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>332</x>
      <y>516</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>wake_up</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>318</x>
      <y>510</y>
      <w>31</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
通过waitqueue_active检查bh-&gt;b_wait等待队列
不为空，唤醒其等待队列</panel_attributes>
    <additional_attributes>100.0;10.0;200.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>358</x>
      <y>455</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>blkdev_dequeue_request</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>353</x>
      <y>450</y>
      <w>13</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;110.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>362</x>
      <y>458</y>
      <w>16</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果req的电梯存在</panel_attributes>
    <additional_attributes>40.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>353</x>
      <y>463</y>
      <w>12</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>100.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>341</x>
      <y>473</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>elevator_noop_dequeue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>340</x>
      <y>466</y>
      <w>19</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>req-&gt;e-&gt;dequeue_fn
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>349</x>
      <y>469</y>
      <w>15</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
ELEVATOR_LINUS</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>361</x>
      <y>466</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>req-&gt;e = NULL
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>362</x>
      <y>463</y>
      <w>7</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;50.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>377</x>
      <y>465</y>
      <w>10</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>list_del</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>365</x>
      <y>458</y>
      <w>18</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将req从dev的队列中移除</panel_attributes>
    <additional_attributes>10.0;10.0;160.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>378</x>
      <y>454</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>hwgroup-&gt;rq = NULL
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>353</x>
      <y>450</y>
      <w>31</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;290.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>399</x>
      <y>454</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>end_that_request_last</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>353</x>
      <y>450</y>
      <w>54</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;520.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>395</x>
      <y>457</y>
      <w>18</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
req-&gt;sem
如果信号量存在，将其释放</panel_attributes>
    <additional_attributes>130.0;10.0;40.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>393</x>
      <y>462</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>up(req-&gt;sem)
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>413</x>
      <y>462</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>blkdev_release_request</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>407</x>
      <y>457</y>
      <w>16</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>392</x>
      <y>469</y>
      <w>22</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>req-&gt;rq_status = RQ_INACTIVE
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>401</x>
      <y>465</y>
      <w>20</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>420</x>
      <y>468</y>
      <w>25</w>
      <h>8</h>
    </coordinates>
    <panel_attributes> //加入到free_list，并将等待队列唤醒
list_add(&amp;req-&gt;table, req-&gt;free_list);
req-&gt;free_list = NULL;
wake_up(&amp;req-&gt;q-&gt;wait_for_request)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>421</x>
      <y>465</y>
      <w>16</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
req-&gt;free_list
如果req的来源存在</panel_attributes>
    <additional_attributes>10.0;10.0;30.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>388</x>
      <y>361</y>
      <w>17</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;150.0;140.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>398</x>
      <y>375</y>
      <w>37</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>1.如果返回ide_stopped，表示之前req执行完成
	检查hwgroup-&gt;handler为空时：
	hwgroup-&gt;busy = 0;
	ide_do_request
2.如果返回的是ide_started，req在read_next设置软件
	硬件在do_rw_disk中就已经写了要读写的扇区数到寄存器
	IDE_NSECTOR_REG
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>388</x>
      <y>387</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ide_dma_intr</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>374</x>
      <y>381</y>
      <w>22</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;200.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>384</x>
      <y>390</y>
      <w>11</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
ide_dma_end</panel_attributes>
    <additional_attributes>90.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>376</x>
      <y>398</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>HWIF(drive)-&gt;dmaproc
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>388</x>
      <y>390</y>
      <w>21</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
DRIVE_READY
并且能正常结束ide_dma_end
遍历每一个bh去end</panel_attributes>
    <additional_attributes>60.0;10.0;140.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>397</x>
      <y>397</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ide_end_request</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>415</x>
      <y>397</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>ide_stopped
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>394</x>
      <y>390</y>
      <w>30</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;280.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>470</x>
      <y>361</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>keyboard_interrupt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>475</x>
      <y>316</y>
      <w>548</w>
      <h>47</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
pckbd_init_hw-&gt;kbd_request_irq</panel_attributes>
    <additional_attributes>5460.0;10.0;10.0;450.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>470</x>
      <y>368</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>handle_kbd_event</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>475</x>
      <y>364</y>
      <w>18</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
kbd_controller_lock保护</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>440</x>
      <y>379</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kbd_read_status</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>445</x>
      <y>371</y>
      <w>33</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
读取键盘状态
KBD_STATUS_REG</panel_attributes>
    <additional_attributes>310.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>475</x>
      <y>371</y>
      <w>21</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
在status=KBD_STAT_OBF
（键盘缓冲区中有数据）时
执行9999次
</panel_attributes>
    <additional_attributes>10.0;10.0;40.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>455</x>
      <y>381</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kbd_read_input</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>458</x>
      <y>377</y>
      <w>25</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
在KBD_DATA_REG中读取系统扫描码</panel_attributes>
    <additional_attributes>210.0;10.0;32.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>478</x>
      <y>377</y>
      <w>27</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果status没有错误信息
KBD_STAT_GTO | KBD_STAT_PERR</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>463</x>
      <y>379</y>
      <w>27</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
status中KBD_STAT_MOUSE_OBF置上
表示是鼠标事件</panel_attributes>
    <additional_attributes>160.0;10.0;102.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>468</x>
      <y>383</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>handle_mouse_event</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>485</x>
      <y>383</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>handle_keyboard_event</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>478</x>
      <y>379</y>
      <w>14</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
否则是键盘事件</panel_attributes>
    <additional_attributes>10.0;10.0;122.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>505</x>
      <y>383</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kbd_read_status</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>478</x>
      <y>377</y>
      <w>33</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
再次读取status并循环</panel_attributes>
    <additional_attributes>10.0;10.0;312.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>455</x>
      <y>392</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_acknowledge</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>461</x>
      <y>386</y>
      <w>32</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>310.0;10.0;12.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>444</x>
      <y>399</y>
      <w>31</w>
      <h>24</h>
    </coordinates>
    <panel_attributes>1.如果reply_expected置上，表示cpu给键盘发送
	正在等待键盘回应。
	1.1当系统扫描码是KBD_REPLY_ACK表示
		键盘confirmation：
		acknowledge = 1;
		//清除标志
		reply_expected = 0
		return 0
	1.2当系统扫描码是KBD_REPLY_RESEND
		表示键盘需要cpu重新发送：
		resend = 1;
		reply_expected = 0
		return 0
2.如果不是cpu等待的扫描码，则return 1.
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>456</x>
      <y>395</y>
      <w>7</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>60.0;10.0;12.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>500</x>
      <y>394</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>handle_scancode</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>492</x>
      <y>386</y>
      <w>18</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
do_acknowledge确定接收
系统扫描码</panel_attributes>
    <additional_attributes>10.0;10.0;152.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>639</x>
      <y>390</y>
      <w>15</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tasklet_schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>492</x>
      <y>386</y>
      <w>156</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
keyboard_tasklet</panel_attributes>
    <additional_attributes>10.0;10.0;1542.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1075</x>
      <y>244</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>softirq_vec</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1064</x>
      <y>254</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>TASKLET_SOFTIRQ
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1092</x>
      <y>254</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>HI_SOFTIRQ
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1073</x>
      <y>247</y>
      <w>11</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>90.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1081</x>
      <y>247</y>
      <w>18</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;160.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1109</x>
      <y>261</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>bh_action
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1097</x>
      <y>257</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1096</x>
      <y>270</y>
      <w>8</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
mark_bh</panel_attributes>
    <additional_attributes>10.0;20.0;10.0;10.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1121</x>
      <y>260</y>
      <w>7</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
init_bh</panel_attributes>
    <additional_attributes>10.0;30.0;50.0;20.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1125</x>
      <y>256</y>
      <w>9</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TIMER_BH</panel_attributes>
    <additional_attributes>10.0;60.0;70.0;10.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1132</x>
      <y>255</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>timer_bh
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1133</x>
      <y>262</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tqueue_bh
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1133</x>
      <y>269</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>immediate_bh
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1125</x>
      <y>261</y>
      <w>10</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TQUEUE_BH</panel_attributes>
    <additional_attributes>10.0;10.0;80.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1125</x>
      <y>261</y>
      <w>17</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
IMMEDIATE_BH</panel_attributes>
    <additional_attributes>10.0;10.0;80.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1079</x>
      <y>277</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>TIMER_BH
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1094</x>
      <y>277</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>TQUEUE_BH
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1109</x>
      <y>277</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>IMMEDIATE_BH
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1085</x>
      <y>272</y>
      <w>14</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;50.0;120.0;10.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1096</x>
      <y>272</y>
      <w>5</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>30.0;50.0;10.0;10.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1096</x>
      <y>272</y>
      <w>19</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>170.0;50.0;10.0;10.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1091</x>
      <y>267</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tasklet
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1097</x>
      <y>264</y>
      <w>11</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
bh_task_vec</panel_attributes>
    <additional_attributes>10.0;30.0;10.0;10.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1091</x>
      <y>261</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tasklet_hi_vec
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1103</x>
      <y>262</y>
      <w>8</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;60.0;10.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1065</x>
      <y>261</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tasklet_vec
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1063</x>
      <y>267</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>console_tasklet
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1068</x>
      <y>264</y>
      <w>5</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;30.0;30.0;10.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1070</x>
      <y>257</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1103</x>
      <y>258</y>
      <w>14</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;40.0;120.0;10.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1103</x>
      <y>264</y>
      <w>13</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
统一</panel_attributes>
    <additional_attributes>10.0;50.0;110.0;10.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1059</x>
      <y>263</y>
      <w>8</w>
      <h>3</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>60.0;10.0;10.0;10.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1109</x>
      <y>255</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kbd_bh
bg=red
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1047</x>
      <y>262</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>console_softint
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1077</x>
      <y>267</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>keyboard_tasklet
valign=center
bg=red</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1082</x>
      <y>264</y>
      <w>11</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;30.0;90.0;10.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>644</x>
      <y>393</y>
      <w>3</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;20.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>633</x>
      <y>395</y>
      <w>30</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>将tasklet加在tasklet_vec[cpu].list
链表中，并且将TASKLET_SOFTIRQ
的softirq_active置上
注：如果是include &lt;linux/drivers/net&gt;
	挂入的链表路径不一样，但是同样会执行action
	（首先将tasklet挂入tq_immediate链表中，
	然后将IMMEDIATE_BH的bh挂入tasklet_hi_vec链表中
	最后置上HI_SOFTIRQ的softirq_active，执行时
	多经历了bh_action）
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>506</x>
      <y>397</y>
      <w>29</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
down是将系统扫描码的最高位提取并置反
反应是否按下按键</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>479</x>
      <y>400</y>
      <w>29</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>280.0;10.0;12.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>476</x>
      <y>406</y>
      <w>25</w>
      <h>26</h>
    </coordinates>
    <panel_attributes>1.如果放开按键将up_flag为0200
	如果按下按键为0
2.电源管理，当长期没操作进入
	省电模式，键盘操作之后正常
	运行，这里为空
	pm_access
3.do_poke_blanked_console = 1
4.中断的耗时操作留在打开中断后
	在console_tasklet中执行
	tasklet_schedule(&amp;console_tasklet)
5.添加随机性
	add_keyboard_randomness(scancode | up_flag)
6.利用ttytab和kbd_table表设置前台虚
	拟终端tty和前台键盘结构kbd（如果tty-&gt;driver_data
	不存在，则tty=NULL）
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>506</x>
      <y>400</y>
      <w>24</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果键盘处于原始模式
（kbd-&gt;kbdmode == VC_RAW）
将系统扫描码直接加到缓冲队列中</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;100.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>502</x>
      <y>410</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_queue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>506</x>
      <y>400</y>
      <w>23</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将系统扫描码转化成键码</panel_attributes>
    <additional_attributes>10.0;10.0;212.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>520</x>
      <y>406</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kbd_translate</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>521</x>
      <y>411</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>pckbd_translate</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>526</x>
      <y>409</y>
      <w>3</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;20.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>510</x>
      <y>418</y>
      <w>38</w>
      <h>34</h>
    </coordinates>
    <panel_attributes>1.如果是前缀码e0/e1，将其保存在静态局部变量
	prev_scancode，然后返回0
2.如果是无效码00/ff,prev_scancode设置为0，
	并返回0
3.如果不是上述情况：
	1.如果前缀码存在，
		1.如果是e1，现在收到的是1d，前缀码将其变换成0x100；
		如果是100，收到的是0x45，表示键码是E1_PAUSE；
		如果什么都不是，将前缀码清空为0。
		注：这里实现的是一个有限状态机，prev_scancode是状态
		scancode是条件，然后通过条件得到下一个状态或者结果
		2.如果是e0，首先将前缀码清空为0；
			如果此次的扫描码是左右shift（0x2a,0x36），丢弃，返回0
			因为如果shift在某些情况作为扩充键，Linux中依靠其内部状
			态处理，丢弃shift
			如果是其他键，将scancode通过e0_keys转化为键码
		注：大部分扩充键是e0
	2.如果前缀码不存在，但是扫描码大于SC_LIM，通过high_keys
		将其转换
	3.如果小于SC_LIM，系统扫描码即为键码*keycode = scancode
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>525</x>
      <y>414</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>506</x>
      <y>400</y>
      <w>52</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;502.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>548</x>
      <y>405</y>
      <w>9</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
up_flag
如果释放</panel_attributes>
    <additional_attributes>80.0;10.0;12.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>534</x>
      <y>408</y>
      <w>23</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>rep = 0
 //将key_down对应的键码清掉
 //如果原来是0，说明之前漏掉
 //用kbd_unexpected_up处理
test_and_clear_bit
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>552</x>
      <y>405</y>
      <w>18</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果是按下
将key_down对应的位置上
如果之前置上，将rep置上</panel_attributes>
    <additional_attributes>40.0;10.0;122.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>559</x>
      <y>409</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>test_and_set_bit
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>507</x>
      <y>400</y>
      <w>74</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
kbd-&gt;kbdmode == VC_MEDIUMRAW
半原始模式，将扫描码转化为键码，但是保留释放标志</panel_attributes>
    <additional_attributes>10.0;10.0;722.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>573</x>
      <y>407</y>
      <w>21</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_queue(keycode + up_flag)
raw_mode = 1
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>507</x>
      <y>400</y>
      <w>111</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
条件:
1.没有rep
2.在重复收到(rep)，并且键盘处于VC_REPEAT模式
	终端运行于“echo"模式，或者缓冲区已经被读完</panel_attributes>
    <additional_attributes>10.0;10.0;1092.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>584</x>
      <y>404</y>
      <w>34</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>320.0;10.0;10.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>561</x>
      <y>415</y>
      <w>27</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>根据shift_state，slockstate，lockstate
计算出shift_final
shift_state：每位表示辅助键Alt,Ctrl,
	Altgr,shift按下的状态
slockstate：相应的位置上表示，相应的
		辅助键一直sticky
lockstate：相应的位置上，表示将相应的
	辅助键反转
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>597</x>
      <y>404</y>
      <w>26</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
根据辅助键的按下的情况（shift_final）
选择将键码翻译成目标码的码表</panel_attributes>
    <additional_attributes>190.0;10.0;60.0;110.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>589</x>
      <y>415</y>
      <w>24</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>key_map = key_maps[shift_final]
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>615</x>
      <y>404</y>
      <w>15</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;130.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>619</x>
      <y>411</y>
      <w>11</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果码表存在</panel_attributes>
    <additional_attributes>90.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>605</x>
      <y>415</y>
      <w>18</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
从码表中获取
目标码及其类型</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>590</x>
      <y>421</y>
      <w>20</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>keysym = key_map[keycode];
 //高8位
type = KTYP(keysym)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>620</x>
      <y>415</y>
      <w>6</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;42.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>618</x>
      <y>418</y>
      <w>9</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
type&gt;=0xf0</panel_attributes>
    <additional_attributes>60.0;10.0;22.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>612</x>
      <y>422</y>
      <w>23</w>
      <h>23</h>
    </coordinates>
    <panel_attributes>1.type-=0xf0
2.在raw_mode下，扫描码已经
	被put_queue.但是如果是KT_SPEC
	或者KT_SHIFT类型的需要进一步
	处理
3.KT_LETTER相比KT_LATIN只是多了
	大写键（VC_CAPSLOCK）的处理，
	大写键置上时，相当于将shift取反
	然后找到key_map，从而找到实际的
	value=keysym &amp; 0xff	
4.然后根据type查找处理的函数
	key_handler[type]
5.如果type不为KT_SLOCK，将sticky
	的slockstate清掉
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>598</x>
      <y>450</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_self</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>604</x>
      <y>444</y>
      <w>19</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
KT_LATIN</panel_attributes>
    <additional_attributes>170.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>585</x>
      <y>458</y>
      <w>28</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>1.如果是放开（up_flag），直接返回
	//3.ctrl+'.'+'o'+'A'
2.如果diacr存在，使用handle_diacr处理
	value
	//2.Ctrl+'.'+'o'
3.如果存在dead_key_next，将其清掉
	并将value赋给diacr
4.最后通过put_queue将字符value放入队列中
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>625</x>
      <y>450</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_spec</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>620</x>
      <y>444</y>
      <w>14</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
1.CTRL+‘.’
KT_SPEC</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>622</x>
      <y>458</y>
      <w>21</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>1.如果是放开，直接返回
2.如果目标码不在KT_SPEC处理的
	范围内，直接返回
3.如果在raw_mode，不能是K_SAK
	类型
4.查询目标码的处理函数
	spec_fn_table[value]
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>631</x>
      <y>453</y>
      <w>3</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>629</x>
      <y>469</y>
      <w>12</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
"."在ctrl_map中
对应的是fb0e</panel_attributes>
    <additional_attributes>30.0;10.0;80.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>631</x>
      <y>474</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>compose</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>631</x>
      <y>480</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>dead_key_next = 1
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>637</x>
      <y>477</y>
      <w>3</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>608</x>
      <y>475</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>handle_diacr</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>599</x>
      <y>453</y>
      <w>7</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>50.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>598</x>
      <y>472</y>
      <w>18</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;160.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>598</x>
      <y>481</y>
      <w>30</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>1.遍历accent_table，看是否有和diacr相同
	base是此次value的项，如果有的话返回
	accent_table[i].result
2.如果value是空格或者和diacr相同，返回diacr
3.如果都找不到，将diacr put_queue，并
	返回value
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>612</x>
      <y>478</y>
      <w>3</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>624</x>
      <y>418</y>
      <w>25</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
type&lt;f0
并且不是放开也不是raw_mode</panel_attributes>
    <additional_attributes>10.0;10.0;232.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>639</x>
      <y>421</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>to_utf8</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>637</x>
      <y>428</y>
      <w>26</w>
      <h>16</h>
    </coordinates>
    <panel_attributes>1.如果7个位可以表示，put_queue
2.如果是8~11个位表示，用两个字节
	表示为：
	110***** 10******
3.如果需要12~16位表示，用3个字节表示
	1110**** 10****** 10******
注：*代表要表示的数，从左到右是数的
	高到低位。要几个字节表示，最高位
	就有几个1
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>645</x>
      <y>424</y>
      <w>6</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;42.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>627</x>
      <y>411</y>
      <w>44</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果码表不存在</panel_attributes>
    <additional_attributes>10.0;10.0;420.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>660</x>
      <y>424</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>compute_shiftstate</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>674</x>
      <y>423</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>kbd-&gt;slockstate = 0
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>665</x>
      <y>417</y>
      <w>15</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
有可能因为新按键
导致shift_state改变</panel_attributes>
    <additional_attributes>40.0;10.0;12.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>668</x>
      <y>417</y>
      <w>14</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;122.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>665</x>
      <y>431</y>
      <w>28</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>1.清空shift_state，k_down
2.遍历key_down中的所有位，查询
	其键码在plain_map中对应的目标码
	如果目标码的类型是辅助键（KT_SHIFT）
	或者锁定键（KT_SLOCK）置上，
	shift_state相应的位置上，k_down的量也需要
	改变
注：K_CAPSSHIFT置上，相当于K_SHIFT
	置上
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>665</x>
      <y>427</y>
      <w>8</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;62.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>576</x>
      <y>472</y>
      <w>24</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>571</x>
      <y>476</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_queue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>552</x>
      <y>484</y>
      <w>9</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>wake_up
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>555</x>
      <y>479</y>
      <w>23</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
keypress_wait</panel_attributes>
    <additional_attributes>210.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>575</x>
      <y>479</y>
      <w>11</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果前台tty存在</panel_attributes>
    <additional_attributes>20.0;10.0;80.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>572</x>
      <y>481</y>
      <w>13</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
flag=0
ch=value</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>563</x>
      <y>485</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty_insert_flip_char</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>547</x>
      <y>488</y>
      <w>24</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果tty_flip_buffer的buffer没满
tty-&gt;flip.count &lt; TTY_FLIPBUF_SIZE</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>538</x>
      <y>493</y>
      <w>20</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>tty-&gt;flip.count++;
*tty-&gt;flip.flag_buf_ptr++ = flag;
*tty-&gt;flip.char_buf_ptr++ = ch;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>579</x>
      <y>485</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>con_schedule_flip</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>582</x>
      <y>481</y>
      <w>6</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;40.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>565</x>
      <y>488</y>
      <w>23</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将tty的tty_flip_buffer
链接到con_task_queue的链表中</panel_attributes>
    <additional_attributes>210.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>560</x>
      <y>495</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>queue_task</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>592</x>
      <y>494</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tasklet_schedule</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>586</x>
      <y>488</y>
      <w>14</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将console_tasklet
链接到tasklet_vec中</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1272</x>
      <y>336</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tasklet_action
(与tasklet_hi_action类似)</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1146</x>
      <y>332</y>
      <w>140</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;1380.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1274</x>
      <y>343</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>t-&gt;func
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1280</x>
      <y>339</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1279</x>
      <y>346</y>
      <w>13</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
console_tasklet</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1273</x>
      <y>350</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>console_softint</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1259</x>
      <y>357</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>run_task_queue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1263</x>
      <y>353</y>
      <w>18</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1253</x>
      <y>364</y>
      <w>22</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>1.将队列头从list换成局部变量head
2.遍历链表，依次执行链表中的
	 p-&gt;routine（p-&gt;data）
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1264</x>
      <y>360</y>
      <w>4</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1260</x>
      <y>374</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>flush_to_ldisc</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1262</x>
      <y>369</y>
      <w>15</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
initialize_tty_struct</panel_attributes>
    <additional_attributes>10.0;10.0;30.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1245</x>
      <y>377</y>
      <w>24</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TTY_DONT_FLIP
表示正在上层正在取数据
所以需要将这个任务加到tq_timer中
等到之后do_timer时在做
</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1240</x>
      <y>385</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>queue_task
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1272</x>
      <y>381</y>
      <w>35</w>
      <h>27</h>
    </coordinates>
    <panel_attributes>1.tty-&gt;flip.buf_num为1，代表驱动是存储到了char_buf
	中的第二个，所以将存储目标码的buf指针分别复制到cp，
	fp。并将下一次键盘驱动存储的buf改成第一个buf
	tty-&gt;flip.buf_num = 0
	tty-&gt;flip.char_buf_ptr = tty-&gt;flip.char_buf;
	tty-&gt;flip.flag_buf_ptr = tty-&gt;flip.flag_buf
2.相反，如果键盘驱动此次存储的是第一个buf(buf_num=0)
	那么将cp，fp指向第一个buf，并对之后键盘驱动存储的
	buf转变为第二个
	tty-&gt;flip.buf_num = 1
	tty-&gt;flip.char_buf_ptr = tty-&gt;flip.char_buf + TTY_FLIPBUF_SIZE;
	tty-&gt;flip.flag_buf_ptr = tty-&gt;flip.flag_buf + TTY_FLIPBUF_SIZE
3.将键盘驱动buf中存储的count取出，
	count = tty-&gt;flip.count;
	tty-&gt;flip.count = 0
4.tty-&gt;ldisc.receive_buf
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1266</x>
      <y>377</y>
      <w>16</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1282</x>
      <y>411</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;ldisc.receive_buf
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1289</x>
      <y>407</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1289</x>
      <y>414</y>
      <w>13</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tty_ldisc_N_TTY</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1284</x>
      <y>418</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>n_tty_receive_buf</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1225</x>
      <y>421</y>
      <w>66</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
!tty-&gt;read_buf
如果tty没申请缓冲队列（tty-&gt;ldisc.open）
退出</panel_attributes>
    <additional_attributes>640.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1218</x>
      <y>427</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>return
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1247</x>
      <y>421</y>
      <w>44</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tty-&gt;real_raw
最原始的模式，即使是校验错误
也复制到tty的read_buf中</panel_attributes>
    <additional_attributes>420.0;10.0;10.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1233</x>
      <y>428</y>
      <w>20</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>1.因为read_buf是回环队列，所
	以要分两段写。将cp中对应的
	字符通过memcpy复制到tty-&gt;read_buf + tty-&gt;read_head
	对应的位置。同时更新
	tty-&gt;read_head
	tty-&gt;read_cnt
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1266</x>
      <y>421</y>
      <w>26</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果是其他模式，需要查看fp中每个
字节对应的flag（在tty_insert_flip_char
中flag都被置0）将每个字符依次复制</panel_attributes>
    <additional_attributes>230.0;10.0;20.0;80.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1260</x>
      <y>428</y>
      <w>12</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
TTY_NORMAL</panel_attributes>
    <additional_attributes>80.0;10.0;30.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1257</x>
      <y>432</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>n_tty_receive_char</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1253</x>
      <y>435</y>
      <w>16</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tty-&gt;raw
如果是普通的原始模式</panel_attributes>
    <additional_attributes>100.0;10.0;50.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1239</x>
      <y>448</y>
      <w>26</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>tty-&gt;read_buf[tty-&gt;read_head] = c;
tty-&gt;read_head = (tty-&gt;read_head + 1) &amp; (N_TTY_BUF_SIZE-1);
tty-&gt;read_cnt++;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1253</x>
      <y>440</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_tty_queue</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1242</x>
      <y>443</y>
      <w>30</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果read_cnt没超过界限N_TTY_BUF_SIZE</panel_attributes>
    <additional_attributes>170.0;10.0;120.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1263</x>
      <y>435</y>
      <w>25</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
加工模式</panel_attributes>
    <additional_attributes>10.0;10.0;230.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1266</x>
      <y>440</y>
      <w>34</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
stopped置上
flow_stopped没置
I_IXON &amp;&amp; I_IXANY
（输入控制流打开，并且任意字符都可以重新开始）</panel_attributes>
    <additional_attributes>200.0;10.0;130.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1273</x>
      <y>448</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>start_tty</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1256</x>
      <y>451</y>
      <w>24</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1244</x>
      <y>457</y>
      <w>19</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>1.stopped是0，或者stopped是
	1的情况下flow_stopped是1
	直接退出
2.tty-&gt;stopped = 0;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1277</x>
      <y>451</y>
      <w>25</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
 //该伪终端有连接，且是“信包”模式
tty-&gt;link &amp;&amp; tty-&gt;link-&gt;packet</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1266</x>
      <y>456</y>
      <w>29</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>tty-&gt;ctrl_status &amp;= ~TIOCPKT_STOP;
tty-&gt;ctrl_status |= TIOCPKT_START;
 //唤醒link去读buf
wake_up_interruptible(&amp;tty-&gt;link-&gt;read_wait)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1298</x>
      <y>457</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;driver.start
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1277</x>
      <y>451</y>
      <w>29</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;270.0;60.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1304</x>
      <y>460</y>
      <w>18</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
con_init-&gt;console_driver</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1299</x>
      <y>464</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>con_start</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1294</x>
      <y>471</y>
      <w>20</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>1.tty要存在
2.tty要在driver的范围内，
	并且要申请vc_data(在con_open
	中被申请)
3.清除kbd_table[num]中的VC_SCROLLOCK
	（scroll_lock mode）
4.set_leds
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1304</x>
      <y>467</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1277</x>
      <y>451</y>
      <w>43</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果tty.flag中TTY_DO_WRITE_WAKEUP置上
并且函数指针存在（tty_ldisc_N_TTY中不存在）</panel_attributes>
    <additional_attributes>10.0;10.0;410.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1311</x>
      <y>456</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;ldisc.write_wakeup
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1329</x>
      <y>456</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>wake_up_interruptible
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1276</x>
      <y>451</y>
      <w>63</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
将tty的写等待队列唤醒
tty-&gt;write_wait</panel_attributes>
    <additional_attributes>10.0;10.0;610.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1290</x>
      <y>444</y>
      <w>20</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>1.如果I_ISTRIP，将最高位清0
2.I_IUCLC置上，并且L_IEXTEN
	通过tolower将大写（isupper
	查询表）将其转化成小写
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1285</x>
      <y>440</y>
      <w>16</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;140.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1285</x>
      <y>440</y>
      <w>50</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
tty-&gt;closing==1</panel_attributes>
    <additional_attributes>10.0;10.0;480.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1328</x>
      <y>444</y>
      <w>21</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>1.如果输入控制流打开时（I_IXON），
	如果输入字符是START_CHAR，
	执行start_tty；如果是STOP_CHAR
	执行stop_tty
2.直接返回
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1349</x>
      <y>456</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>stop_tty</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1338</x>
      <y>453</y>
      <w>17</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;150.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1337</x>
      <y>463</y>
      <w>29</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>1.如果stopped置上，直接返回
2.tty-&gt;stopped = 1
3.如果该伪终端设备有链接，并且
	连接处于“信包”模式
	tty-&gt;ctrl_status &amp;= ~TIOCPKT_START;
	tty-&gt;ctrl_status |= TIOCPKT_STOP;
	wake_up_interruptible(&amp;tty-&gt;link-&gt;read_wait)
4.如果tty-&gt;driver.stop函数指针存在，则执行
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1354</x>
      <y>459</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1347</x>
      <y>481</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;driver.stop
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1348</x>
      <y>488</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>con_stop</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1353</x>
      <y>477</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1353</x>
      <y>484</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1345</x>
      <y>495</y>
      <w>20</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>1.tty要存在
2.tty要在driver的范围内，
	并且要申请vc_data(在con_open
	中被申请)
3.设置kbd_table[num]中的VC_SCROLLOCK
	（scroll_lock mode）
4.set_leds
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1353</x>
      <y>491</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1285</x>
      <y>440</y>
      <w>88</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
1.如果c不是特殊字符（process_char_map）
2.或者c是特殊字符，但是要求下一个不做特殊处理（lnext）</panel_attributes>
    <additional_attributes>10.0;10.0;860.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1363</x>
      <y>442</y>
      <w>10</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>80.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1358</x>
      <y>446</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>finish_erasing</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1361</x>
      <y>452</y>
      <w>16</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>1.如果处于erasing：
	put_char('/', tty);
	tty-&gt;column += 2;
	tty-&gt;erasing = 0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1363</x>
      <y>449</y>
      <w>7</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;50.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1371</x>
      <y>446</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;lnext = 0
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1370</x>
      <y>442</y>
      <w>9</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;70.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1369</x>
      <y>442</y>
      <w>25</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果tty需要回写
L_ECHO</panel_attributes>
    <additional_attributes>10.0;10.0;230.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1383</x>
      <y>444</y>
      <w>12</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果tty-&gt;read_cnt
已经满了</panel_attributes>
    <additional_attributes>90.0;10.0;20.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1381</x>
      <y>451</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_char('\a', tty)
return
halign=left
bg=red</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1383</x>
      <y>444</y>
      <w>25</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
当新行开始时
tty-&gt;canon_head == tty-&gt;read_head
记录当前column</panel_attributes>
    <additional_attributes>90.0;10.0;150.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1394</x>
      <y>450</y>
      <w>22</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>tty-&gt;canon_column = tty-&gt;column
猜想：column和head的区别，head
	偏向buf，column偏向与显示
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1418</x>
      <y>451</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>echo_char
bg=red</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1391</x>
      <y>444</y>
      <w>34</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
回显</panel_attributes>
    <additional_attributes>10.0;10.0;320.0;70.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1370</x>
      <y>442</y>
      <w>67</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果I_PARMRK（奇偶校验）
c='\377'
这里将c两次放入queue中
注：真实奇偶校验看n_tty_receive_parity_error</panel_attributes>
    <additional_attributes>10.0;10.0;650.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1430</x>
      <y>451</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_tty_queue
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1370</x>
      <y>442</y>
      <w>84</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;820.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1445</x>
      <y>450</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>put_tty_queue
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1285</x>
      <y>440</y>
      <w>190</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
特殊字符的处理</panel_attributes>
    <additional_attributes>10.0;10.0;1880.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1465</x>
      <y>442</y>
      <w>10</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>80.0;10.0;10.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1444</x>
      <y>455</y>
      <w>33</w>
      <h>23</h>
    </coordinates>
    <panel_attributes>1.如果输入字符时‘\r’
	1.I_IGNCR置上，忽略输入中的回车，直接return
	2.1不满足，I_ICRNL置上，将回车翻译成新行
		c='\n'
2.如果输入字符是新行‘\n’，并且I_INLCR置上，
	翻译成‘\r’
3.如果输出流控制打开（I_IXON），如果是字符
	START_CHAR，则start_tty
	如果是字符STOP_CHAR，则stop_tty
4.如果L_ISIG置上（收到相应字符，产生相应信号）：
	1.如果是INTR_CHAR，通过isig给进程组发SIGINT
	2.如果是QUIT_CHAR，发送SIGQUIT
	3.如果是SUSP_CHAR，发送SIGTSTP
	然后直接返回
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1496</x>
      <y>449</y>
      <w>37</w>
      <h>57</h>
    </coordinates>
    <panel_attributes>1.当字符是ERASE_CHAR（删掉上一个字符）
	或者KILL_CHAR（删掉到行首的所有字符）
	或者L_IEXTEN打开的时候WERASE_CHAR
	（删掉上一个单词）
	调用eraser
2.如果字符是LNEXT_CHAR（下一个字符不做特殊处理）
	并且L_IEXTEN打开
	tty-&gt;lnext = 1
	如果其中回写打开L_ECHO，finish_erasing
		如果L_ECHOCTL（控制字符也输出），输出：
			put_char('^', tty);
			put_char('\b', tty)
3.如果是将之前的字符重新打印（REPRINT_CHAR），
	并且回显（L_ECHO），自控制打开（L_IEXTEN）时，
	finish_erasing(tty);
	//打印控制字符
	echo_char(c, tty);
	//回显回车
	opost('\n', tty);
	然后从记录的行首canon_head，通过echo_char回显
	一直到read_head
4.如果是‘\n’，一定会handle_newline
		如果其中回显L_ECHO或者L_ECHONL打开，回显
		opost('\n', tty)
			如果回显打开的情况下read_cnt超过界限put_char('\a', tty)
5.如果是EOF_CHAR，将其改变位‘\0’,并handle_newline
		如果其中行首canon_head和read_head不同
		在tty-&gt;flags中设置TTY_PUSH，表示让tty尽快取
6.如果是EOL_CHAR，或者在L_IEXTEN打开的情况下，输入的是EOL2_CHAR
	一定会处理handle_newline
		如果其中回显打开L_ECHO，回显字符echo_char(c
			如果其中的read_cnt超过限制，put_char('\a', tty)
			如果行首和read_head相同，canon_column记录现在的column
		如果奇偶校验打开，并且字符是'\377'，put_tty_queue
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1472</x>
      <y>442</y>
      <w>37</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果处于加工模式
tty-&gt;icanon</panel_attributes>
    <additional_attributes>10.0;10.0;350.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1508</x>
      <y>508</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>handle_newline
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1513</x>
      <y>505</y>
      <w>3</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1498</x>
      <y>515</y>
      <w>37</w>
      <h>24</h>
    </coordinates>
    <panel_attributes> //设置eol，在read_chan中检测
set_bit(tty-&gt;read_head, &amp;tty-&gt;read_flags);
 //将行结束字符放入队列中
put_tty_queue(c, tty);
 //重置行首
tty-&gt;canon_head = tty-&gt;read_head;
 //增加行数
tty-&gt;canon_data++;
kill_fasync(&amp;tty-&gt;fasync, SIGIO, POLL_IN);
 //唤醒等待队列，加工模式是在行缓冲之后唤醒，
 //原始模式是在minimum_to_wake之后唤醒
if (waitqueue_active(&amp;tty-&gt;read_wait))
	wake_up_interruptible(&amp;tty-&gt;read_wait);
return;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1512</x>
      <y>511</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1472</x>
      <y>442</y>
      <w>84</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果是其他输入</panel_attributes>
    <additional_attributes>10.0;10.0;820.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1539</x>
      <y>448</y>
      <w>29</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>1.finish_erasing
2.如果需要回显L_ECHO
	当read_cnt超过限制时，put_char('\a', tty)
	如果输入时‘\n’（此时应该处于原始模式），回显opost('\n', tty)
	如果输入的是其他字符，如果是行首，canon_column记录column，并回显字符echo_char
3.如果需要奇偶校验I_PARMRK，并且是‘\377’
	将其放入tty的队列中
4.最后将字符放在tty的队列中
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1288</x>
      <y>421</y>
      <w>32</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果处于原始模式tty-&gt;icanon
并且read_cnt数量超过了minimum_to_wake
唤醒等待队列</panel_attributes>
    <additional_attributes>10.0;10.0;300.0;90.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1300</x>
      <y>430</y>
      <w>30</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>kill_fasync(&amp;tty-&gt;fasync, SIGIO, POLL_IN);
if (waitqueue_active(&amp;tty-&gt;read_wait))
	wake_up_interruptible(&amp;tty-&gt;read_wait);
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1288</x>
      <y>421</y>
      <w>70</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果键盘输入过快，导致tty队列中的空间
n_tty_receive_room小于门限值TTY_THRESHOLD_THROTTLE
如果检测到tty-&gt;flags中TTY_THROTTLED标志没置（还没对键盘的输入做限制）</panel_attributes>
    <additional_attributes>10.0;10.0;680.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1350</x>
      <y>426</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;driver.throttle
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1406</x>
      <y>454</y>
      <w>20</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>180.0;10.0;10.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1393</x>
      <y>460</y>
      <w>27</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>1.如果L_ECHOCTL打开，回显除了‘\t’之外的
	所有控制字符（iscntrl）
	put_char('^', tty);
	put_char(c ^ 0100, tty);
	tty-&gt;column += 2;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1425</x>
      <y>461</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>opost</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1423</x>
      <y>454</y>
      <w>10</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;80.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1377</x>
      <y>459</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;driver.put_char
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1382</x>
      <y>454</y>
      <w>6</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>40.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1388</x>
      <y>472</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;driver.write_room
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1396</x>
      <y>464</y>
      <w>37</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
获取space，并检查
如果为0，返回-1</panel_attributes>
    <additional_attributes>350.0;10.0;10.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1389</x>
      <y>479</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>con_write_room</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1394</x>
      <y>475</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1386</x>
      <y>486</y>
      <w>17</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>1.如果tty-&gt;stopped返回0
2.否则返回4096
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1394</x>
      <y>482</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1415</x>
      <y>464</y>
      <w>20</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
O_OPOST
自定义的输出
注：IEXTEN是自定义的输入</panel_attributes>
    <additional_attributes>160.0;10.0;30.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1406</x>
      <y>471</y>
      <w>28</w>
      <h>39</h>
    </coordinates>
    <panel_attributes>1.如果输入字符是'\n'，
	1.如果O_ONLRET打开，回到当前行的行首tty-&gt;column = 0
	2.如果O_ONLCR打开，tty-&gt;driver.put_char（'\r'）,回到行首tty-&gt;column = 0
	3.记录新行行首的位置，tty-&gt;canon_column = tty-&gt;column
2.如果输入字符是'\r'
	1.如果O_ONOCR打开，不允许在行首回车
		所以在tty-&gt;column为0时，直接返回0
	2.如果O_OCRNL打开，需要将回车映射为新行符'\n'
		如果在O_ONLRET打开的情况下tty-&gt;canon_column = tty-&gt;column = 0
		然后退出（注：这里在换成'\n'，却没记录canon_column，暂时不清楚原因）
	3.如果上述情况都不满足：
		tty-&gt;canon_column = tty-&gt;column = 0
		然后退出
3.如果是'\t'，首先计算距离8个字符满，还需要多少个字符(需要填充的)
	1.如果O_TABDLY中flag为XTABS，需要将其填充为空格
		tty-&gt;column += spaces
		tty-&gt;driver.write写入spaces个空格数
		然后return 0
	2.否则tty-&gt;column += spaces，然后退出
4.如果是'\b'，tty-&gt;column--后退出
5.如果是其他字符：
	1.如果O_OLCUC打开，通过toupper将其转化为大写
	2.如果不是功能控制（!iscntrl），tty-&gt;column++
	然后退出
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1442</x>
      <y>480</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>tty-&gt;driver.put_char
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1430</x>
      <y>464</y>
      <w>20</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;180.0;160.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1442</x>
      <y>487</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>con_put_char</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1447</x>
      <y>482</y>
      <w>35</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
con_init-&gt;console_driver
参考书说是tty_register_driver-&gt;tty_default_put_char
-&gt;con_write
但是它们都需要执行do_con_write</panel_attributes>
    <additional_attributes>10.0;20.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1435</x>
      <y>493</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>pm_access</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1440</x>
      <y>490</y>
      <w>10</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
电源管理</panel_attributes>
    <additional_attributes>80.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>1456</x>
      <y>493</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>do_con_write</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1447</x>
      <y>490</y>
      <w>15</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;130.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1440</x>
      <y>496</y>
      <w>24</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>220.0;10.0;10.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1435</x>
      <y>501</y>
      <w>22</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>1.如果vc_cons[i].d没被申请
	（!vc_cons_allocated）
	返回0.
注：这是在con_open中被申请的
2.如果是用户层调用（from_user）
	通过copy_from_user将数据copy
	到con_buf中，最大为CON_BUF_SIZE
	buf=con_buf
3.如果是前台console（IS_FG），
	hide_cursor
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1461</x>
      <y>496</y>
      <w>19</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
遍历buf直到tty-&gt;stopped
置上或者count等于0</panel_attributes>
    <additional_attributes>10.0;10.0;30.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1459</x>
      <y>501</y>
      <w>19</w>
      <h>42</h>
    </coordinates>
    <panel_attributes>1.如果utf打开：
	1.如果字符大于0x7f
		1.如果utf_count没用完，并且不是最高位（c &amp; 0xc0==0x80）
			将之前存储的utf_char左移6位，或上现在字符的低6位
			（(utf_char &lt;&lt; 6) | (c &amp; 0x3f)）
			utf_count--
			如果utf_count变为0，表示utf已经组装完成，tc = c = utf_char
			否则继续continue，进行下一个字符
		2.如果上述两种情况不满足，说明是utf的最高位
			这里是查看utf的最高位有n个1,utf_count=n-1,utf_char则被
			赋值为其他位
			如果不满足utf的规则，直接将utf=0，忽略这个字符
			设置了utf_count和utf_char之后，continue，继续遍历下一个字符
			直到utf完整之后，然后处理
	2.如果小于0x7f
		tc = c
		utf_count = 0
2.如果utf-8没打开
	通过translate将8位ASCII或者其他编码转换成unicode
	这个表是二维数组translations中的一个
3.如果tc存在，并且字符c不是控制字符,设置ok，表示字符可以显示
4.如果可以显示vc_state == ESnormal &amp;&amp; ok
	通过conv_uni_to_pc将unicode转化为字模的编号
	然后通过scr_writew写到0xa0000~0x100000
	注：对字符显示暂时不熟，之后在看
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>1479</x>
      <y>501</y>
      <w>16</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>1.如果调用接口来自用户空间（from_user）
	并且之前buf中的数据还没复制完，通过again
	再去复制一遍
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>1461</x>
      <y>496</y>
      <w>25</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
out</panel_attributes>
    <additional_attributes>10.0;10.0;230.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>734</x>
      <y>339</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_interrupt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>739</x>
      <y>316</y>
      <w>284</w>
      <h>25</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
setup_uhci</panel_attributes>
    <additional_attributes>2820.0;10.0;10.0;230.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>670</x>
      <y>345</y>
      <w>37</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>1.读取controller的中断状态，
	// uhci-&gt;io_addr
	status = inw(io_addr + USBSTS);
	如果status为0，直接返回；否则回写清除status
	outw(status, io_addr + USBSTS)
2.如果状态中有除USBINT和ERROR状态被置上，打印其信息
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>687</x>
      <y>342</y>
      <w>54</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>520.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>710</x>
      <y>346</y>
      <w>44</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>1.通过uhci_free_pending_qhs将qh从uhci-&gt;qh_remove_list
	中移除
2.遍历uhci-&gt;urb_remove_list，利用list_del将urb.urb_list
	从其链表中删除，并且通过urb-&gt;complete对urb进行最后的处理
3.通过uhci_clear_next_interrupt将其请求中断的flag（TD_CTRL_IOC）
	清除：
	uhci-&gt;skel_term_td.status &amp;= ~TD_CTRL_IOC
4.遍历uhci-&gt;urb_list链表（nested_lock），通过uhci_transfer_result将其中完成的urb
	找出，从链表中删除，并求其进行最后处理
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>725</x>
      <y>342</y>
      <w>16</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>140.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>739</x>
      <y>363</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_transfer_result</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>728</x>
      <y>360</y>
      <w>22</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;200.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>746</x>
      <y>366</y>
      <w>19</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
查看传输的类型
usb_pipetype(urb-&gt;pipe)</panel_attributes>
    <additional_attributes>20.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>722</x>
      <y>369</y>
      <w>27</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
PIPE_CONTROL</panel_attributes>
    <additional_attributes>250.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>715</x>
      <y>373</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_result_control</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>694</x>
      <y>380</y>
      <w>21</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>1.如果urbp为空，返回EINVAL
2.如果urbp对应的链表为空，
	返回EINVAL
3.如果之前检测到short packet，选择状态交互tmp = head-&gt;prev;
	直接去处理状态交互（status_phase）
注：short packet可能是因为数据交互
	的最后阶段，所以直接执行状态交互
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>698</x>
      <y>376</y>
      <w>22</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
filter</panel_attributes>
    <additional_attributes>210.0;10.0;12.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>716</x>
      <y>380</y>
      <w>20</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>1.通过链表指针找到对应的td
2.通过uhci_status_bits检查
	td-&gt;status中返回的状态
	1.如果TD_CTRL_ACTIVE还是置上的
	说明td还没被执行，或者需要重新执行
	所以返回EINPROGRESS
	2.如果td被执行，但是status却不是0
	说明执行出错，td_error
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>719</x>
      <y>376</y>
      <w>10</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
setup交互</panel_attributes>
    <additional_attributes>10.0;10.0;22.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>789</x>
      <y>378</y>
      <w>8</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>td_error
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>720</x>
      <y>376</y>
      <w>76</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;742.0;20.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>781</x>
      <y>384</y>
      <w>27</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>1.通过uhci_map_status解析status中的错误
	如果是EPIPE（broken pipe），通过usb_endpoint_halt
	将对应的endpoint标记为halt
	//out指方向，in=0，out=1
	dev-&gt;halted[out] |= (1 &lt;&lt; (ep))
2.返回解析出来的错误
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>793</x>
      <y>381</y>
      <w>3</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>737</x>
      <y>380</y>
      <w>22</w>
      <h>25</h>
    </coordinates>
    <panel_attributes>1.如果因为总线load过高，导致某个td
	长期没有执行，而利用 rh_int_timer_do
	将空闲时间的回收暂时拆除，致使fsbr_timeout置上；
	并且该数据交互要求产生中断（TD_CTRL_IOC），并已经执行完（!TD_CTRL_ACTIVE）
	说明此时的bus有空闲出来，所以利用uhci_inc_fsbr将term_td再次连接到hs_control,做usb总线时间的回收
	并将flag清掉：
	urbp-&gt;fsbr_timeout = 0;
	td-&gt;status &amp;= ~TD_CTRL_IOC;
2.查看status，如果没被执行（TD_CTRL_ACTIVE），返回EINPROGRESS
3.urb-&gt;actual_length记录所有数据交互的长度（每个数据交互的长度记录在td-&gt;status中）	
4.如果status非0，表示存在错误，td_error
5.如果此次交互的实际长度（uhci_actual_length）小于其预期的长度（uhci_expected_length）
	1.如果USB_DISABLE_SPD置上（SPD short packet detected）,表示不检测短包，返回EREMOTEIO
	2.如果该flag没置上，如果是输入交互（USB_PID_IN），通过usb_control_retrigger_status
		将此次传输重新执行（因为里面short_control_packet置上，所以只执行状态交互）
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>720</x>
      <y>376</y>
      <w>28</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
数据交互
除了第一个和最后一个交互外
都为数据交互</panel_attributes>
    <additional_attributes>10.0;10.0;262.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>760</x>
      <y>380</y>
      <w>20</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>1.提取status
2.如果没被执行（TD_CTRL_ACTIVE）
	返回EINPROGRESS
3.如果status非0，表示出错，td_error
4.如果正确执行完，返回0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>721</x>
      <y>376</y>
      <w>48</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
状态交互</panel_attributes>
    <additional_attributes>10.0;10.0;462.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>740</x>
      <y>408</y>
      <w>19</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>usb_control_retrigger_status</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>748</x>
      <y>404</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>729</x>
      <y>414</y>
      <w>36</w>
      <h>20</h>
    </coordinates>
    <panel_attributes>1.urbp-&gt;short_control_packet = 1
2.通过uhci_remove_qh将释放，
	注释说是为了防止pointer overwritter，这里暂时不清楚
3.遍历传输中除了状态交互之外的其他所有交互，
	通过uhci_remove_td_from_urb将td.list从urbp的链表中删除
	通过uhci_remove_td将td从框架中移除（等时/中断传输会将td链接到对应的框架中，而不是通过qh）
	通过uhci_free_td释放td
4.再次为urbp分配qh
	urbp-&gt;qh = uhci_alloc_qh(urb-&gt;dev)
5.将剩下的状态交互通过uhci_insert_tds_in_qh插入到qh中
6.将qh通过uhci_insert_qh插入到ls_qh或者hs_qh中
7.返回EINPROGRESS
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>723</x>
      <y>436</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_remove_td</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>705</x>
      <y>442</y>
      <w>30</w>
      <h>31</h>
    </coordinates>
    <panel_attributes>1.如果td的frameptr（指向执行td的框架frame,
	一般在等时传输时对这个字段赋值），prevtd/nexttd
	（在框架内的连接指针）都为空，表示td没连接到框架内，直接返回
2.如果frameptr存在，表示该td是这个框架内的第一个，
	//将第一个换成td的下一个，物理地址
	*(td-&gt;frameptr) = td-&gt;link;
	//如果td-&gt;nexttd存在，将其frameptr指向对应的框架
	td-&gt;nexttd-&gt;frameptr = td-&gt;frameptr;
	td-&gt;nexttd-&gt;prevtd = NULL;
	td-&gt;nexttd = NULL;
	td-&gt;frameptr = NULL
	如果不是框架中的第一个（frameptr不存在）
	//断开前面的链接，这里包含物理地址和虚拟地址
	td-&gt;prevtd-&gt;nexttd = td-&gt;nexttd;
	td-&gt;prevtd-&gt;link = td-&gt;link;
	//将td前后的两个td相连
	td-&gt;nexttd-&gt;prevtd = td-&gt;prevtd
	td-&gt;prevtd = td-&gt;nexttd = NULL;

	td-&gt;link = UHCI_PTR_TERM
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>747</x>
      <y>411</y>
      <w>3</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>20.0;10.0;12.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>716</x>
      <y>439</y>
      <w>13</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>120.0;10.0;12.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>740</x>
      <y>436</y>
      <w>12</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_free_td</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>737</x>
      <y>443</y>
      <w>20</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>1.检查td.list是否在urbp链表中
2.如果td-&gt;dev存在，递减其rfecnt
3.通过kmem_cache_free释放td
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>744</x>
      <y>439</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;12.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>728</x>
      <y>433</y>
      <w>14</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>130.0;10.0;12.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>742</x>
      <y>433</y>
      <w>6</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;42.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>889</x>
      <y>370</y>
      <w>23</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>1.存储查询urb的状态
	urb-&gt;status = ret
2.如果正在处理（EINPROGRESS）
	直接返回
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>748</x>
      <y>366</y>
      <w>151</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;1490.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>748</x>
      <y>363</y>
      <w>191</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
如果urb已经处理完</panel_attributes>
    <additional_attributes>10.0;40.0;1890.0;10.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>909</x>
      <y>379</y>
      <w>25</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>1.对于控制/成块/等时传输，如果对urb
	分配了bandwidth，通过usb_release_bandwidth
	将其释放。最后通过uhci_unlink_generic
	释放urb
2.对于中断传输，如果urb-&gt;interval有，表示
	这个中断传输不释放，需要一直polling（uhci_submit_interrupt）
	所以执行完urb-&gt;complete之后，需要通过uhci_reset_interrupt
	将中断传输重新置上
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>922</x>
      <y>363</y>
      <w>17</w>
      <h>18</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>150.0;10.0;10.0;160.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>899</x>
      <y>392</y>
      <w>31</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
urb-&gt;bandwidth
（控制传输是不会申请带宽，所以不会进这里）</panel_attributes>
    <additional_attributes>180.0;10.0;120.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>905</x>
      <y>397</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>usb_release_bandwidth</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>902</x>
      <y>403</y>
      <w>24</w>
      <h>12</h>
    </coordinates>
    <panel_attributes>1.释放总线带宽
	dev-&gt;bus-&gt;bandwidth_allocated -= urb-&gt;bandwidth
2.如果是等时传输：
	dev-&gt;bus-&gt;bandwidth_isoc_reqs--
	其他传输：
	dev-&gt;bus-&gt;bandwidth_int_reqs--
3.urb-&gt;bandwidth = 0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>912</x>
      <y>400</y>
      <w>3</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>927</x>
      <y>397</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_unlink_generic</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>924</x>
      <y>392</y>
      <w>13</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;110.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>704</x>
      <y>363</y>
      <w>17</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_free_pending_qhs</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>712</x>
      <y>360</y>
      <w>11</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>90.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>684</x>
      <y>368</y>
      <w>25</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>1.遍历uhci-&gt;qh_remove_list，将之前
	冷却的qh通过list_del脱链，并通过
	uhci_free_qh释放
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>698</x>
      <y>366</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>110.0;10.0;10.0;20.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>927</x>
      <y>403</y>
      <w>24</w>
      <h>23</h>
    </coordinates>
    <panel_attributes>1.利用uhci_dec_fsbr检查urb之前是否
	要求回收总线的空闲时间，如果有，将
	uhci-&gt;fsbr递减，释放其引用
2.通过uhci_remove_urb_list将urb
	从起urb.list链表中删除（nested_lock保护）
3.如果存在urbp-&gt;qh，通过uhci_remove_qh断开其虚拟地址
	链接和物理地址链接，并将其链接到remove_list中冷却
	等待下一次中断将其释放
4.如果urbp-&gt;urb_queue_list不为空，说明该传输和其他传输
	进行了合并（同一设备的同一endpoint），通过uhci_delete_queued_urb
	将其从链表中删除
5.通过uhci_destroy_urb_priv释放urbp及其内部的td
6.urb-&gt;dev = NULL
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>935</x>
      <y>400</y>
      <w>3</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>913</x>
      <y>428</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_delete_queued_urb</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>921</x>
      <y>425</y>
      <w>18</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>160.0;10.0;10.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>901</x>
      <y>435</y>
      <w>33</w>
      <h>19</h>
    </coordinates>
    <panel_attributes>1.如果队列中当前传输是队列头（!urbp-&gt;queued）
	直接将下一个传输nurbp的qh插入到bulk_qh中，并标记队列头
	nurbp-&gt;queued = 0
2.如果urbp-&gt;queued为1（不是队列头），取出当前传输的前一个传输purbp
	如果nurbp不是队列头，那么将purbp最后一个td链接到nurbp的第一个td：
	ptd-&gt;link = virt_to_bus(list_entry(nurbp-&gt;list.next,
					struct uhci_td, list))
	如果nurbp是队列头，那么purbp最后一个td将是整个队列的最后一个td：
	ptd-&gt;link = UHCI_PTR_TERM
3.（1,2是处理物理链表）通过list_del将urbp从虚拟链表中删除
注：urb_queue_list没有专门的链表头
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>920</x>
      <y>431</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>942</x>
      <y>428</y>
      <w>16</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_destroy_urb_priv</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>939</x>
      <y>425</y>
      <w>14</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;120.0;30.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>939</x>
      <y>435</y>
      <w>41</w>
      <h>13</h>
    </coordinates>
    <panel_attributes>1.filer:urbp/urb-&gt;dev/urb-&gt;dev-&gt;bus/urb-&gt;dev-&gt;bus-&gt;hcpriv要存在
2.遍历urbp-&gt;list，分别通过uhci_remove_td_from_urb将其从urbp链表中删除
	通过uhci_remove_td将td从框架中删除
	通过uhci_free_td释放td数据结构
3.释放urbp：
	urb-&gt;hcpriv = NULL;
	kmem_cache_free(uhci_up_cachep, urbp)
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>949</x>
      <y>431</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>961</x>
      <y>399</y>
      <w>14</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_reset_interrupt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>925</x>
      <y>392</y>
      <w>44</w>
      <h>9</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;420.0;70.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>955</x>
      <y>406</y>
      <w>30</w>
      <h>11</h>
    </coordinates>
    <panel_attributes>1.获取urbp-&gt;list链表中的td（只有一个）
2.置status和info
	td-&gt;status = (td-&gt;status &amp; 0x2F000000) | TD_CTRL_ACTIVE | TD_CTRL_IOC
	td-&gt;info的TD_TOKEN_TOGGLE位置反，并将其下一个次的标记放在dev-&gt;toggle[out]（每一位代表一个endpoint）
3.标记传输正在运行
	urb-&gt;status = -EINPROGRESS
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>967</x>
      <y>402</y>
      <w>3</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>936</x>
      <y>363</y>
      <w>28</w>
      <h>15</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
双缓冲优化传输</panel_attributes>
    <additional_attributes>10.0;10.0;260.0;130.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>941</x>
      <y>376</y>
      <w>36</w>
      <h>17</h>
    </coordinates>
    <panel_attributes>1.如果urb-&gt;next存在，查找链表中有没有不在框架内的传输
	（!= -EINPROGRESS），如果有processed=1，如果检测到
	这个链表是个环形链表is_ring置上
2.通过urb-&gt;complete最后处理urb，如果是个环形链表（!proceed &amp;&amp; is_ring）
	再次将urb通过uhci_submit_urb提交至框架
3.如果urb.next没有提交给框架，通过uhci_submit_urb将其提交，并通过
	urb-&gt;complete最后处理当前的urb
注：这里优化好像只能将urb.next提交至框架，不能在这次将之后的urb提交
	如果next提交时出错，顺延到第三个urb如果提交成功，那么会一直循环
	直到第三个urb处理完成（应该是bug）
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>987</x>
      <y>404</y>
      <w>20</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>usb_api_blocking_completion</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>981</x>
      <y>396</y>
      <w>13</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>urb-&gt;complete
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>989</x>
      <y>399</y>
      <w>10</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
控制传输</panel_attributes>
    <additional_attributes>10.0;10.0;40.0;50.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>969</x>
      <y>392</y>
      <w>19</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;170.0;40.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>987</x>
      <y>411</y>
      <w>24</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>1.如果唤醒队列urb-&gt;context-&gt;wakeup
	不为空，通过wake_up将其唤醒
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>997</x>
      <y>407</y>
      <w>19</w>
      <h>6</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
控制传输中是唤醒调用
usb_start_wait_urb的进程
</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;40.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>746</x>
      <y>369</y>
      <w>88</w>
      <h>8</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
PIPE_BULK/PIPE_INTERRUPT</panel_attributes>
    <additional_attributes>10.0;10.0;860.0;60.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>821</x>
      <y>375</y>
      <w>18</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_result_bulk
uhci_result_interrupt</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>818</x>
      <y>378</y>
      <w>20</w>
      <h>10</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
过程和控制交互相似
只是少了setup交互和状态加护</panel_attributes>
    <additional_attributes>130.0;10.0;60.0;80.0</additional_attributes>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>809</x>
      <y>386</y>
      <w>44</w>
      <h>32</h>
    </coordinates>
    <panel_attributes>1.urbp要存在，并且将：
	urb-&gt;actual_length = 0
2.遍历urbp-&gt;list链表，获取链表中的td
	1.如果之前因为bus load较高，相应控制交互或者成块交互
		长时间没执行而timeout（fsbr_timeout），并且是当前td产生的
		中断（TD_CTRL_IOC &amp;&amp; ！TD_CTRL_ACTIVE）：
		//重新利用usb空闲总线时间
		uhci_inc_fsbr(urb-&gt;dev-&gt;bus-&gt;hcpriv, urb);
		urbp-&gt;fsbr_timeout = 0;
		td-&gt;status &amp;= ~TD_CTRL_IOC;
	2.通过uhci_status_bits解析td-&gt;status，如果TD_CTRL_ACTIVE
		置上，返回EINPROGRESS，表示td还没被执行完
	3.更新actual_length：
		urb-&gt;actual_length += uhci_actual_length(td-&gt;status)
	4.如果status非0，表示有错，转到td_error执行（和控制传输类似）
	5.如果受到的实际长度，小于预期长度
		1.将(dev)-&gt;toggle[out]（下一次应该发的TD_TOKEN_TOGGLE）
		设置为该urb中的TOGGLE置反。
		2.如果此时USB_DISABLE_SPD置上，返回EREMOTEIO，否则返回0
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>844</x>
      <y>381</y>
      <w>8</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>td_error
valign=center</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>831</x>
      <y>378</y>
      <w>17</w>
      <h>5</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
和控制传输相同</panel_attributes>
    <additional_attributes>10.0;10.0;150.0;30.0</additional_attributes>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>746</x>
      <y>369</y>
      <w>133</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;
PIPE_ISOCHRONOUS</panel_attributes>
    <additional_attributes>10.0;10.0;1310.0;50.0</additional_attributes>
  </element>
  <element>
    <id>UMLUseCase</id>
    <coordinates>
      <x>862</x>
      <y>374</y>
      <w>20</w>
      <h>4</h>
    </coordinates>
    <panel_attributes>uhci_result_isochronous</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>UMLGeneric</id>
    <coordinates>
      <x>857</x>
      <y>382</y>
      <w>30</w>
      <h>14</h>
    </coordinates>
    <panel_attributes>1.urbp要存在
2.遍历urbp-&gt;list链表中的td
	1.如果td.status中TD_CTRL_ACTIVE置上，返回EINPROGRESS
	2.记录td和urb的实际长度
		urb-&gt;iso_frame_desc[i].actual_length = actlength;
		urb-&gt;actual_length += actlength;
	3.记录td的状态：
		urb-&gt;iso_frame_desc[i].status = status;
halign=left</panel_attributes>
    <additional_attributes/>
  </element>
  <element>
    <id>Relation</id>
    <coordinates>
      <x>872</x>
      <y>377</y>
      <w>3</w>
      <h>7</h>
    </coordinates>
    <panel_attributes>lt=.&gt;</panel_attributes>
    <additional_attributes>10.0;10.0;10.0;50.0</additional_attributes>
  </element>
</diagram>
